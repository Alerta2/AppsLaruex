{% extends "base/base_timetrackpro.html" %}

{% load static %}
{% block imports %}
  <link rel="stylesheet" href="{% static 'css/timetrackpro/tarjeta_acceso.css' %}" />
{% endblock %}
{% block content %}

<!-- Tarjeta flip -->
<div class="row">
  <div class="col d-flex justify-content-center">
    <div class="flip-card">
      <div class="flip-card-inner">
          <div class="flip-card-front">
            <div class="row">
              <div class="col">
                <img class="logo-uex" src="{% static '/img/logos/uex_logo.png'%}" alt="logo" x="0px" y="0px"  height="48"  viewBox="0 0 48 48">
                <p class="heading_8264">LABORATORIO DE RADIACTIVIDAD AMBIENTAL DE LA UNIVERSIDAD DE EXTREMADURA
                </p>
              </div>
            </div>
            <!-- <img class="w-100 rounded" id="imagenPrevia" src="{% static '/img/empleados/1_usuario.png'%}" alt="foto_empleado"> -->
            <div class="row">
              <div class="col">
                <img class="foto" {% if tarjeta.imagen %} src="{% static '/img/timetrackpro/tarjetas/'%}{{tarjeta.imagen}}" {% else %} src="{% static '/img/timetrackpro/tarjetas/not_found.jpeg'%}" {% endif %}id="imagenActual" alt="logo" x="0px" y="0px"  height="124" width="100" viewBox="0 0 124 124">
                
                
              
                <p class="labelTarejetaAcceso">Tarjeta de acceso</p>
                <p class="nombre">{{tarjeta.nombre}}</p>
                <p class="apellidos">{{tarjeta.apellidos}}</p>
                <p class="dni">{{tarjeta.dni|slice:-1}}-{{tarjeta.dni|last}}</p>
  

              </div>
            </div>
            <div class="row">
              <div class="col">
    
                <img class="logo-laruex-anverso" src="{% static '/img/logos/laruex_logo.png'%}" alt="logo" x="0px" y="0px"  height="48"  viewBox="0 0 48 48">
                
                <img class="logo-alerta2-anverso" src="{% static '/img/logos/alerta2_logo.png'%}" alt="logo" x="0px" y="0px"  height="30"  viewBox="0 0 48 48">
              </div>
            </div>

          </div>
          <div class="flip-card-back">
            <div class="row">
              <div class="col">
    
                <img class="logo-laruex-reverso" src="{% static '/img/logos/laruex_logo.png'%}" alt="logo" x="0px" y="0px"  height="48"  viewBox="0 0 48 48">
                
                <img class="logo-alerta2-reverso" src="{% static '/img/logos/alerta2_logo.png'%}" alt="logo" x="0px" y="0px"  height="30"  viewBox="0 0 48 48">
              </div>
            </div>
            
            <div class="row">
              <div class="col">
                <div class="infoGeneral-card">
                  <p>{{infoGeneralTarjeta}}</p>
                  <p class="my-1">{{infoPersonalTarjeta}}</p>
                  <p>{{infoContactoTarjeta}}</p>
                </div>
              </div>
            </div>
            <div class="row">
              <div class="col">
                <p class="expiraLabel">Expira</p>
                {% if tarjeta.fecha_expiracion %}
                {% with tarjeta.fecha_expiracion|date:"Y" as year %}
                  {% with tarjeta.fecha_expiracion|date:"m" as mes %}
                  <p class="fechaExpiracion">{{mes}} / {{year|slice:"-2:"}}</p>
                  {% endwith %}
                {% endwith %}

                {% else %}
                <p class="fechaExpiracion">12 / 50</p>

                {% endif %}
                <p class="numeroTarjetaLabel">Nº Tarjeta</p>
                <p class="numeroTarjeta">{{tarjeta.id_tarjeta}}</p>
              </div>
            </div>
          </div>
      </div>
    </div>
  </div>

</div><!-- END Tarjeta flip -->



<!-- Formulario editar Tarjeta -->

<div class="row">
  <div class="col-md-12 mb-lg-0 mb-4">
    <div class="card mt-4">
                  <!-- Edit Form -->
    <form id="formularioEditarTarjetaAcceso"  action="{% url 'timetrackpro:editar-tarjeta-acceso' %}" method="POST" enctype="multipart/form-data">
    {% csrf_token %}
      <div class="card-header pb-0 p-3">
        <div class="row">
          <div class="col-6 d-flex align-items-center">
            <h3 class="mb-0">Editar los datos de la tarjeta</h3>
          </div>
        </div>
      </div>
      <div class="card-body p-3">
        <div class="row">
          <div class="row  d-flex align-items-center justify-content-start mb-3">
            <div class="col-3 col-md-3 col-sm-12" >
              <i class="fa-duotone fa-address-card me-2"></i><label for="numeroTarjeta" class="col-form-label">ID Tarjeta</label>

              <input type="text" id="numeroTarjeta" name="numeroTarjeta" class="form-control" data-target="idCard" maxlength="8" placeholder="1111-5555"  value="{{tarjeta.id_tarjeta}}" required/>

            </div>
            <div class="col-3 col-md-3 col-sm-12" >
              <i class="fa-duotone fa-calendar-days me-2"></i><label for="fecha_alta" class="col-form-label">Fecha de Alta</label>

              <input type="date" id="fecha_alta" name="fechaAlta" class="form-control" value="{{tarjeta.fecha_alta|safe}}" />

            </div>
            <div class="col-3 col-md-3 col-sm-12" >
              <i class="fa-duotone fa-calendar-days me-2"></i><label for="fechaExpiracion" class="col-form-label">Fecha de Expiración</label>
              <input type="date" id="fechaExpiracion" name="fechaExpiracion" class="form-control"  data-target="fechaExpiracionTarjeta" {% if tarjeta.fecha_expiracion %} value="{{tarjeta.fecha_expiracion|safe}}" {% endif %}/>
              <input type="text" id="idTarjeta" name="idTarjeta" class="form-control" value="{{tarjeta.id}}"  hidden/>

            </div>
            
            <div class="col-3 col-md-3 col-sm-12">
              <div class="row" id="labelImagenSeleccionada" hidden>
                <div class="col">
                  <div class="row">
                    
                    <label class="col-form-label"><i class="fa-duotone fa-image me-2"></i>Imagen seleccionada</label>
                  </div>
                  <div class="row">

                    <label class="col-form-label text-muted" id="nombreImagenSeleccionada"></label>
                  </div>
                </div>
              </div>
              <div class="row container" id="selectorImagen">
                <div class="col">
                  <a href=""  title="subir-imagen" data-toggle="modal"  ><i class="fa-kit fa-solid-image-pen fa-4x"></i></a>
           

                  <input type="file" id="imagenTarjeta" name="imagenTarjeta" accept="image/*"
                  onchange="previsualizarImagen()" style="display:none">
                </div>
              </div>
            </div>
            </div>
            <div class="row mb-3">
              <div class="col-12 col-md-4">
              <label for="nombre" class="col-md-3 col-lg-3 col-form-label">Nombre</label>
                <input type="text" id="nombre" name="nombre" class="form-control"  value="{{tarjeta.nombre}}" placeholder="María Dolores" data-target="nameCard" maxlength="40" required/>
              </div>
              <div class="col-12 col-md-4">
              <label for="apellidos" class="col-md-3 col-lg-3 col-form-label">Apellidos</label>
                <input type="text" id="apellidos" name="apellidos" class="form-control" value="{{tarjeta.apellidos}}" placeholder="García Sánchez" data-target="lastNameCard" maxlength="40" required/>
              </div>
              <div class="col-12 col-md-4">
              <label for="dni" class="col-md-3 col-lg-3 col-form-label">DNI</label>
              <input type="text" id="dni" name="dni" class="form-control" value="{{tarjeta.dni}}" placeholder="11222333-A" data-target="idUserCard" maxlength="10" required/>
            </div>
            </div>
            <div class="row mb-3">
              <div class="col-12 col-md-4">
                <label for="accesoLaboratorios" class="col-form-label">Laboratorios</label>
                  <select class="form-control" id="accesoLaboratorios" name="accesoLaboratorios">
                    <option value="0" {% if tarjeta.acceso_laboratorios == 0 %} selected {%endif%}>No
                    </option>
                    <option value="1" {% if tarjeta.acceso_laboratorios == 1 %} selected {% endif %}>Si
                    </option>
                  </select>
              </div>


              <div class="col-12 col-md-4">
                <label for="accesoAlerta2" class="col-form-label">Centro de Alerta</label>
                  <select class="form-control" id="accesoAlerta2" name="accesoAlerta2">
                    <option value="0" {% if tarjeta.acceso_alerta2 == 0 %} selected {%endif%}>No
                    </option>
                    <option value="1" {% if tarjeta.acceso_alerta2 == 1 %} selected {%endif%}>Si
                    </option>
                  </select>
              </div>
              <div class="col-12 col-md-4">
                <label for="accesoCPD" class="col-form-label">Sala CPD</label>
                  <select class="form-control" id="accesoCPD" name="accesoCPD">
                    <option value="0" {% if tarjeta.acceso_cpd == 0 %} selected {%endif%}>No
                    </option>
                    <option value="1" {% if tarjeta.acceso_cpd == 1 %} selected {%endif%}>Si
                    </option>
                  </select>
              </div>
            </div>        
        </div>
        <div class="row mt-4">
          
          <div class="col-6 text-end">
            <button type="submit" class="btn bg-gradient-info mb-0">Guardar cambios</button>
          </div>
        </div>

      </div>
    </form><!-- End Profile Edit Form -->

    </div>
  </div>
  </div>


<script>
  // JavaScript para activar el input cuando se hace clic en el enlace
  document.querySelector("a[title='subir-imagen']").addEventListener("click", function (e) {
  e.preventDefault(); // Evita que el enlace redireccione
  document.getElementById("imagenTarjeta").click(); // Simula un clic en el input
});


    function previsualizarImagen() {
    var archivoInput = document.getElementById('imagenTarjeta');
    var imagenPrevia = document.getElementById('imagenActual');
    var selector = document.getElementById('selectorImagen');
    var etiqueta = document.getElementById('labelImagenSeleccionada');
    var nombreImagen = document.getElementById('nombreImagenSeleccionada');

    if (archivoInput.files && archivoInput.files[0]) {
      var lector = new FileReader();

      lector.onload = function(e) {
        imagenPrevia.src = e.target.result;
        imagenPrevia.style.display = 'block';
      }
      selector.style.display = 'none';
      //eliminar atributo hidden de la etiqueta
      etiqueta.removeAttribute("hidden");
      nombreImagen.innerHTML = archivoInput.files[0].name;

      lector.readAsDataURL(archivoInput.files[0]);
    } else {
      imagenPrevia.src = '';
      imagenPrevia.style.display = 'none';
    }
  }



</script>
{% endblock %}
