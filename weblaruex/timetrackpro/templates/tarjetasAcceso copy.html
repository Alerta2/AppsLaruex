{% extends "base/base_timetrackpro.html" %}
{% load static %}

{% block imports %}

    <!-- fullcalendar-->
  <!-- <script src='https://cdn.jsdelivr.net/npm/fullcalendar-scheduler@6.1.9/index.global.min.js'></script> -->
  <link rel="stylesheet" href="{% static 'css/timetrackpro/fullcalendar/fullcalendar.css' %}" />
  <script src="{% static 'js/timetrackpro/fullcalendar/fullcalendar.js' %}"></script>
  <script src="{% static 'js/timetrackpro/fullcalendar/fullcalendar_es.js' %}"></script>
  <link rel="stylesheet" href="{% static 'css/timetrackpro/fullcalendar/calendario_mesual.css' %}" />


    <!-- disponible para configuración servidor-->
    <!-- <link rel="stylesheet" href="{% static 'css/timetrackpro/fullcalendar/fullcalendar.css' %}" /> -->
{% endblock %}
{% block content %}

<div class="row">
  <div class="col-lg-12">
    <div class="row">
      <div class="col-xl-6 col-lg-6 mb-xl-0 mb-6">
        <div class="row">
          <div class="col-xl-6 mb-xl-0 mb-6">
            <h5 class="mt-4 pb-2">Anverso</h5>
            <div class="card bg-transparent shadow-xl card-anverso-mostrar"  >
              <div class="overflow-hidden position-relative border-radius-xl background-timetrackpro-home" >
                <span class="mask bg-gradient-dark"></span>
                <div class="card-body position-relative z-index-1 p-3">
                  <div class="d-flex align-items-center" >
                    
                    <div class="ms-auto w-20 d-flex align-items-center justify-content-start mt-2">
                      <img class="w-60" src="{% static '/img/logos/uex_logo.png'%}" alt="logo">
                    </div>
                    <div class="d-flex">
                      <div class="me-4">
                        <h6 class="text-white text-xs text-center my-auto">LABORATORIO DE RADIACTIVIDAD AMBIENTAL DE LA UNIVERSIDAD DE EXTREMADURA</h6>
                      </div>
                    </div>
                  </div>
                  
                  <div class="d-flex justify-content-start ms-auto mt-2">
                    <div class="w-20 ms-4 d-flex align-items-center">
                      <img class="w-100 rounded" id="imagenPrevia" src="{% static '/img/empleados/1_usuario.png'%}" alt="foto_empleado">
                    </div>
                    <div class="d-flex align-items-center ms-3">
                      <div >
                        <p class="text-white text-sm opacity-8 mb-0 text-uppercase">Tarjeta de acceso</p>
                        <h6 class="text-white mb-1" id="nameCard">Mª Dolores</h6>
                        <h6 class="text-white mb-1" id="lastNameCard">Sánchez García</h6>
                        <h6 class="text-white mb-0" id="idUserCard">11.222.222-T</h6>
                      </div>
                    </div>
                  </div>
                  
                  <div class="d-flex justify-content-end mt-2">
                    <div class="d-flex justify-content-end">
                        <div class="ms-auto w-20 d-flex align-items-center justify-content-end">
                          <img class="h-55 me-2" src="{% static '/img/logos/alerta2_logo.png'%}" alt="logo_alerta2">
                          <img class="w-95" src="{% static '/img/logos/laruex_logo.png'%}" alt="logo_laruex">

                        </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>  
      </div>
      <div class="col-lg-6 col-lg-6 mb-xl-0 mb-6">
        <div class="row">
          <div class="col-xl-6 mb-xl-0 mb-6">
            
            <h5 class="mt-4 pb-2">Reverso</h5>
            <div class="card bg-transparent shadow-xl card-reverso-mostrar">
              <div class="overflow-hidden position-relative border-radius-xl background-timetrackpro-home" >
                <span class="mask bg-gradient-dark"></span>
                <div class="card-body position-relative z-index-1 p-3">
                  <div class="w-20 d-flex align-items-center">

                    <img class="w-75 me-2" src="{% static '/img/logos/laruex_logo.png'%}" alt="logo_laruex">

                    <img class="w-100" src="{% static '/img/logos/alerta2_logo.png'%}" alt="logo_alerta2">

                  </div>

                  <div class="text-center mt-2">
                    <p class="text-white text-xs">{{infoGeneralTarjeta}}<br>{{infoPersonalTarjeta}}<br>{{infoContactoTarjeta}}</p>
                  </div>
                  <div class="d-flex">
                    <div class="me-4">
                      <p class="text-white text-xs opacity-8 mb-0">Expira</p>
                      <h6 class="text-white mb-0" id="fechaExpiracionTarjeta">11/22</h6>
                    </div>
                    <div>
                      <p class="text-white text-xs opacity-8 mb-0">ID tarjeta</p>
                      <h6 class="text-white mb-0" id="idCard">4562 5566</h6>
                    </div>
                    
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    <div class="row">
    <div class="col-md-12 mb-lg-0 mb-4">
      <div class="card mt-4">
                    <!-- Edit Form -->
      <form id="formularioAgregarTarjetaAcceso"  action="/private/timetrackpro/agregar-tarjeta" method="POST" enctype="multipart/form-data">
      {% csrf_token %}
        <div class="card-header pb-0 p-3">
          <div class="row">
            <div class="col-6 d-flex align-items-center">
              <h6 class="mb-0">Datos de la tarjeta</h6>
            </div>
            <div class="col-6 text-end">
              <button type="submit" class="btn bg-gradient-dark mb-0"><i class="fas fa-plus"></i>&nbsp;&nbsp; Guardar datos</button>
            </div>
          </div>
        </div>
        <div class="card-body p-3">
          <div class="row">
            <div class="row  d-flex align-items-center justify-content-start mb-3">
              <div class="col-4 col-md-4 col-sm-12" >
                <i class="fa-duotone fa-address-card me-2"></i><label for="idTarjeta" class="col-form-label">ID Tarjeta</label>

                <input type="text" id="idTarjeta" name="idTarjeta" class="form-control" data-target="idCard" pattern="{0-9}[8]" maxlength="8" placeholder="1111-5555" required/>
              </div>
              <div class="col-4 col-md-4 col-sm-12" >
                <i class="fa-duotone fa-calendar-days me-2"></i><label for="fechaExpiracion" class="col-form-label">Fecha de Expiración</label>
                <input type="date" id="fechaExpiracion" name="fechaExpiracion" class="form-control"  data-target="fechaExpiracionTarjeta"/>
                <input type="date" id="fechaActual" name="fechaActual" class="form-control" hidden/>
              </div>
              
              <div class="col">
                <div class="row" id="labelImagenSeleccionada" hidden>
                  <div class="col">
                    <div class="row">
                      
                      <label class="col-form-label"><i class="fa-duotone fa-image me-2"></i>Imagen seleccionada</label>
                    </div>
                    <div class="row">

                      <label class="col-form-label text-muted" id="nombreImagenSeleccionada"></label>
                    </div>
                  </div>
                </div>
                <div class="row container" id="selectorImagen">
                  <div class="col">
                    
                    <a href=""  title="subir-imagen" data-toggle="modal"  ><i id="iconoInput" class="fa-duotone fa-camera-retro fa-beat fa-4x"></i></a>
            

                    <input type="file" id="imagenTarjeta" name="imagenTarjeta" accept="image/*"
                    onchange="previsualizarImagen()" style="display:none">
                    <!-- <label class="custom-file-upload" for="imagenTarjeta">
                      Seleccionar una foto
                    </label>
                    <input type="file" id="imagenTarjeta" name="imagenTarjeta" accept="image/*" onchange="previsualizarImagen()" style="display:none" required> -->
                  </div>
                </div>
              </div>
              </div>
              <div class="row mb-3">
                <div class="col-12 col-md-4">
                <label for="nombre" class="col-md-3 col-lg-3 col-form-label">Nombre</label>
                  <input type="text" id="nombre" name="nombre" class="form-control" placeholder="María Dolores" data-target="nameCard" maxlength="40" required/>
                </div>
                <div class="col-12 col-md-4">
                <label for="apellidos" class="col-md-3 col-lg-3 col-form-label">Apellidos</label>
                  <input type="text" id="apellidos" name="apellidos" class="form-control" placeholder="García Sánchez" data-target="lastNameCard" maxlength="40" required/>
                </div>
                <div class="col-12 col-md-4">
                <label for="dni" class="col-md-3 col-lg-3 col-form-label">DNI</label>
                <input type="text" id="dni" name="dni" class="form-control" placeholder="11222333-A" data-target="idUserCard" maxlength="10" required/>
              </div>
              </div>
              <div class="row mb-3">
                <div class="col-12 col-md-4">
                  <label for="accesoLaboratorios" class="col-form-label">Laboratorios</label>
                    <select class="form-control" id="accesoLaboratorios" name="accesoLaboratorios">
                      <option value="0" selected>No
                      </option>
                      <option value="1">Si
                      </option>
                    </select>
                </div>


                <div class="col-12 col-md-4">
                  <label for="accesoAlerta2" class="col-form-label">Centro de Alerta</label>
                    <select class="form-control" id="accesoAlerta2" name="accesoAlerta2">
                      <option value="0" selected>No
                      </option>
                      <option value="1">Si
                      </option>
                    </select>
                </div>
                <div class="col-12 col-md-4">
                  <label for="accesoCPD" class="col-form-label">Sala CPD</label>
                    <select class="form-control" id="accesoCPD" name="accesoCPD">
                      <option value="0" selected>No
                      </option>
                      <option value="1">Si
                      </option>
                    </select>
                </div>
              </div>           
          </div>

        </div>
      </form><!-- End Profile Edit Form -->

      </div>
    </div>
    </div>
  </div>
</div>
<div class="row">
  <div class="col-md-6 mt-4">
    <div class="card h-max-100 h-auto mb-4">
      <div class="card-header pb-0 px-3">
        <div class="row">
          <div class="col-md-6">
            
            <h6 class="mb-0"><i class="fa-duotone fa-credit-card text-success text-gradient"></i> &nbsp; Tarjetas activadas</h6>
          </div>
          
        </div>
      </div>
      <div class="card-body pt-4 p-3">
          <ul class="list-group">
            {% for t in tarjetasAccesoActivas %}
            <li class="list-group-item border-0 d-flex justify-content-between ps-0 mb-2 border-radius-lg">
              <div class="d-flex align-items-center">
                <button class="btn btn-icon-only btn-rounded btn-outline-success mb-0 me-3 btn-sm d-flex align-items-center justify-content-center"disabled><i class="fa-solid fa-user"></i></button>
                <div class="d-flex flex-column">
                  <h6 class="mb-1 text-dark text-sm">{{t.nombre}}  {{t.apellidos}}</h6>
                  <span class="text-sm"><i class="fa-duotone fa-credit-card"></i> {{t.id_tarjeta}}</span>
                </div>
              </div>
              <div class="d-flex align-items-center text-success text-gradient text-sm font-weight-bold">
                {{t.fecha_alta}}
              </div>
            </li>
  
            
  
            {% endfor %}
          
          </ul>
          <div class="pagination">
            <span class="step-links mx-auto">
              {% if tarjetasAccesoActivas.has_previous %}
              <a href="?page=1"><i class="fa-solid fa-forward fa-rotate-180"></i>&nbsp;</a>
              <a href="?page={{ tarjetasAccesoActivas.previous_page_number }}"><i class="fa-solid fa-forward-step fa-rotate-180"></i></a>
              {% endif %}
              <span class="current">
                &nbsp;Página {{ tarjetasAccesoActivas.number }} de {{ tarjetasAccesoActivas.paginator.num_pages }}&nbsp;
              </span>


      
      
              {% if tarjetasAccesoActivas.has_next %}
                  <a href="?page={{ tarjetasAccesoActivas.next_page_number }}"><i class="fa-solid fa-forward-step"></i>&nbsp;</a>
                  <a href="?page={{ tarjetasAccesoActivas.paginatorActivas.numeroPaginaActiva }}"><i class="fa-solid fa-forward"></i></a>
              {% endif %}
            </span>
          </div>
      </div>
    </div>
  </div>
  
  <div class="col-md-6 mt-4">
    <div class="card h-max-100 h-auto mb-4">
      <div class="card-header pb-0 px-3">
        <div class="row">
          <div class="col-md-6">
            
            <h6 class="mb-0"><i class="fa-duotone fa-credit-card  text-danger text-gradient"></i> &nbsp;Tarjetas inactivas</h6>
          </div>
          
        </div>
      </div>

      
      <div class="card-body pt-4 p-3">
        <ul class="list-group">
          {% for t in tarjetasAccesoInactivas %}
          <li class="list-group-item border-0 d-flex justify-content-between ps-0 mb-2 border-radius-lg">
            <div class="d-flex align-items-center">
              <button class="btn btn-icon-only btn-rounded btn-outline-danger mb-0 me-3 btn-sm d-flex align-items-center justify-content-center" disabled><i class="fa-solid fa-user"></i></button>
              <div class="d-flex flex-column">
                <h6 class="mb-1 text-dark text-sm">{{t.nombre}} {{t.apellidos}}</h6>
                <span class="text-sm"><i class="fa-duotone fa-credit-card"></i> {{t.id_tarjeta}}</span>
              </div>
            </div>
            <div class="d-flex align-items-center text-danger text-gradient text-sm font-weight-bold">
              {{t.fecha_alta}}
            </div>
          </li>
          {% endfor %}
        </ul>
        

        <div class="pagination">
          <span class="step-links mx-auto">
            {% if tarjetasAccesoInactivas.has_previous %}
            <a href="?page=1"><i class="fa-solid fa-forward fa-rotate-180"></i>&nbsp;</a>
            <a href="?page={{ tarjetasAccesoInactivas.previous_page_number }}"><i class="fa-solid fa-forward-step fa-rotate-180"></i></a>
            {% endif %}
              <span class="current">
                &nbsp;Página {{ tarjetasAccesoInactivas.number }} de {{ tarjetasAccesoInactivas.paginator.num_pages }}&nbsp;
              </span>
    
            {% if tarjetasAccesoInactivas.has_next %}
                <a href="?page={{ tarjetasAccesoInactivas.next_page_number }}"><i class="fa-solid fa-forward-step"></i>&nbsp;</a>
                <a href="?page={{ tarjetasAccesoInactivas.paginator.num_pages }}"><i class="fa-solid fa-forward"></i></a>
            {% endif %}
              </span>
          </span>
          
      </div>
      </div>
    </div>
  </div>
</div>


<script>
  // JavaScript para activar el input cuando se hace clic en el enlace
  document.querySelector("a[title='subir-imagen']").addEventListener("click", function (e) {
  e.preventDefault(); // Evita que el enlace redireccione
  document.getElementById("imagenTarjeta").click(); // Simula un clic en el input
});

function previsualizarImagen() {
  var archivoInput = document.getElementById('imagenTarjeta');
  var imagenPrevia = document.getElementById('imagenPrevia');
  var selector = document.getElementById('selectorImagen');
  var etiqueta = document.getElementById('labelImagenSeleccionada');
  var nombreImagen = document.getElementById('nombreImagenSeleccionada');
  var iconoInput = document.getElementById('iconoInput');
  if (archivoInput.files && archivoInput.files[0]) {
    var lector = new FileReader();

    lector.onload = function(e) {
      imagenPrevia.src = e.target.result;
      imagenPrevia.style.display = 'block';
    }
    selector.style.display = 'none';
    //eliminar atributo hidden de la etiqueta
    etiqueta.removeAttribute("hidden");
    nombreImagen.innerHTML = archivoInput.files[0].name;

    lector.readAsDataURL(archivoInput.files[0]);

    iconoInput.setAttribute("hidden", "true");
  } else {
    imagenPrevia.src = '';
    imagenPrevia.style.display = 'none';
  }
}

// funcion para mostrar los datos ingresados 
// Obtén una lista de todos los campos de entrada
var camposDeEntrada = document.querySelectorAll('input[data-target]');

// Agrega un evento 'input' a cada campo de entrada
camposDeEntrada.forEach(function (campo) {
  campo.addEventListener('input', function () {
    var targetId = campo.getAttribute('data-target');
    var elementoDestino = document.getElementById(targetId);

    if (elementoDestino) {
      if (targetId == "fechaExpiracionTarjeta") {
        var fecha = campo.value;
        var partesFecha = fecha.split('-');
        var dia = partesFecha[2];
        var mes = partesFecha[1];
        var fechaFormateada = dia + '/' + mes;
        elementoDestino.textContent = fechaFormateada;
      }else if (targetId == "idCard"){
        var idTarjeta = campo.value;
        var subcadenas = idTarjeta.match(/.{1,4}/g).join("-");
        elementoDestino.textContent = subcadenas;


      }else if(targetId == "idUserCard"){
        var dni = campo.value;
        var letra ="";
        var numero = "";
        if (dni.includes("-")){
          numero = dni.split("-")[0];
          letra = dni.split("-")[1];
        }else{
          numero = dni.slice(0,8);
          letra = dni.slice(8,9);
        }
          // Dividir el DNI en las partes relevantes
        var resultadoDNI = numero + "-" + letra;
        elementoDestino.textContent = resultadoDNI;
      }
      else{
        elementoDestino.textContent = campo.value;

      }
    }
  });
});

document.getElementById("fechaActual").valueAsDate = new Date();

</script>
{% endblock %}



  
