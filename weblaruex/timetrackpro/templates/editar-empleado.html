{% extends "base/base_timetrackpro.html" %}
{% load static %}
{% block content %}
<div class="page-header min-vh-75">
  <div class="container filaForm">
    <div class="row d-flex align-items-center">
      <div class="col-md-4">
        <div class="d-block shadow-xl border-radius-xl" style="position: relative; display: inline-block;">
          <img  id="actual-imagen-empleado" src="{% static 'img/timetrackpro/usuarios/' %}{{empleado.id_usuario.img}}" alt="img-blur-shadow" class="img-fluid shadow border-radius-xl" style="max-width: 100%; height: auto;">
            <a href=""  title="subir-imagen-empleado" data-toggle="modal" data-target="#modalFormulario" ><i class="fa-kit fa-solid-image-pen fa-2xl" style="position: absolute; bottom: 1.5rem; right: 0.625rem;"></i></a>
           

            <input type="file" id="fotoEmpleadoSeleccionado" name="fotoEmpleadoSeleccionado" accept="image/*"
            onchange="previsualizarImagenEmpleado()" style="display:none">
        </div>
      </div>
      <div class="col-lg-8">
        <form action="{% url 'timetrackpro:editar-empleado' id=empleado.id_usuario.id %}" method="POST"
          enctype="multipart/form-data">
          {% csrf_token %}
          <div class="accordion" id="accordionEditarEmpleado">

            <!-- DATOS DE REGISTRO -->
            <div class="accordion-item">
              <h2 class="accordion-header" id="headingDatosRegistro">
                <button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#collapseDatosRegistro" aria-expanded="true" aria-controls="collapseDatosRegistro">
                  <h3 class="font-weight-bolder text-danger text-gradient">Editar Datos de registro de jornada</h3>
                </button>
              </h2>
              <div id="collapseDatosRegistro" class="accordion-collapse collapse show" aria-labelledby="headingDatosRegistro" data-bs-parent="#accordionEditarEmpleado">
                <div class="accordion-body">            
                    <div class="row">
                      <div class="col-xl-2">
                        <label>ID</label>
                        <input type="text" class="form-control" placeholder="ID en el dispositivo"
                          aria-label="Nombre en el dispositivo" id="id_empleado_maquina" name="id_empleado_maquina"
                          aria-describedby="text-addon" id="id_empleado_maquina" name="id_empleado_maquina" value="{{empleado.id_empleado.id}}">
                      </div>
                      <div class="col-xl-4">
                        <label>Nombre</label>
                        <input type="text" class="form-control" placeholder="Nombre en el dispositivo"
                          aria-label="Nombre en el dispositivo" id="nombre_empleado_maquina" name="nombre_empleado_maquina"
                          aria-describedby="text-addon" value="{{empleado.id_empleado.nombre}}">
                      </div>
                      <div class="col-xl-4">
                        <label>¿Empleado en prácticas?</label>
                        <div class="form-switch ps-1 my-2">
                          <input class="form-check-input ms-auto" type="checkbox" {% if empleado.id_empleado.en_practicas %} checked {% endif %} id="en_practicas" name="en_practicas">
                        </div>
                      </div>
                    </div>
                    <div class="row mt-4">
                      <div class="col-xl-3">
                        <label>Turno</label>
                        <select class="form-control" aria-label="Nombre en el dispositivo" id="turno_empleado"
                          name="turno_empleado" aria-describedby="text-addon">
                          {% if empleado.id_empleado.turno %}
                          <option value="{{empleado.id_empleado.turno}}" selected hidden>{{empleado.id_empleado.turno}}
                          </option>
                          {% else %}
                          <option value="Sin asignar" selected hidden>Sin asignar</option>
                          {% endif %}
                          <option value="Mañana">Mañana</option>
                          <option value="Tarde">Tarde</option>
                          <option value="Turno Partido">Turno Partido</option>
                        </select>
                      </div>
                      <div class="col-xl-3">
                        <label>Jornada Máxima</label>
                        <input class="form-control" type="number" step="0.5" id="jornada_maxima_empleado"
                          name="jornada_maxima_empleado" value="{{empleado.id_empleado.horas_maxima_contrato|safe}}">
                      </div>
                    </div>
                    <div class="row mt-4">
                      <div class="col-xl-12">
                        <label class="d-inline">Dispositivos donde puede fichar</label>
                        <div class="d-inline form-switch ps-0">
                          <label class="form-check-label text-body ms-3 text-truncate w-80 mb-0 d-inline">Alerta2</label>
                          <input class="form-check-input ms-auto" type="checkbox"  {% if empleado.id_empleado.maquina_alerta2 %} checked {% endif %} id="maquina_alerta2" name="maquina_alerta2"> 
                        </div>
                        <div class="d-inline form-switch ps-0">
                          <label class="form-check-label text-body ms-3 text-truncate w-80 mb-0 d-inline">Laboratorio</label>
                          <input class="form-check-input ms-auto" type="checkbox" {% if empleado.id_empleado.maquina_laboratorio %} checked {% endif %} id="maquina_laboratorio" name="maquina_laboratorio">
                        </div>
                        <div class="d-inline form-switch ps-0">
                          <label class="form-check-label text-body ms-3 text-truncate w-80 mb-0 d-inline">Departamento</label>
      
                          <input class="form-check-input ms-auto" type="checkbox" {% if empleado.id_empleado.maquina_departamento %} checked {% endif %} id="maquina_departamento" name="maquina_departamento">
                        </div>
                      </div>
                    </div>
                </div>
              </div>
            </div>
            
            <!-- DATOS PERSONALES -->
            <div class="accordion-item">
              <h2 class="accordion-header" id="headingDatosPersonales">
                <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseDatosPersonales" aria-expanded="false" aria-controls="collapseDatosPersonales">
                  <h3 class="font-weight-bolder text-danger text-gradient">Editar Datos Personales</h3>
                </button>
              </h2>
              <div id="collapseDatosPersonales" class="accordion-collapse collapse" aria-labelledby="headingDatosPersonales" data-bs-parent="#accordionEditarEmpleado">
                <div class="accordion-body">
                  
                    <div class="row">

                      <div class="col-xl-3">
                        <label>DNI</label>
                        <div class="mb-3">
                          <input type="text" class="form-control" placeholder="12345678-A" aria-label="DNI del empleado"
                            id="dni_empleado" name="dni_empleado" aria-describedby="text-addon"
                            value="{{empleado.id_usuario.dni}}">
                        </div>
                      </div>

                      <div class="col-xl-4">
                        <label>Nombre</label>
                        <div class="mb-3">
                          <input type="text" class="form-control" placeholder="Nombre completo" aria-label="Nombre"
                            aria-describedby="text-addon" name="nombre_empleado" id="nombre_empleado"
                            value="{{empleado.id_usuario.nombre}}">
                        </div>
                      </div>
                      <div class="col-xl-5">
                        <label>Apellidos</label>
                        <div class="mb-3">
                          <input type="text" class="form-control" placeholder="Apellidos" aria-label="Apellidos del empleado"
                            aria-describedby="text-addon" name="apellidos_empleado" id="apellidos_empleado"
                            value="{{empleado.id_usuario.apellidos}}">
                        </div>
                      </div>
                    </div>

                    <div class="row">
                      <div class="col-xl-3">
                        <label>Fecha de Alta</label>
                        <div class="mb-3">
                          <input type="date" class="form-control" aria-label="Nombre en el dispositivo"
                            aria-describedby="text-addon" name="fecha_alta_app" id="fecha_alta_app"
                            value="{{empleado.id_usuario.fecha_alta_app|safe}}">
                        </div>
                      </div>
                      
                      <div class="col-xl-6">
                        <label>Puesto</label>
                        <div class="mb-3">
                          <input type="text" class="form-control" placeholder="Nombre en el dispositivo"
                            aria-label="Nombre en el dispositivo" aria-describedby="text-addon" name="puesto_empleado"
                            id="puesto_empleado" value="{{empleado.id_usuario.puesto}}">
                        </div>
                      </div>
                      <div class="col-xl-3">
                        <label>Extension</label>
                        <div class="mb-3">
                          <input type="text" class="form-control" placeholder="66656" id="extension_empleado"
                            name="extension_empleado" aria-label="Extensión" aria-describedby="text-addon"
                            value="{% if empleado.id_usuario.extension %}{{empleado.id_usuario.extension}}{% endif %}">
                        </div>
                      </div>
                    </div>
                    <div class="row">
                      <div class="col-xl-3">
                        <label>Fecha de Nacimiento</label>
                        <div class="mb-3">
                          <input type="date" class="form-control" aria-label="Nombre en el dispositivo"
                            aria-describedby="text-addon" name="fechaNacimiento_empleado" id="fechaNacimiento_empleado"
                            value="{% if empleado.id_usuario.fecha_nacimiento %}{{empleado.id_usuario.fecha_nacimiento|safe}}{% endif %}">
                        </div>
                      </div>
                      <div class="col-xl-6">
                        <label>Dirección</label>
                        <div class="mb-3">
                          <input type="text" class="form-control" placeholder="Calle Principal 3 3ºB"
                            aria-label="Dirección del empleado" aria-describedby="text-addon" name="direccion_empleado"
                            id="direccion_empleado" value="{% if empleado.id_usuario.direccion %}{{empleado.id_usuario.direccion}}{% endif %}">
                        </div>
                      </div>
                      <div class="col-xl-3">
                        <label>Teléfono</label>
                        <div class="mb-3">
                          <input type="text" class="form-control" placeholder="666555255" id="telefono" name="telefono"
                            aria-label="Teléfono" aria-describedby="text-addon" value="{% if empleado.id_usuario.telefono %}{{empleado.id_usuario.telefono}}{% endif %}">
                        </div>
                      </div>
                    </div>
                    <div class="row">
                      <div class="col-xl-3">
                        <label>Teléfono secundario</label>
                        <div class="mb-3">
                          <input type="text" class="form-control" placeholder="666555255" id="telefono2" name="telefono2"
                            aria-label="Teléfono 2" aria-describedby="text-addon" value="{% if empleado.id_usuario.telefono2 %}{{empleado.id_usuario.telefono2}}{% endif %}">
                        </div>
                      </div>
                      <div class="col-xl-4">
                        <label>Email</label>
                        <div class="mb-3">
                          <input type="email" class="form-control" placeholder="correo@correo.es" id="email" name="email"
                            aria-label="Email" aria-describedby="email-addon" value="{% if empleado.id_usuario.email %}{{empleado.id_usuario.email}}{% endif %}">
                        </div>
                      </div>
                      <div class="col-xl-5">
                        <label>Email secundario</label>
                        <div class="mb-3">
                          <input type="email" class="form-control" placeholder="correo@correo.es" id="email2" name="email2"
                            aria-label="Email" aria-describedby="email-addon" value="{% if empleado.id_usuario.email2 %}{{empleado.id_usuario.email2}}{% endif %}">
                        </div>
                      </div>
                    </div>
                    <div class="row d-flex align-items-center">
                      <div class="col-xl-12">
                        <label>Información adicional</label>
                        <div class="mb-3">
                          <textarea type="text" class="form-control"
                            placeholder="Agrege la información adicional del empleado"
                            aria-label="Información adicional del empleado" id="infoAdicional_empleado"
                            name="infoAdicional_empleado"
                            aria-describedby="text-addon">{% if empleado.id_usuario.info_adicional %}{{empleado.id_usuario.info_adicional}}{% endif %}</textarea>
                        </div>
                      </div>
                    </div>

                </div>
              </div>
            </div>

            <!-- DATOS DE LA TARJETA DE ACCESO -->
            <div class="accordion-item">
              <h2 class="accordion-header" id="headingDatosTarjeta">
                <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseDatosTarjeta" aria-expanded="false" aria-controls="collapseDatosTarjeta">
                  <h3 class="font-weight-bolder text-danger text-gradient">Editar Datos Tarjeta de acceso</h3>
                </button>
              </h2>
              <div id="collapseDatosTarjeta" class="accordion-collapse collapse" aria-labelledby="headingDatosTarjeta" data-bs-parent="#accordionEditarEmpleado">
                <div class="accordion-body">                  
                  <div class="row">

                    <div class="col-xl-3">
                      <label>ID Tarjeta</label>
                      <div class="mb-3">
                        <input type="text" class="form-control" aria-label="DNI del empleado"
                          id="id_tarjeta" name="id_tarjeta" aria-describedby="text-addon"
                          value="{{empleado.id_tarjeta_acceso.id_tarjeta}}">
                      </div>
                    </div>
                    
                    <div class="col-xl-3">
                      <label>Fecha de Alta</label>
                      <div class="mb-3">
                        <input type="date" class="form-control" aria-label="Nombre en el dispositivo"
                          aria-describedby="text-addon" name="fecha_alta_tarjeta" id="fecha_alta_tarjeta"
                          value="{{empleado.id_tarjeta_acceso.fecha_alta|safe}}">
                      </div>
                    </div>
                    
                    <div class="col-xl-3">
                      <label>Fecha validez</label>
                      <div class="mb-3">
                        <input type="date" class="form-control" aria-label="Nombre en el dispositivo"
                          aria-describedby="text-addon" name="fecha_baja_tarjeta" id="fecha_baja_tarjeta"
                          value="{{empleado.id_tarjeta_acceso.fecha_baja|safe}}">
                      </div>
                    </div>
                    
                    <div class="col-xl-3">
                      <label>¿La tarjeta está activa?</label>
                      <div class="form-switch ps-1 my-2">
                        <input class="form-check-input ms-auto" type="checkbox" {% if empleado.id_tarjeta_acceso.activo %} checked {% endif %} name="tarjeta_activa" id="tarjeta_activa">
                      </div>
                    </div>

                  </div>
                                   
                  <div class="row">
                    <div class="col-xl-3">
                      <label>DNI</label>
                      <div class="mb-3">
                        <input type="text" class="form-control" aria-label="DNI del empleado" aria-describedby="text-addon" value="{{empleado.id_tarjeta_acceso.dni}}">
                      </div>
                    </div>

                    <div class="col-xl-4">
                      <label>Nombre</label>
                      <div class="mb-3">
                        <input type="text" class="form-control" placeholder="Nombre completo" aria-label="Nombre"
                          aria-describedby="text-addon" name="nombre_empleado_tarjeta" id="nombre_empleado_tarjeta"
                          value="{{empleado.id_tarjeta_acceso.nombre}}">
                      </div>
                    </div>
                    <div class="col-xl-5">
                      <label>Apellidos</label>
                      <div class="mb-3">
                        <input type="text" class="form-control" placeholder="Apellidos" aria-label="Apellidos del empleado"
                          aria-describedby="text-addon" name="apellidos_empleado_tarjeta" id="apellidos_empleado_tarjeta"
                          value="{{empleado.id_tarjeta_acceso.apellidos}}">
                      </div>
                    </div>
                  </div>
                  <div class="row mt-4 mb-4">
                      <div class="col-xl-12">
                        <label class="d-inline">Puede acceder a</label>
                        <div class="d-inline form-switch ps-0">
                          <label class="form-check-label text-body ms-3 text-truncate w-80 mb-0 d-inline">Alerta2</label>
                          <input class="form-check-input ms-auto" type="checkbox" {% if empleado.id_tarjeta_acceso.acceso_alerta2 %} checked {% endif %} id="acceso_alerta2" name="acceso_alerta2">
                        </div>
                        <div class="d-inline form-switch ps-0">
                          <label class="form-check-label text-body ms-3 text-truncate w-80 mb-0 d-inline">Laboratorio</label>
                          <input class="form-check-input ms-auto" type="checkbox" {% if empleado.id_tarjeta_acceso.acceso_laboratorios %} checked {% endif %} id="acceso_laboratorio" name="acceso_laboratorio">
                        </div>
                        <div class="d-inline form-switch ps-0">
                          <label class="form-check-label text-body ms-3 text-truncate w-80 mb-0 d-inline">CPD</label>
      
                          <input class="form-check-input ms-auto" type="checkbox" {% if empleado.id_tarjeta_acceso.acceso_cpd %} checked {% endif %} id="acceso_cpd" name="acceso_cpd">
                        </div>
                      </div>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <div class="text-center">
            <button type="submit" value="submit" class="btn bg-gradient-danger w-100 mt-4 mb-0">Guardar</button>
          </div>
        </form>
      </div>

    </div>
  </div>
</div>


<script>
  // JavaScript para activar el input cuando se hace clic en el enlace
document.querySelector("a[title='subir-imagen-empleado']").addEventListener("click", function (e) {
  e.preventDefault(); // Evita que el enlace redireccione
  document.getElementById("fotoEmpleadoSeleccionado").click(); // Simula un clic en el input
});

// Función para previsualizar la imagen seleccionada
function previsualizarImagenEmpleado() {
  var input = document.getElementById("fotoEmpleadoSeleccionado");
  var imagen = document.getElementById("actual-imagen-empleado");

  if (input.files && input.files[0]) {
    var reader = new FileReader();
    reader.onload = function(e) {
      imagen.src = e.target.result;
    };
    reader.readAsDataURL(input.files[0]);
  }
}
</script>

{% endblock %}