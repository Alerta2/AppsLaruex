{% extends "base/base_spida.html" %}
{% load crispy_forms_tags %}
{% load static %}



{% block imports %}
<link rel="stylesheet" href="{% static 'css/spida/docu-eventos.css' %}" />

<!--<link rel="stylesheet" type="text/css" href="{% static 'css/spida/data-table.css' %}"/>-->
  
<script type="text/javascript" src="{% static 'js/spida/rolldate.js' %}"></script>
<link rel="stylesheet" href="{% static 'css/spida/rolldate.css' %}" />


<!-- Moment.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.23.0/moment.min.js" integrity="sha256-VBLiveTKyUZMEzJd6z2mhfxIqz3ZATCuVMawPZGzIfA=" crossorigin="anonymous"></script>

<!-- Tempus Dominus Bootstrap 4 -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/tempusdominus-bootstrap-4/5.1.2/css/tempusdominus-bootstrap-4.min.css" integrity="sha256-XPTBwC3SBoWHSmKasAk01c08M6sIA5gF5+sRxqak2Qs=" crossorigin="anonymous" />
<script src="https://cdnjs.cloudflare.com/ajax/libs/tempusdominus-bootstrap-4/5.1.2/js/tempusdominus-bootstrap-4.min.js" integrity="sha256-z0oKYg6xiLq3yJGsp/LsY9XykbweQlHl42jHv2XTBz4=" crossorigin="anonymous"></script>


<!--<script src="https://unpkg.com/bootstrap-table@1.18.3/dist/bootstrap-table.min.js"></script>-->
<!--Bootstrap Table-->
<link href="https://unpkg.com/bootstrap-table@1.18.3/dist/bootstrap-table.min.css" rel="stylesheet">
<script src="https://unpkg.com/tableexport.jquery.plugin/tableExport.min.js"></script>
<script src="https://unpkg.com/bootstrap-table@1.18.3/dist/bootstrap-table.min.js"></script>
<script src="https://unpkg.com/bootstrap-table@1.18.3/dist/bootstrap-table-locale-all.min.js"></script>
<script src="https://unpkg.com/bootstrap-table@1.18.3/dist/extensions/export/bootstrap-table-export.min.js"></script>


 
 <!-- the fileinput plugin styling CSS file -->
 <link href="https://cdn.jsdelivr.net/gh/kartik-v/bootstrap-fileinput@5.2.3/css/fileinput.min.css" media="all" rel="stylesheet" type="text/css" />

 <!-- alternatively you can use the font awesome icon library if using with `fas` theme (or Bootstrap 4.x) by uncommenting below. -->
 <!--<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.15.3/css/all.css" crossorigin="anonymous">-->


  <!-- if using RTL (Right-To-Left) orientation, load the RTL CSS file after fileinput.css by uncommenting below -->
 <!-- link href="https://cdn.jsdelivr.net/gh/kartik-v/bootstrap-fileinput@5.2.3/css/fileinput-rtl.min.css" media="all" rel="stylesheet" type="text/css" /-->
 
 <!-- piexif.min.js is needed for auto orienting image files OR when restoring exif data in resized images and when you
     wish to resize images before upload. This must be loaded before fileinput.min.js -->
 <script src="https://cdn.jsdelivr.net/gh/kartik-v/bootstrap-fileinput@5.2.3/js/plugins/piexif.min.js" type="text/javascript"></script>
 
 <!-- sortable.min.js is only needed if you wish to sort / rearrange files in initial preview. 
     This must be loaded before fileinput.min.js -->
 <script src="https://cdn.jsdelivr.net/gh/kartik-v/bootstrap-fileinput@5.2.3/js/plugins/sortable.min.js" type="text/javascript"></script>
 
 <!-- bootstrap.bundle.min.js below is needed if you wish to zoom and preview file content in a detail modal
     dialog. bootstrap 5.x or 4.x is supported. You can also use the bootstrap js 3.3.x versions. -->
 <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.1/dist/js/bootstrap.bundle.min.js" crossorigin="anonymous"></script>
 
 <!-- the main fileinput plugin script JS file -->
 <script src="https://cdn.jsdelivr.net/gh/kartik-v/bootstrap-fileinput@5.2.3/js/fileinput.min.js"></script>
 
 <script src =" https://cdnjs.cloudflare.com/ajax/libs/bootstrap-fileinput/4.5.0/themes/fas/theme.js "> </script>
 
 <!-- following theme script is needed to use the Font Awesome 5.x theme (`fas`). Uncomment if needed. -->
 <!-- script src="https://cdn.jsdelivr.net/gh/kartik-v/bootstrap-fileinput@5.2.3/themes/fas/theme.min.js"></script -->
 
 <!-- optionally if you need translation for your language then include the locale file as mentioned below (replace LANG.js with your language locale) -->
 <script src="https://cdn.jsdelivr.net/gh/kartik-v/bootstrap-fileinput@5.2.3/js/locales/es.js"></script>

 <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.1/dist/css/bootstrap.min.css" crossorigin="anonymous">



 <style>

  * {
    box-sizing: border-box;
  }


  .bootstrap-datetimepicker-widget {
    width: 100% !important;
    max-width: none !important;
  }

  /* Ab hier für dich interessant :) */

  .bootstrap-datetimepicker-widget table thead tr:first-child th:hover,
  .bootstrap-datetimepicker-widget table td.day:hover,
  .bootstrap-datetimepicker-widget table td.hour:hover,
  .bootstrap-datetimepicker-widget table td.minute:hover,
  .bootstrap-datetimepicker-widget table td.second:hover,
  .bootstrap-datetimepicker-widget table td span:hover {
    /* Hintergrundfarbe für die angehoverte Auswahl */
    background: #f5f5f5;
  }
  .bootstrap-datetimepicker-widget table td.active,
  .bootstrap-datetimepicker-widget table td.active:hover,
  .bootstrap-datetimepicker-widget table td span.active {
    /* Hintergrundfarbe für die aktive Auswahl */
    background-color: #ff007d;
    color: #ffffff;
  }
  .bootstrap-datetimepicker-widget table td.today:before {
    /* Dreieckfarbe für den aktuellen Tag */
    border-bottom-color: #ff007d;
  }
  .bootstrap-datetimepicker-widget table td.active.today:before {
    /* Dreieckfarbe, wenn aktueller Tag und Auswahl gleicher Tag ist */
    border-bottom-color: #fff;
  }
  .bootstrap-datetimepicker-widget a {
    /* Für das Kalender-Icon, das Uhrzeit-Icon und die Pfeile in der Uhrzeitauswahl*/
    color: #ff007d;
  }
  .timepicker-picker .btn-primary {
    /* Für den Button AM / PM*/
    color: #fff;
    background-color: #ff007d;
    border-color: #ff007d;
  }
  p{
      font-family: 'Roboto', sans-serif;
  }

  .alert-box {
      padding: 15px;
      margin-bottom: 20px;
      border: 1px solid transparent;
      border-radius: 4px;  
      width: 100%;
  }

  .success {
      color: #3c763d;
      background-color: #dff0d8;
      border-color: #d6e9c6;
      display: none;
  }

  .failure {
      color: #a94442;
      background-color: #f2dede;
      border-color: #ebccd1;
      display: none;
  }

  .fade-in {
      opacity: 1;
      animation-name: fadeInOpacity;
      animation-iteration-count: 1;
      animation-timing-function: ease-out;
      animation-duration: 0.5s;
      display: block;
      position: fixed;
  }
  .fade-out {
      opacity: 0;
      animation-name: fadeOutOpacity;
      animation-iteration-count: 1;
      animation-timing-function: ease-in;
      animation-duration: 0.5s;
  }

  @keyframes fadeInOpacity {
      0% {
          opacity: 0;
      }
      100% {
          opacity: 1;
      }
  }
  @keyframes fadeOutOpacity {
      0% {
          opacity: 1;
      }
      100% {
          opacity: 0;
      }
  }



  /*titulo de la tabla*/
  .table-title{
  background-color: slategrey;
  color: white;
  padding: 10px;
  border-radius: 5px 5px 0px 0px;;
  }   

  .select,
  #locale {
    width: 100%;
  }
  .like {
    margin-right: 10px;
  }

  .fullscreen{
    padding-top: 60px;
  }

  .disabled {
  pointer-events: none;
  cursor: default;
  opacity: 0.5;
  }


/* para eliminar los bordes de las columnas de la tabla solo del footer donde va el logo alerta2*/
.table-bordered > tfoot > tr > th {
    border: none;
}

/*file input*/
.krajee-default .file-caption-info, .krajee-default .file-size-info {
    height: 30px;
    margin: none;
}
thead{
  color: slategrey;
}
#kvFileinputModal{
  z-index: 2002;
}

.table-dark {
    --bs-table-bg: #1a252f;
    --bs-table-striped-bg: #1a252f;
    --bs-table-striped-color: #fff;
    --bs-table-active-bg: #1a252f;
    --bs-table-active-color: #fff;
    --bs-table-hover-bg: #1a252f;
    --bs-table-hover-color: #fff;
    color: #fff;
}

.detail-view{
  background-color:rgba(127, 255, 212,0.5);
}
.rolldate-container.rolldate-one .rolldate-wrapper{
  z-index: 3000;
}
.rolldate-container .rolldate-mask{
  z-index: 3000;
}
.rolldate-container header {
    background: #fff;
    color: rgb(0, 0, 0);
}

#headerRollDate {
    animation: fluido 10s ease-in-out infinite;
    background: linear-gradient(-45deg, #ee7752, #e73c7e, #23a6d5, #23d5ab);
    background-size: 300%;
    -webkit-background-clip: text;
    background-clip: text;
    -webkit-text-fill-color: transparent;
    text-align:center;
    font-family: 'Brush Script MT', cursive;
    font-size: 30px;
    margin-bottom: 0px;
  }

</style>
{% endblock %}




{% block content %}


<section>
<div class="container">
  <h2 class="text-center" id="titulo">Informes Trimestrales</h2>


  {% if user.is_authenticated %} <!-- Si el usuario esta logeado ... -->
		{% if perms.auth.spida_inf_trimestrales %}	<!-- Si el usuario tiene permisos de acceso a los informes trimestrales de spida ... -->
      {% if perms.auth.spida_inf_trimestrales %} <!-- Si el usuario tiene permisos para adjuntar informes trimestrales de spida -->
        <!--Boton añadir evento-->
        <div id="addEvento" style="text-align: center;margin-top:5%">
            <button class="icon-btn add-btn">
              <div class="add-icon"></div>
              <div class="btn-txt" data-toggle="modal" data-target="#exampleModal">Añadir un nuevo informe trimestral</div>
            </button>
        </div><!--END Boton añadir evento-->
      {% endif %} <!-- END Si el usuario tiene permisos para adjuntar informes trimestrales de spida -->
      
      <!--Linea divisoria-->
      <hr class="linea-hr" />


      <!-- Modal Form para adjuntar la documentacion de un evento de inundacion -->
      <div class="modal fade" id="exampleModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true" style="z-index: 2001;">
        <div class="modal-dialog modal-lg modal-dialog-centered" role="document">
          <div class="modal-content">
            <div class="modal-header">
              <h2 class="modal-title" id="titulo" style="font-size: 35px;">Adjuntar el Informe Trimestral</h2>
              <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                <span aria-hidden="true">&times;</span>
              </button>
            </div>
            <div class="modal-body">         
              <form  method="post" enctype="multipart/form-data" class="p-3">
                {% csrf_token %}
                <label for="cuatrimentreInforme" class="form-label">Cuatrimestre del Informe elaborado * :</label>
                <select class="form-control" id="cuatrimentreInforme" name="cuatrimentre" required>
                  <option>1</option>
                  <option>2</option>
                  <option>3</option>
                  <option>4</option>
                </select>
                <br>
                <label for="date15" class="form-label">Año del cuatrimestre * :</label>
                <input class="form-control" type="text" id="date15" name="year"placeholder="YYYY" required>
                <br>
                <input id="input-b3" name="docInformeTrimestral" type="file" class="file" multiple data-show-upload="true" data-show-caption="true" data-msg-placeholder="Select {files} for upload...">
              </form>
            </div>
          </div>
        </div>
      </div>
      <!-- END Modal Form para adjuntar la documentacion de un evento de inundacion -->

      <!-- Tabla con la documentacion adjuntada del evento de inundacion -->
      <div class="table-responsive">
        <table  class="table table-bordered"
        id="tablaInformesTrimestrales"
        name = "tablaInformesTrimestrales"
        data-toggle="table"
        data-show-toggle="false"
        data-locale="es-ES"
        data-show-columns="false"
        data-show-fullscreen="true"
        data-search="true" 
        data-show-pagination-switch="true"
        data-pagination="true"
        data-page-list="[4, 8, 12, All]"
        data-page-size="8"
        data-show-footer="true"
        data-footer-style="footerStyle"
        data-show-refresh="true"
        data-loading-template="loadingTemplate">
        </table>
      </div> <!-- END Tabla con la documentacion adjuntada del evento de inundacion -->             
              
    {% endif %} <!-- END Si el usuario tiene permisos de acceso a la documentacion de los eventos ... -->
  {% endif %} <!-- END Si el usuario esta logeado ... -->
</div>
</section>


<script type="text/javascript">



  $("#input-b3").fileinput ({
    theme: "fas", //iconos utilizados
    language: "es", //idioma del file input
    /*uploadUrl: 'file-upload-batch',*/ //url for ajax
    maxFilePreviewSize: 10240, //tamaño maximo del archivo
    showClose: false, //boton cerrar vista previa de archivos cuando los adjunto
    showCancel: false,
    allowedFileExtensions: ['pdf'], //extensiones de archivos permitidos
    removeClass: "btn btn-danger",
    removeLabel: "Eliminar",
    /*elErrorContainer: "#errorBlock",*/
    maxFileCount: 1,
  });

  new rolldate.Date({
    el:'#date15',
    format:'YYYY',
    beginYear:2019,
    endYear: new Date().getFullYear(),
    value: new Date().getFullYear(),
    lang : {
    title: 'Seleccione el año del informe trimestral',
    cancel: 'Cancelar',
    confirm: 'Confirmar'
    }
  })

</script>

<script>

  function LogoFooter(){
      var html = []
      html.push('<img src="/static/img/spida/logos/logo_alerta2.jpg" style="max-height:50px; float:left" alt="">');
      return html.join('')
  }

  function footerStyle(column) {
    /*return {
      action: {
        css: {'border-color': 'rgba(0, 0, 0, 0)'}
      }
    }[column.field]*/
    return {
      css: { 'border-color': 'rgba(0, 0, 0, 0)' }
    }
  }

  function loadingTemplate(message) {
      return '<i class="fa fa-spinner fa-spin fa-fw fa-2x"></i>'
  }



       $('#tablaInformesTrimestrales').bootstrapTable({
            method: 'get',
            url : "/spida/informestrimestrales", //"/spida/docu-evento/?evento="+idEvento,
            cache: false,
            columns: [{
              title: 'Id Informe',
              field: 'id'
            }, {
              title: 'Id Cuatrimestre',
              field: 'cuatrimestre',
              align: 'center',
              sortable: 'true',
              footerFormatter: LogoFooter,
            }, {
              title: 'Fecha Inicio',
              field: 'fecha_ini',
              align: 'center',
              formatter: function(value, row){
                var fecha = new Date(row.fecha_ini);
                return ("0" + fecha.getDate()).slice(-2)+"-"+("0" + (fecha.getMonth()+1)).slice(-2)+"-"+fecha.getFullYear()+" "+("0" + fecha.getHours()).slice(-2)+":"+("0" + fecha.getMinutes()).slice(-2)
              }
            },{
              title: 'Fecha Fin',
              field: 'fecha_fin',
              align: 'center',
              formatter: function(value, row){
                var fecha = new Date(row.fecha_fin);
                return ("0" + fecha.getDate()).slice(-2)+"-"+("0" + (fecha.getMonth()+1)).slice(-2)+"-"+fecha.getFullYear()+" "+("0" + fecha.getHours()).slice(-2)+":"+("0" + fecha.getMinutes()).slice(-2)
              }
            },{
              title: 'Fecha de Subida',
              field: 'fecha_subida',
              align: 'center',
              sortable: 'true',
              formatter: function(value, row){
                var fecha = new Date(row.fecha_subida);
                return ("0" + fecha.getDate()).slice(-2)+"-"+("0" + (fecha.getMonth()+1)).slice(-2)+"-"+fecha.getFullYear()+" "+("0" + fecha.getHours()).slice(-2)+":"+("0" + fecha.getMinutes()).slice(-2)
              }
            },{
              title: 'Tamaño',
              field: 'size',
              align: 'center',
              formatter: function (value, row) {
                if(row.size>=1000)
                  return value/1000 +' KB';
                else if(row.size>=1000000)
                  return value/1000000+' MB';
                else
                  return value +' B';
              }
            },{
              title: 'Ruta',
              field: 'path',
            },{
              title: 'Acciones',
              field: 'action',
              align: 'center',
              formatter: function (value, row) {
                return '<a href="/spida/view_informe_trimestral_spida/?informe='+row.id+'" class="like"><i class="fas fa-eye"></i></a>'
                      +'<a href="/spida/download_informe_trimestral_spida/?informe='+row.id+'" class="like"><i class="fas fa-download"></i></a>'
              }
            }],
            locale: "es-ES",
            search: true,
            sortName: 'fecha_subida',
            sortOrder: 'desc',

      });
      
      var classes = ["table", "table-bordered", "table-light"];
      $('#tablaInformesTrimestrales').bootstrapTable('refreshOptions', {
        classes: classes.join(' ')
      });

      $('#tablaInformesTrimestrales').bootstrapTable('hideColumn', 'id');
      $('#tablaInformesTrimestrales').bootstrapTable('hideColumn', 'path');
      /*$(idTable).bootstrapTable('hideColumn', 'evento');
      $(idTable).bootstrapTable('hideColumn', 'descripcion');*/
</script>

<script type="text/javascript" src="{% static 'js/spida/rolldate.js' %}"></script>

<!--<script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js"></script>-->
<!--<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js" integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM" crossorigin="anonymous"></script>-->
<!--<script src="https://unpkg.com/bootstrap-table@1.18.3/dist/bootstrap-table.min.js"></script>-->
{% endblock %}