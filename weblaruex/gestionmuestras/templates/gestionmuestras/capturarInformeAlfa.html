{% extends "base/base_gestmues.html" %}
{% load static %}
{% block title %}
    Web LARUEX
{% endblock %}
{% block imports %}
{% endblock %}

{% block css %}
    button, input[type="submit"], input[type="reset"] {
        background: none;
        color: inherit;
        border: none;
        padding: 0;
        font: inherit;
        cursor: pointer;
        outline: inherit;
    }
    .param-adicional div:hover{
        background-color: #D7E9FC;
    }
{% endblock %}

{% block content %}
<div class="pagetitle">
    <nav>
        <ol class="breadcrumb">
          <li class="breadcrumb-item"><a href="{% url 'gestionmuestras:gestmuesOpciones' %}">Home</a></li>
        </ol>
    </nav>
</div>
<!-- Info programa -->
<section class="section dashboard">
    <div class="card">
        <div class="card-body">
            {% if datos %}<!-- Multi Columns Form -->
                <form class="g-3"> 
                    {% csrf_token %}
                    <!-- captura de fichero -->
                    <div class="row">
                        <div class="col-md-4 col-sm-12">
                            <label for="codigo_muestra" class="form-label">Código muestra:</label>
                            <input type="text" class="form-control" id="codigo_muestra" name="codigo_muestra" value="{{datos.codigo_muestra}}" required>
                        </div>
                        <!-- select with muestras encontradas -->
                        <div class="col-md-4 col-sm-12">
                            <label for="muestra_encontrada" class="form-label mt-3">Muestras encontradas:</label>
                            <select name="muestra_encontrada" id="muestra_encontrada">
                                LAS MUESTRAS SON: {{datos.muestras_encontradas}}
                                {% for muestra in datos.muestras_encontradas %}
                                    <option name="muestra_encontrada" value="{{muestra.NUMERO}}">{{muestra.NUMERO}} - {{muestra.CSN}} - {{muestra.COD_PRO}} - {{muestra.COD_MEMO}}</option>
                                {% endfor %}
                            </select>
                        </div>
                        <div class="col-md-4 col-sm-12">
                            <label for="codigo_reducido" class="form-label">Código reducido:</label>
                            <input type="text" class="form-control" id="codigo_reducido" name="codigo_reducido" value="{{datos.codigo_reducido}}" required>
                        </div>
                        <div class="col-md-4 col-sm-12">
                            <label for="tipo" class="form-label">Tipo muestra:</label>
                            <input type="text" class="form-control" id="tipo" name="tipo" value="{{datos.tipo}}" required>
                        </div>
                        <div class="col-md-4 col-sm-12">
                            <label for="fecha_recogida" class="form-label">Fecha recogida:</label>
                            <input type="date" class="form-control" id="fecha_recogida" name="fecha_recogida" required>
                        </div>
                        <div class="col-md-4 col-sm-12">
                            <label for="fecha_medida" class="form-label">Fecha análisis:</label>
                            <input type="date" class="form-control" id="fecha_medida" name="fecha_medida" required>
                        </div>
                        <div class="col-md-4 col-sm-12">
                            <label for="tiempo_medida" class="form-label">Tiempo medida:</label>
                            <input type="number" class="form-control" id="tiempo_medida" name="tiempo_medida" value="{{datos.tiempo_medida|safe}}" required>
                        </div>
                        <div class="col-md-4 col-sm-12">
                            <label for="masa" class="form-label">Cantidad:</label>
                            <input type="text" class="form-control" id="masa" name="masa" value="{{datos.masa}}" required>
                        </div>
                        <div class="col-md-4 col-sm-12">
                            <label for="unidad" class="form-label">Unidad:</label>
                            <input type="text" class="form-control" id="unidad" name="unidad" value="{{datos.unidad}}" required>
                        </div>
                        <div class="col-md-4 col-sm-12">
                            <label for="detector" class="form-label">Detector:</label>
                            <input type="text" class="form-control" id="detector" name="detector" value="{{datos.detector}}" required>
                        </div>
                        <div class="col-md-4 col-sm-12">
                            <label for="tiempo_fondo" class="form-label">Tiempo fondo:</label>
                            <input type="number" class="form-control" id="tiempo_fondo" name="tiempo_fondo" value="{{datos.tiempo_fondo}}" required>
                        </div>
                        
                        {% if datos.rendimiento %}
                            <p><b>Rendimiento químico ({{datos.unidad}}): </b>{{datos.rendimiento.valor}} ± {{datos.rendimiento.error}}</p>
                            <div class="col-md-4 col-sm-12">
                                <label for="rendimiento_valor" class="form-label">Rendimiento ({{datos.unidad}}):</label>
                                <input type="number" step="0.1" class="form-control" id="rendimiento_valor" name="rendimiento_valor" value="{{datos.rendimiento.valor}}" required>
                                <input type="number" step="0.1" class="form-control" id="rendimiento_error" name="rendimiento_error" value="{{datos.rendimiento.error}}" required>
                            </div>
                        {% endif %}
                    </div>
                    <div class="row">
                        {% for medida in datos.medidas %}
                            <input type="checkbox" id="{{medida.medida}}" name="{{medida.medida}}" checked><label for="{{medida.medida}}">Medida {{medida.medida}} ({{datos.unidad}}):</b> {{medida.valor}} ± {{medida.error}} {% if medida.amd %} AMD: {{medida.amd}}{% endif %}</label>
                        {% endfor %}
                    </div>
                    <div class="text-center">
                        <div class="card-header my-4"></div>
                        <button type="submit" class="btn btn-primary">Insertar</button>
                        <button type="reset" class="btn btn-secondary">Reset</button>
                    </div>
                </form><!-- End Multi Columns Form -->
                <h5 class="card-title">Datos leidos</h5>
                <p><b>Código muestra: </b>{{datos.codigo_muestra}}</p>
                <p><b>Código reducido: </b>{{datos.codigo_reducido}}</p>
                <p><b>Tipo muestra: </b>{{datos.tipo}}</p>
                <p><b>Fecha recogida: </b>{{datos.fecha_recogida}}</p>
                <p><b>Fecha análisis: </b>{{datos.fecha_medida}}</p>
                <p><b>Tiempo medida: </b>{{datos.tiempo_medida}}</p>
                <p><b>Cantidad: </b>{{datos.masa}}</p>
                <p><b>Detector: </b>{{datos.detector}}</p>
                <p><b>Tiempo fondo: </b>{{datos.tiempo_fondo}}</p>
                <p><b>Archivo fondo: </b>{{datos.archivo_fondo}}</p>
                
                {% for medida in datos.medidas %}
                    <p><b>Medida {{medida.medida}} ({{datos.unidad}}):</b> {{medida.valor}} ± {{medida.error}} {% if medida.amd %} AMD: {{medida.amd}}{% endif %}</p>
                {% endfor %}
                {% if datos.rendimiento %}
                    <p><b>Rendimiento químico ({{datos.unidad}}): </b>{{datos.rendimiento.valor}} ± {{datos.rendimiento.error}}</p>
                {% endif %}
            {% endif %}
            <h5 class="card-title">Capturar fichero alfa</h5>
            <!-- Multi Columns Form -->
            <form class="g-3" action="{% url 'gestionmuestras:gestmuesCapturarInformeAlfa' %}" method="POST" enctype="multipart/form-data"> 
                {% csrf_token %}
                <!-- captura de fichero -->
                <div class="row">
                    <div class="col-12">
                        <label for="inputFile" class="form-label">Fichero de resultados alfa:</label>
                        <input type="file" class="form-control" id="inputFile" name="inputFile" required>
                    </div>
                </div>
                
                <div class="text-center">
                    <div class="card-header my-4"></div>
                    <button type="submit" class="btn btn-primary">Insertar</button>
                    <button type="reset" class="btn btn-secondary">Reset</button>
                </div>
            </form><!-- End Multi Columns Form -->
        </div>
    </div>
</section>
<!-- End Info programa -->

<script>
    // obtengo la fecha de recogida en formato dd/mm/yyyy almacenada en {{datos.fecha_recogida}} y la convierto a formato yyyy/mm/dd y la pongo en el input con id fecha_recogida  
    var fecha_recogida = "{{datos.fecha_recogida}}";
    document.getElementById("fecha_recogida").value = fecha_recogida.split("/")[2] + "-" + fecha_recogida.split("/")[1] + "-" + fecha_recogida.split("/")[0];
    // the same with fecha_medida
    var fecha_medida = "{{datos.fecha_medida}}";
    document.getElementById("fecha_medida").value = fecha_medida.split("/")[2] + "-" + fecha_medida.split("/")[1] + "-" + fecha_medida.split("/")[0];
</script>
{% endblock %}
