{% extends "base/base_gestmues.html" %}
{% load static %}
{% block title %}
    Web LARUEX
{% endblock %}
{% block imports %}
{% endblock %}

{% block css %}
    button, input[type="submit"], input[type="reset"] {
        background: none;
        color: inherit;
        border: none;
        padding: 0;
        font: inherit;
        cursor: pointer;
        outline: inherit;
    }
    .param-adicional div:hover{
        background-color: #D7E9FC;
    }
{% endblock %}

{% block content %}
<div class="pagetitle">
    <nav>
        <ol class="breadcrumb">
          <li class="breadcrumb-item"><a href="{% url 'gestionmuestras:gestmuesOpciones' %}">Home</a></li>
        </ol>
    </nav>
</div>
<!-- Info programa -->
<section class="section dashboard">
    <div class="card">
        <div class="card-body">
            <h5 class="card-title">Tareas post-insercción</h5>
            <form class="g-3" action="{% url 'gestionmuestras:gestmuesFinalizarInsercion' %}" method="POST"> 
                {% csrf_token %}
                <div class="card-header my-4">Información de la muestra</div>
                <!-- muestro el texto Cantidad muestra y la variable {{ cantidad_muestra }} en un recuado y muestro el texto Cantidad Muestra Restante y la variable {{ cantidad_muestra_restante }} en un recuado -->
                <div class="row">
                    {% if mensaje %}
                        <div class="col-12">
                            <div class="row border border-danger rounded">
                                <p class="text-danger">{{mensaje|safe}}</p>
                            </div>
                        </div>
                    {% endif %}
                    <div class="col-md-6 col-sm-12 p-4">
                        <div class="row border border-secundary rounded">
                            <label for="floatingSelect">Cantidad muestra</label>
                            <div class="form-floating mb-3"> 
                                <input type="text" class="form-control text-center" id="floatingInput" value="{{ cantidad_muestra }} {{ unidad_muestra }}" readonly style="font-size: 24px;">
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6 col-sm-12 p-4">
                        <div class="row border border-secundary rounded">
                                <label for="floatingSelect">Cantidad Muestra Restante</label>
                                <div class="form-floating mb-3"> 
                                    <input id="cantidad_restante" type="text" class="form-control text-center {% if cantidad_muestra_restante < 0 %}text-danger{% endif %}" id="floatingInput" value="{{ cantidad_muestra_restante }} {{ unidad_muestra }}" readonly style="font-size: 24px;">
                                    {% if cantidad_muestra_restante < 0 %}<div class="text-danger">La cantidad de muestra es negativa. Revise las alicuotas y los controles si no es posible hacerlos elimínalos para que queden pendiente en la próxima muestra</div>{% endif %}
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="card-header my-4">Asignación de tratamientos</div>
                <div class="row">
                    {% for t in tratamientos %}
                        <div id="{{t.key}}_div" class="col-lg-3 col-md-4 col-sm-6 my-2">
                            <div class="row justify-content-end">
                                
                                <button type="button" class="btn btn-outline-danger align-self-end col-2 m-1" onclick="$('#cantidad_restante').val((parseFloat($('#cantidad_restante').val().replace(',','.'))+{{t.cantidad}}).toFixed(3).replace('.',',')+' {{ unidad_muestra }}');eliminarDiv('{{t.key}}_div');" data-toggle="tooltip" data-placement="bottom" title="Eliminar alicuota">  
                                    <i class="fas fa-trash"></i>
                                </button>
                            </div>
                            <div class="form-check form-switch">
                                <label class="form-label">Determinacion: <b>{{ t.determinacion.nombre }}</b> con tratamiento <b>{{ t.tratamiento.descripcion }}</b> a realizar por: </label>
                                <select name="{{t.key}}" id="{{ t.key }}" class="form-select" required>
                                    {% for tecnico in t.tecnico %}
                                        <option value="{{ tecnico }}">{{ tecnico }}</option>
                                    {% endfor %}
                                    <option value="-">--- Todos ---</option>
                                    {% for empleado in empleados %}
                                        <option value="{{ empleado.nombre }}">{{ empleado.nombre }}</option>
                                    {% endfor %}
                                </select>
                                <!-- label and input for cantidad -->
                                <label class="form-label mt-2">Cantidad: ({{ t.unidad }})</label>
                                <input type="number" step="0.001" name="{{t.key}}_cantidad" id="{{t.key}}_cantidad" class="form-control" value="{{ t.cantidad }}">

                            </div>
                        </div>
                    {% endfor %}
                </div>
                <div class="card-header my-4">Controles requeridos</div>
                <div class="row">
                    {% for c in controles_requeridos %}
                        <div id="{{ c.key }}_div_{{c.control}}" class="col-lg-3 col-md-4 col-sm-6 my-2">
                            <div class="d-flex flex-column align-items-end">
                                <button type="button" class="btn btn-outline-danger" onclick="$('#cantidad_restante').val((parseFloat($('#cantidad_restante').val().replace(',','.'))+{{c.cantidad}}).toFixed(3).replace('.',',')+' {{ unidad_muestra }}');eliminarDiv('{{c.key}}_div_{{c.control}}')">  
                                    <i class="fas fa-trash"></i>
                                </button>
                            </div>
                            <div class="form-check form-switch">
                                <label class="form-label">Determinacion: <b>{{ c.determinacion.nombre }}</b> con tratamiento <b>{{ c.tratamiento.descripcion }}</b> requiere <b>{{c.control}}</b> a realizar por: </label>
                                <select name="{{c.key}}_{{c.control}}" id="{{ c.key }}_{{c.control}}" class="form-select" required>
                                    {% for tecnico in c.tecnico %}
                                        <option value="{{ tecnico }}">{{ tecnico }}</option>
                                    {% endfor %}
                                </select>
                                <!-- label and input for cantidad -->
                                <label class="form-label mt-2">Cantidad: ({{ c.unidad }})</label>
                                <input type="number" step="0.01" name="{{c.key}}_{{ c.control }}_cantidad" id="{{c.key}}_{{ c.control }}_cantidad" class="form-control" value="{{ c.cantidad }}">
                            </div>
                        </div>
                    {% endfor %}
                </div>
                <div class="text-center">
                    <div class="card-header my-4"></div>
                    <button type="submit" class="btn btn-primary">Insertar</button>
                    <button type="reset" class="btn btn-secondary">Reset</button>
                </div>
            </form><!-- End Multi Columns Form -->
        </div>
    </div>
</section>
<!-- End Info programa -->

<script>
    
</script>
{% endblock %}
