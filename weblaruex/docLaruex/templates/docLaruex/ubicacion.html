{% extends "base/base_docLaruex.html" %}
{% load static %}

{% block imports %}
<link rel="stylesheet" href="{% static 'css/docLaruex/custom_docLaruex.css' %}" />
<link rel="stylesheet" href="{% static 'css/docLaruex/boostrapTable_docLaruex.css' %}" />

{% endblock %}

{% block content %}



<!-- breadcrumb   -->
<div class="card-body">
  <nav>
      <h5 class="card-title">{{ ubicacion.id.nombre }}
        {% if administrador %}
        <!-- boton que permite asociar elementos al formato actual-->
        <a href="" title="Asociar Archivo" class="mx-" data-toggle="modal" data-toggle="tooltip"
          data-target="#modalAsociarArchivo" style="color: #0A9396; " download><i class="fa-solid fa-link enlace enviarNotificacion"></i></a>
        
          {% if registros %}
          <a href="/private/docLaruex/verMantenimientosAsociados/{{ubicacion.id.id}}/" class="mx-1" title="Ir a la tarea de Mantenimiento" style="color:#511f31"><i class="fa-duotone fa-screwdriver-wrench enviarNotificacion"></i></a>
          {% endif %}
          <a  class="mx-1" title="editar ubicación" data-target="#modalEditarUbicacion" data-toggle="modal"
          style="color: #bb3e03; align-items: md-center"><i class="fa-duotone fa-money-check-pen editarObjeto"></i></a>  
        {% endif %}
      </h5>
    <ol class="breadcrumb" style="background-color:#fff !important">
      <li class="breadcrumb-item" style="font-size: large;"><a href="\private/docLaruex/"><i
            class="bi bi-house-door"></i></a></li>
      <li class="breadcrumb-item" style="font-size: large;"><a href="\private/docLaruex/objetos">Listado de Objetos</a>
      </li>
      <li class="breadcrumb-item" style="font-size: large;"><a
          href="\private/docLaruex/tipoObjeto/Ubicacion/">Listado de Ubicaciones</a></li>
      
      {% if ubicacion.id.padre %}
        <li class="breadcrumb-item" style="font-size: large;"><a
        href="\private/docLaruex/verObjeto/{{ ubicacion.id.padre.id }}/">{{ ubicacion.id.padre.nombre }}</a></li>
      {% endif %}
        <li class="breadcrumb-item active" style="font-size: large;">{{ ubicacion.id.nombre }}</li>    

    </ol>
  </nav>
  <div class="d-flex justify-content-end">
    <a class="mx-1" title="Enviar nota relacionada con {{ ubicacion.id.nombre }}" data-toggle="modal" data-target="#modalFormularioEnviarNota" style="color: #001219; align-items: md-center"><i class="fa-duotone fa-message-pen fa-2x enviarNotificacion"></i></a>
    <a class="mx-1" title="Notas relacionadas con {{ ubicacion.id.nombre }}" data-toggle="modal" data-target="#modalFormularioVerNotas" style="color: #001219; align-items: md-center"><i class="fa-duotone fa-messages fa-2x enviarNotificacion"></i></a>
    <a  class="mx-1" title="cambiar estado" data-target="#modalFormularioCambiarEstado" data-toggle="modal"
    style="color: #001219; align-items: md-center"><i class="fa-duotone fa-sign-hanging fa-2x enviarNotificacion"></i></a>              


    {% if llave %}
    <a href="" title="Ver LLave" class="mx-" data-toggle="modal" data-toggle="tooltip"
    data-target="#modalVerImagen" style="color: #bb3e03; "><i class="fa-duotone fa-key fa-2x"></i></a>
    {% endif %}
    {% if llavesUbicadas %}
    <a href="" title="Llaves Guardadas" class="mx-" data-toggle="modal" data-toggle="tooltip"
    data-target="#modalLlavesAlmacenadas" style="color: #bb3e03; "><i class="fa-duotone fa-box-open-full fa-2x"></i></a>
    {% endif %}
  </div>
</div>

<!-- ========== Modal para Ver imagen ========== -->
  <!-- Section: Modals -->
  <section class="">
    <!-- Modal 1 -->
    <div
      class="modal fade"
      id="modalVerImagen"
      tabindex="-1"
      aria-labelledby="modalVerImagen"
      aria-hidden="true"
    >
      <div class="modal-dialog modal-lg">
        <div class="modal-content">
          <div class="ratio ratio-16x9">
            <img
              src="{% get_media_prefix %}/archivos/Llave/{{ llave.imagen }}"
              title="Imagen"
              allowfullscreen
            ></img>
          </div>
        </div>
      </div>
    </div>
  </section>


  <!-- ========== Modal para Ver las llaves almacenadas modalLlavesAlmacenadas ========== -->

  <!-- ========== Modal Ver Notas ================= -->
<div id="modalLlavesAlmacenadas" class="modal fade" tabindex="-1" role="dialog" aria-labelledby="myLargeModalLabel"
aria-hidden="true">
<div class="modal-dialog modal-dialog-scrollable modal-dialog-centered modal-lg">
  <div class="modal-content">
    <div class="modal-header">
      <h5 class="modal-title" id="TituloModalLlavesAlmacenadas">Llaves almacenadas en {{ ubicacion.id.nombre }}</h5>
      <button type="button" class="close" data-dismiss="modal" aria-label="Close">
        <span aria-hidden="true">&times;</span>
      </button>
    </div>
    <div class="modal-body">
        <div class="row">
          <div class="col">
            <table class="table-sm table-hover" id="tabla_llaves_almacenadas" data-search="true"
            data-buttons-class="light" data-pagination="true" data-id-field="id" data-page-list="[10]"
            data-toolbar="#toolbar"></table>
          </div>
      </div>

    </div>
  </div>
</div>
</div>

<!-- =================== información Destacada de la Ubicación =================== -->
<section class="section dashboard d-flex justify-content-center row">
    <!-- Info Card -->
    <div class="col col-xs-12 col-sm-12 col-md-5 my-auto">
      {% if registros %}
      <div id="carouselTareasProgramadas" class="carousel slide" data-ride="carousel">
        <div class="card " style="background-color: #19292fda; border-radius: 5px;">
          <div class="card-body">

              <ol class="carousel-indicators my-2">
                {% for i in itemsRegistros %}
                <li data-target="#carouselTareasProgramadas" data-slide-to="{{i}}" {%if i == 0 %} class="active" {% endif %}></li>
                {% endfor %}
              </ol>
                <div class="carousel-inner text-center">
                  {% for r in registros %}
                  <div class="carousel-item {% if forloop.first %} active {% endif %}  ">
                    {% if r.estado == 1 %}
                    
                      <h2 style="color:#08ca76"><strong>Próximo mantenimiento</strong></h2>
                      <h3 class="text-white">{{r.evento.id_evento__nombre}}</h3>
                      <h2 style="color:#08ca76"><i class="fa-solid fa-calendar-days fa-beat me-2"
                        style="color: #08ca76;"></i><strong>{{r.fecha_programada|date:"j N Y"}}</strong></h2>
                    {% elif r.estado == 2 %}
                      <h2 style="color:#ffd622"><strong>Cuidado, mantenimiento a punto de cumplir</strong></h2>
                      <h3 class="text-white">{{r.evento.id_evento__nombre}}</h3>
                      <h2 style="color:#ffd622"><i class="fa-solid fa-calendar-days fa-beat me-2"
                        style="color: #ffd622;"></i><strong>{{r.fecha_programada|date:"j N Y"}}</strong></h2>

                      {% elif r.estado == 4 %}
                      
                      <h2 style="color:#ff2222"><strong>¡Alerta!, mantenimiento fuera de plazo</strong></h2>
                      <h3 class="text-white">{{r.evento.id_evento__nombre}}</h3>
                      <h2 style="color:#ff2222"><i class="fa-solid fa-calendar-days fa-beat me-2"
                        style="color: #ff2222;"></i><strong>{{r.fecha_programada|date:"j N Y"}}</strong></h2>
                      {% elif r.estado == 5 %}
                      <h2 style="color:#e5500c"><strong>Mantenimiento Cancelado</strong></h2>
                      <h3 class="text-white">{{r.evento.id_evento__nombre}}</h3>
                      {% else %}
                      <h2 class="text-white"><strong>Sin mantenimiento asignado</strong></h3>

                      {% endif %}
                  </div>
                  {% endfor %}
                </div>

              


            </div>
          </div>
          <a class="carousel-control-prev" href="#carouselTareasProgramadas" role="button" data-slide="prev" style="background-color: transparent !important;">
            <i class="fa-solid fa-angle-left fa-2x me-4" style="color: #ffffff7b;"></i>
          </a>
          <a class="carousel-control-next" href="#carouselTareasProgramadas" role="button" data-slide="next" style="background-color: transparent !important;">
            <i class="fa-solid fa-angle-right fa-2x ms-4" style="color: #ffffff7b;"></i>

          </a>
        </div>
      
      {% endif %}
      <div class="card info-card sales-card">
        <div class="card-body">
          <h5 class="card-title">{{ ubicacion.id.nombre }}</h5>
          <div class="d-flex align-items-center p-2">
            <div class="card-icon rounded-circle d-flex align-items-center justify-content-center" style="background-color: #b5d8e252;">
              <i class="bi bi-building" style="color: #18414b;"></i>
            </div>
            <div class="ps-3">
              <h5>Tipo de Ubicación:</h5>
              <span class="text-info medium pt-10 fw-bold">{{ ubicacion.tipo_ubicacion.nombre }}</span>
                </div>
          </div>
          <div class="d-flex align-items-center p-2">
            <div class="card-icon rounded-circle d-flex align-items-center justify-content-center" style="background-color: #b5d8e252;">
              <i class="bi bi-reception-3" style="color: #18414b;"></i>
            </div>
            <div class="ps-3">
              <h5>Estado de la Ubicación:</h5>
              <span class="text-success medium pt-1 fw-bold">{% if ubicacion.id.id_estado.id == 1 or ubicacion.id.id_estado.id == 2 %}
                <span class="badge text-white"
                    style="background-color: #21b563; vertical-align:middle">{{ubicacion.id.id_estado.nombre}}</span>
              {% elif ubicacion.id.id_estado.id == 3 or ubicacion.id.id_estado.id == 4 %}
              <span class="badge text-white"
                  style="background-color: #EB8E34; vertical-align:middle">{{ubicacion.id.id_estado.nombre}}</span>
              {% elif ubicacion.id.id_estado.id == 5 %}
              <span class="badge text-white "
                  style="background-color: #524e4e; vertical-align:middle">{{ubicacion.id.id_estado.nombre}}</span>
              {% else %}
              <span class="badge text-white "
                  style="background-color: #b52121; vertical-align:middle">{{ubicacion.id.id_estado.nombre}}</span>
              {% endif %} </span>
                </div>
          </div>  
        </div>
  
      </div>

    </div><!-- End Info Card -->
    <div class="card col col-xs-12 col-sm-12 col-md-6 ">
      <div data-aos="fade-up" class="card-body d-flex align-items-center">
        <div id="open_map"  class="open-map" style="border:0; width: 100%; height: 350px;"></div>
      </div>
  
    </div>


</section>

<!-- =================== Dependencias de la Ubicación ==========================-->

{% if not ubicacion.id.padre %}
<section class="section">
  <div class="card">
    <div class="card-body">
      <h6 class="card-title">Dependencias de {{ ubicacion.id.nombre }}</h6>
      <!-- Accordion without outline borders -->
      <div class="accordion accordion-flush" id="accordionFlushDependenciasUbicacion">
        <div class="accordion-item">
          <h2 class="accordion-header" id="flush-headingDependenciasUbicacion">
            <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse"
              data-bs-target="#flush-collapseDependenciasUbicacion" aria-expanded="false"
              aria-controls="flush-collapseDependenciasUbicacion">Salas dentro de {{ ubicacion.id.nombre }}
            </button>
          </h2>
          <div id="flush-collapseDependenciasUbicacion" class="accordion-collapse collapse"
            aria-labelledby="flush-headingDependenciasUbicacion" data-bs-parent="#accordionFlushDependenciasUbicacion">
            <div class="accordion-body">
              <table id="tabla_ubicaciones_hijo" data-toggle="table" data-show-export="true"
                data-export-types="['excel', 'pdf']" data-page-list="[10, 25, 50, 100, All]" data-search="true"
                data-show-columns="true" data-show-columns-toggle-all="true" data-buttons="buttons"
                data-buttons-class="light" data-pagination="true"></table>
            </div>
          </div>
        </div>
      </div><!-- End Accordion without outline borders -->
    </div>
  </div>
</section>
{% endif %}


<!-- =================== Listado de Equipos de la ubicación ========================== -->
<section class="section">
  <div class="card">
    <div class="card-body">
      <h6 class="card-title">Equipos de {{ ubicacion.id.nombre }}</h6>
      <!-- Accordion without outline borders -->
      <div class="accordion accordion-flush" id="accordionFlushEquiposUbicacion">
        <div class="accordion-item">
          <h2 class="accordion-header" id="flush-headingEquiposUbicacion">
            <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse"
              data-bs-target="#flush-collapseEquiposUbicacion" aria-expanded="false"
              aria-controls="flush-collapseEquiposUbicacion">Lista de equipos localizados en {{ ubicacion.id.nombre }}
            </button>
          </h2>
          <div id="flush-collapseEquiposUbicacion" class="accordion-collapse collapse"
            aria-labelledby="flush-headingEquiposUbicacion" data-bs-parent="#accordionFlushEquiposUbicacion">
            <div class="accordion-body">
              <table id="tabla_equipos" data-toggle="table" data-search="true" data-show-export="true"
                data-export-types="['excel', 'pdf']" data-page-list="[10, 25, 50, 100, All]" data-show-columns="true"
                data-show-columns-toggle-all="true" data-buttons="buttons" data-buttons-class="light" data-pagination="true" ></table>
            </div>
          </div>
        </div>
      </div><!-- End Accordion without outline borders -->
    </div>
  </div>
</section>

<!-- =================== Listado de Documentos Asociados ==========================-->
<section class="section">
  <div class="card">
    <div class="card-body">
      <h6 class="card-title">Documentos relacionados con {{ ubicacion.id.nombre }}</h6>
      <!-- Accordion without outline borders -->
      <div class="accordion accordion-flush" id="accordionFlushDocumentosAsociadosUbicacion">
        <div class="accordion-item">
          <h2 class="accordion-header" id="flush-headingDocumentosAsociadosUbicacion">
            <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse"
              data-bs-target="#flush-collapseDocumentosAsociadosUbicacion" aria-expanded="false"
              aria-controls="flush-collapseDocumentosAsociadosUbicacion">Lista de documentos relacionados con {{ ubicacion.id.nombre }}
            </button>
          </h2>
          <div id="flush-collapseDocumentosAsociadosUbicacion" class="accordion-collapse collapse"
            aria-labelledby="flush-headingDocumentosAsociadosUbicacion" data-bs-parent="#accordionFlushDocumentosAsociadosUbicacion">
            <div class="accordion-body">
              <table id="tabla_referencias_asociadas" data-toggle="table" data-show-export="true"
                data-export-types="['excel', 'pdf']" data-page-list="[10, 25, 50, 100, All]" data-search="true"
                data-show-columns="true" data-show-columns-toggle-all="true" data-buttons="buttons"
                data-buttons-class="light" data-pagination="true" ></table>
            </div>
          </div>
        </div>
      </div><!-- End Accordion without outline borders -->
    </div>
  </div>
</section>


<!-- =================== Listado de Stock asociado ==========================-->
<section class="section">
  <div class="card">
    <div class="card-body">
      <h6 class="card-title">Stock de {{ ubicacion.id.nombre }}</h6>
      <!-- Accordion without outline borders -->
      <div class="accordion accordion-flush" id="accordionFlushStockAsociadoUbicacion">
        <div class="accordion-item">
          <h2 class="accordion-header" id="flush-headingStockAsociadoUbicacion">
            <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse"
              data-bs-target="#flush-collapseStockAsociadoUbicacion" aria-expanded="false"
              aria-controls="flush-collapseStockAsociadoUbicacion">Listado de stock relacionado con {{ ubicacion.id.nombre }}
            </button>
          </h2>
          <div id="flush-collapseStockAsociadoUbicacion" class="accordion-collapse collapse"
            aria-labelledby="flush-headingStockAsociadoUbicacion" data-bs-parent="#accordionFlushStockAsociadoUbicacion">
            <div class="accordion-body">
              <table id="tabla_stock_por_ubicacion" data-toggle="table" data-show-export="true"
                data-export-types="['excel', 'pdf']" data-page-list="[10, 25, 50, 100, All]" data-search="true"
                data-show-columns="true" data-show-columns-toggle-all="true" data-buttons="buttons"
                data-buttons-class="light" data-pagination="true" ></table>
            </div>
          </div>
        </div>
      </div><!-- End Accordion without outline borders -->
    </div>
  </div>
</section>



<!-- ========== Modal Enviar Notificacion ================= -->
<div id="modalFormularioEnviarNota" class="modal fade" tabindex="-1" role="dialog" aria-labelledby="myLargeModalLabel"
  aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-dialog-centered modal-lg">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="TituloModal">Generar notificación asociada a {{ ubicacion.id.nombre}} </h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <form id="formularioModalEnviarNota" action="/private/docLaruex/agregarNotificacion/" method="POST"
          enctype="multipart/form-data">
          {% csrf_token %}
          <div class="row">
            <div class="col">
              <div class="form-group">
                <input type="text" class="form-control" id="id_doc" name="id_doc" data-rule="required" 
                  value="{{ ubicacion.id.id }}" hidden />
              </div>
              <div class="form-group">
                <input type="text" class="form-control" id="estadoNotificacion" name="estadoNotificacion" data-rule="required" 
                  value="1" hidden />
              </div>
            </div>
        </div>
        <div class="row">
          <div class="col-12">
              <div class="form-group">
                <label for="tituloNotificacion">Título</label>
                <input type="text" class="form-control" id="tituloNotificacion" name="tituloNotificacion" data-rule="required" required />
              </div>
          </div>
        </div>
        <div class="row">
          <div class="col-12">
            <div class="form-group">
              <label for="resumenNotificacion">Resumen</label>
              <textarea class="form-control" id="resumenNotificacion" name="resumenNotificacion" rows="5" data-rule="required"
                placeholder="Escriba un comentario" required></textarea>
            </div>

          </div>
        </div>

          <div class="modal-footer">
            <button id="cerrar" type="button" class="btn btn-secondary" data-dismiss="modal" >
              Cerrar
            </button>
            <button id="reset" type="reset" class="btn btn-secondary" hidden>
            </button>
            <button type="submit" value="submit" class="btn btn-primary" >
              Guardar
            </button>
          </div>
        </form>
      </div>
    </div>
  </div>
</div>

<!-- ========== Modal Ver Notas ================= -->
<div id="modalFormularioVerNotas" class="modal fade" tabindex="-1" role="dialog" aria-labelledby="myLargeModalLabel"
  aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-dialog-centered modal-lg">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="TituloModal">Notas del {{ ubicacion.id.nombre }}</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <form id="formularioModalEnviarNota" action="/private/docLaruex/agregarNotificacion/" method="POST"
          enctype="multipart/form-data">
          {% csrf_token %}
          <div class="row">
            <div class="col">
              <table class="table-sm table-hover" id="tabla_notificaciones" data-search="true"
              data-buttons-class="light" data-pagination="true" data-id-field="id" data-page-list="[10]"
              data-toolbar="#toolbar"></table>
            </div>
        </div>

          <div class="modal-footer">
            <button id="cerrar" type="button" class="btn btn-secondary" data-dismiss="modal" >
              Cerrar
            </button>
          </div>
        </form>
      </div>
    </div>
  </div>
</div>

<!-- ========== Modal Cambiar Estado ================= -->
<div id="modalFormularioCambiarEstado" class="modal fade" tabindex="-1" role="dialog" aria-labelledby="myLargeModalLabel"
  aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-dialog-centered modal-lg">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="TituloModalCambiarEstado">Cambiar estado del {{ ubicacion.id.nombre}}</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <form id="formularioCambiarEstado" action="/private/docLaruex/editarEstado/{{ ubicacion.id.id}}/" method="POST"
          enctype="multipart/form-data">
          {% csrf_token %}
          <div class="row">
            <div class="col">
              <div class="form-group">
                <input type="text" class="form-control" id="id_doc" name="id_doc" data-rule="required" 
                  value="{{ ubicacion.id.id }}" hidden />
              </div>
            </div>
        </div>
        <div class="row">
          <div class="col-4">
            <div class="form-group">
              <label>Estado actual</label>
              <input type="text" value ="{{ubicacion.id.id_estado.nombre}}" class="form-control" disabled>
            
            </div>
          </div>
          <div class="col-8">
            <div class="form-group">
              <label for="nuevoEstado">Nuevo estado</label>
               <select class="form-select my-auto" id="nuevoEstado" name="nuevoEstado">
                {% for estado in estados %}
                  <option value="{{estado.id}}">
                    {{estado.nombre}}
                  </option>
                {% endfor %}
                </select>
            </div>
          </div>
        </div>

          <div class="modal-footer">
            <button id="cerrar" type="button" class="btn btn-secondary" data-dismiss="modal" >
              Cerrar
            </button>
            <button id="reset" type="reset" class="btn btn-secondary" hidden>
            </button>
            <button type="submit" value="submit" class="btn btn-primary" >
              Guardar
            </button>
          </div>
        </form>
      </div>
    </div>
  </div>
</div>

<!-- ========== Modal para asociar Archivos al documento ========== -->
<div id="modalAsociarArchivo" class="modal fade bd-example-modal-lg" tabindex="-1" role="dialog"
  aria-labelledby="modalAsociarArchivo" aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-dialog-centered modal-xl">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="TituloModal">
          <strong>
            Seleccione los archivos que desea asociar.
          </strong>
        </h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span
            aria-hidden="true">&times;</span></button>
      </div>
      <!-- END Cabecera del modalAsociarArchivo -->

      <!-- Body del modalAsociarArchivo -->
      <div class="modal-body">
        <form id="formularioAsociarArchivo" enctype="multipart/form-data">
          {% csrf_token %}

          <div class="row justify-content-center">
            <div class="col-lg-5">
              <div class="card card p-4 ">
                <h5 class="card-title text-center">Lista de Archivos</h5>
                <table class="table-sm table-hover" id="tabla_archivos_para_asociar" data-search="true"
                  data-buttons-class="light" data-pagination="true" data-id-field="id" data-page-list="[10]"
                  data-toolbar="#toolbar"></table>
              </div>
            </div>

            <div class="col-lg-1 col-12 my-auto text-center">
              <i id="flechas" class="fa-solid fa-arrow-right-arrow-left fa-3x" style="color: rgb(41,68,87)"></i>
            </div>

            <div class="col-lg-5">
              <div class="card p-4">
                <h5 class="card-title text-center">Archivos seleccionados</h5>
                <table id="tabla_archivos_para_asociar_seleccionados" class="table-sm table-hover" data-search="true"
                  data-buttons-class="light" data-pagination="true" data-id-field="id" data-page-list="[10]"
                  data-toolbar="#toolbar"></table>
              </div>
            </div>
          </div>
      </div>
      <input type="text" id="idArchivoActual" value="{{ id }}" hidden name="idArchivoActual" data-rule="required" />
      <input type="text" id="idArchivosSeleccionados" value="{{ id }}" hidden name="idArchivosSeleccionados"
        data-rule="required" />

      <!-- Footer del ModalAsociarArchivo -->
      <div class="modal-footer d-flex">

        <button id="cerrarAsociar" type="button" class="btn btn-secondary" data-dismiss="modal">
          Cerrar
        </button>
        <button type="submit" value="submit" class="btn btn-primary">
          Guardar
        </button>
      </div>
      <!-- END Footer del ModalAsociarArchivo -->
    </div>
  </div>
</div><!-- END Body del ModalAsociarArchivo -->
</form>
</div> <!-- END ModalAsociarArchivo -->

<!-- ========== Modal Para editar Ubicación ================= -->
<div id="modalEditarUbicacion" class="modal fade" tabindex="-1" role="dialog" aria-labelledby="myLargeModalLabel"
  aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-dialog-centered modal-lg">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="TituloModalEditarUbicacion">Editar {{ ubicacion.id.nombre}}</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <form id="formularioModal" action="/private/docLaruex/editarObjeto/{{ubicacion.id.id}}/" method="POST"
          enctype="multipart/form-data">
          {% csrf_token %}
          <div class="row d-flex align-items-center">            
            <input type="text" class="form-control" id="inputEliminarPadre" name="eliminarPadre" value="0" hidden/>
            <div class="col">
              <div class="form-group">
                <label for="nuevaHabilitacion">Habilitación</label>
                <select class="form-select" id="nuevaHabilitacion" name="nuevaHabilitacion" >
                  
                  <option value="{{ubicacion.id.id_habilitacion.id}}" selected hidden>{{ubicacion.id.id_habilitacion.titulo}}
                  </option>
                  {% for habilitacion in habilitaciones %}
                  <option value="{{habilitacion.id}}">
                    {{habilitacion.titulo}}
                  </option>
                  {% endfor %}
                </select>
              </div>
            </div>
            
            <div class="col">
              {% if ubicacion.id.padre %}
              <div class="form-group">
                <label for="nuevoPadreLabel" id="nuevoPadreLabel">Padre</label>
                <select class="form-select" data-rule="required" id="nuevoPadre" name="nuevoPadre">
                  <option value="{{ ubicacion.id.padre }}" selected hidden>{{ ubicacion.id.padre.nombre }}
                  </option>
                  {% for padre in padres %}
                  <option value="{{padre.id}}">
                    {{padre.id__nombre}}
                  </option>
                  {% endfor %}
                </select>
              </div>
              {% endif %}
              <div id="divAgregarPadreOculto" class="form-group" {% if ubicacion.id.padre %}hidden{% endif %}>

                <button type="button" class="btn btn-outline-info" onclick="agregarPadre()" id="botonAgregrarPadreEditar">Agregar ubicación padre</button>
                <label for="nuevoPadreAgregarLabel" id="nuevoPadreAgregarLabel" hidden>Selecciona la ubicación Padre</label>
                <select class="form-select" data-rule="required" id="nuevoPadreBoton" name="nuevoPadre" hidden>
                  {% for padre in padres %}
                    {% if padre.id != ubicacion.id.id %}
                    
                    <option value="{{padre.id}}">
                      {{padre.id__nombre}}
                    </option>
                    {% endif %}
                  {% endfor %}
                </select>
              </div>
              
            </div>
            {% if ubicacion.id.padre %}
            <div class="col">
              <div class="form-group">
                <button type="button" class="btn btn-outline-danger"  id="botonEliminarPadre" >Eliminar ubicación padre</button>
              </div>
            </div>
            {% endif %}
          </div>
          <!-- formulario de Ubicación -->
          <div id="formularioEditarUbicacion" class="divFormulariosUbicacion">
            <div class="row">
              <div class="col">
                <div class="form-group">
                  <label for="nuevoTipoUbicacion">Tipo de Ubicación</label>
                  <select class="form-select" data-rule="required" id="nuevoTipoUbicacion" name="nuevoTipoUbicacion">
                    <option value="{{ ubicacion.tipo_ubicacion.id }}" selected hidden>{{ ubicacion.tipo_ubicacion.nombre }}
                    </option>
                    {% for tipoUbicacion in tipoUbicaciones %}
                    <option value="{{tipoUbicacion.id}}">
                      {{tipoUbicacion.nombre}}
                    </option>
                    {% endfor %}
                  </select>
                </div>
              </div>
              <div class="col-3">
                <div class="form-group">
                  <label for="nuevaLatitud">Latitud</label>
                  <input type="text" class="form-control" id="nuevaLatitud" placeholder="41.40338"
                    name="nuevaLatitud" data-rule="required" value="{{ubicacion.latitud|safe}}" />
                </div>
              </div>              
              <div class="col-3">
                <div class="form-group">
                  <label for="nuevaLongitud">Longitud</label>
                  <input type="text" class="form-control" id="nuevaLongitud" placeholder="-2.17403 " value="{{ubicacion.longitud|safe}}"
                    name="nuevaLongitud" data-rule="required" />
                </div>
              </div> 
            </div>
            <div class="row">
              <div class="col">
                <div class="form-group">
                  <label for="nuevoNombreUbicacion">Nombre de la Ubicación</label>
                  <input type="text" class="form-control" id="nuevoNombreUbicacion" placeholder="Alerta2" value="{{ubicacion.id.nombre|safe}}"
                    name="nuevoNombreUbicacion" data-rule="required"  title="No permite guiones ni otros caracteres que no sean espacios" />
                </div>
              </div>
            </div>
            <div class="row">
              <div class="col">
                <div class="form-group">
                  <label for="nuevoAlias">Alias</label>
                  <input type="text" class="form-control" id="nuevoAlias" placeholder="Edificio Departamentos, Planta 0 Dependencia 12"
                    name="nuevoAlias" data-rule="required"  title="No permite guiones ni otros caracteres que no sean espacios" value="{{ubicacion.alias|safe}}" />
                </div>
              </div>
            </div>

            </div>

          <div class="modal-footer">
            <button id="cerrar" type="button" class="btn btn-secondary" data-dismiss="modal" onclick="crearAviso('ubicacionesCerrar', 'No se ha podido añadir ubicación', 'alert-warning', 2000)">
              Cerrar
            </button>
            <button id="reset" type="reset" class="btn btn-secondary" hidden>
            </button>
            <button type="submit" value="submit" class="btn btn-primary" onclick="crearAviso('ubicacionesGuardar', 'Ubicación editada con éxito', 'alert-success', 2000)">
              Guardar
            </button>
          </div>
        </form>

      </div>
    </div>
  </div>
</div>


<script type="text/javascript">
  // =================== Tabla con lista de stock ========================
  
  $('#tabla_stock_por_ubicacion').bootstrapTable({
        method: 'get',
        url: "/private/docLaruex/stockDatosUbicacion/{{ubicacion.id.id}}/",
        cache: false,
        columns: [{
            title: 'Cantidad',
            field: 'cantidad',
            align: "center",
            sortable: "true",
        }, {
            title: 'Unidad',
            field: 'unidad__nombre',
            align: "center",
            sortable: "true",
        }, {
            title: 'Artículo',
            field: 'item',
            align: "center",
        },{
            title: 'Tipo de Inventario',
            field: 'categoria__categoria',
            align: "center",
            sortable: "true",
        },{
            title: '',
            field: 'min_cantidad',
            align: "center",
            sortable: "true",
            formatter: function (value, row) {
              if (row.cantidad > row.min_cantidad) {
                return (
                  '<span class="badge badge-pill badge-success">Stock Suficiente</span>'
                  
                );
                }if(row.cantidad= row.min_cantidad){
                  return (
                  '<span class="badge badge-pill badge-warning">Stock Minimo</span>'
                  );
                }else{
                  return (
                  '<span class="badge badge-pill badge-danger">Realizar pedido</span>'
                  );
                };
              }
        },{
                title: "Acciones",
                field: "action",
                align: "center",
                formatter: function (value, row) {
                  var admin = '{{administrador}}';
                  var id_usuario = '{{id_usuario}}';
                  var agregarStock = '<a href="" title="Agregar Stock" data-toggle="modal" data-target="#modalAgregarStock" onclick="$('+"'#formularioModalAgregarStock').attr('action', '/private/docLaruex/agregarUnidadesStock/"+ row.id +"/');"+'" class="mx-1" style="color: #eba43d"><i class="fa-solid fa-cart-flatbed-boxes"></i></a>';

                  var retirarStock = '<a href="" title="Agregar Stock" data-toggle="modal" data-target="#modalRetirarStock" onclick="$('+"'#formularioModalRetirarStock').attr('action', '/private/docLaruex/retirarStock/"+ row.id +"/');"+'" class="mx-1" style="color: #9768b2"><i class="fa-duotone fa-share-from-square"></i></a>';


                  var verStock = '<a href="/private/docLaruex/verItemStock/' + row.id + '/" class="mx-1" title="Abrir" ><i class="fa-solid fa-arrow-right-to-bracket fa-lg" style="color:#68B29E"></i></a>';

                  if (admin == 'True'){
                    return ( verStock + agregarStock + retirarStock
                    );
                  }else{
                    return ( verStock );
                  }        
                },
            },
    ],
        locale: "es-ES",
        search: true,
        sortName: 'id',
        sortOrder: 'desc',

    });



  // ===================== Tabla con lista de notificaciones =====================
  $("#tabla_notificaciones").bootstrapTable({
    method: "get",
    url: "/private/docLaruex/notificacionesDatos/{{ ubicacion.id.id }}/",
    cache: false,
    locale: navigator.language,
    columns: [
      {
        title: "Fecha",
        field: "fecha",
        sortable: "true",
        align: "center",
        formatter: function (value, row) {
          var fecha = new Date(row.fecha);
          return (
            $.datepicker.formatDate("dd-mm-yy", fecha)
          );
        },
      },
      {
        title: "Título",
        field: "titulo",
        align: "center",
      },
      {
        title: "Resumen",
        field: "resumen",
        align: "center",
      },
      {
        title: "Creador",
        field: "creador",
        align: "center",
        formatter: function (value, row) {
          return row.creador__first_name + " " + row.creador__last_name;
        },
      },
      {
        title: "Estado",
        field: "estado_notificacion__nombre",
        align: "center",
        formatter: function (value, row) {
          var defecto = '<span class="badge" style="background-color: #524e4e;">Enviada</span>';
          switch (row.estado_notificacion__id) {
            case 1:
              estado = '<span class="badge badge-success" style="background-color: #524e4e;">Enviada</span>';
              return estado;
              break;
            case 2:
              estado = '<span class="badge" style="background-color: #0A9396;">Recibida</span>';
              return estado;
              break;

            case 3:
              estado = '<span class="badge" style="background-color: #EB8E34;">En tramite</span>';
              return estado;
              break;
            case 4:
              estado = '<span class="badge" style="background-color: #21b563;">Cerrada</span>';
              return estado;
              break;
            case 5:
              estado = '<span class="badge" style="background-color: #b52121;">No atendida</span>';
              return estado;
              break;

            default:
              return defecto;

          }
        },
      },
    ],
    search: true,
    sortName: "id",
    sortOrder: "desc",
  });


      // cambiamos la funcionalidad del boton submit del formulario de envio de notificaciones
  // ++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
  $("#formularioModalEnviarNota").submit(function (e) {
    // cancelamos el funcionamiento por defecto del boton submit
    e.preventDefault();
    // capturamos la información del formulario 
    var data = new FormData(this);
    // ejecuta una url/action con la capacidad de gestionar la salida
    $.ajax({
      url: "/private/docLaruex/agregarNotificacion/",
      type: "POST",
      data: data,
      cache: false,
      contentType: false,
      processData: false,
      // gestiono el return del view
      success: function () {
        crearAviso('objetoGuardar', 'Notificacion guardado con éxito', 'alert-success', 2000)
        $('#tabla_notificaciones').bootstrapTable('refresh');
        $(".divFormularios").remove();
        $("#reset").trigger("click");
        $('#cerrar').trigger('click');
        
      }
    });
  });



 // Script de los mapas
    var icon =  L.divIcon({
        html: '<a onclick=abrirMapa()  target="_blank"><i class="fa-solid fa-location-dot fa-3x fa-flip" data-toggle="tooltip" title="{{ ubicacion.id.nombre }}" style="color: #07313d; --fa-animation-duration: 3s;"></i></a>',
        iconSize: [20, 20],
        className: 'myDivIcon'
      });

    var latitud = '{{ ubicacion.latitud }}';
    var longitud = '{{ ubicacion.longitud }}';

    var map = L.map('open_map').setView([latitud,longitud], 14); // cambiamos la lat y lon por donde queremos que se centre, el 10 es el zoom
    var lvPath = L.tileLayer('https://{s}.tile.openstreetmap.de/{z}/{x}/{y}.png', {
        attribution: 'Mapa de la estación ' + '{{ ubicacion.id.nombre }}',
        subdomains: 'abcd',
        minZoom: 0,
        maxZoom: 20,
        ext: 'png'
    });
    map.addLayer(lvPath);
    
    // declaramos un marcador
    var marker = L.marker([latitud, longitud], {icon: icon}).addTo(map);// sustituimos lat y lon por nuestra posicion
    
   
    
    function abrirMapa(){
      window.open("https://www.google.com/maps/dir//"+latitud+","+longitud+"");
    }

    function reverseGeocode(coords) {
      fetch('http://nominatim.openstreetmap.org/reverse?format=json&lon=' + latitud + '&lat=' + longitud)
        .then(function(response) {
                return response.json();
            }).then(function(json) {
                console.log(json);
            });
    }

    var botonEliminarPadre = document.getElementById("botonEliminarPadre");
    botonEliminarPadre.addEventListener("click", eliminarPadre);

    function eliminarPadre(){ 
      // indicamos que si se quiere eliminar la ubicación Padre
      var inputEliminarPadre = document.getElementById("inputEliminarPadre");
      inputEliminarPadre.value = 1;

      // ocultamos el boton eliminar ubicacion padre
      var botonEliminarPadre = document.getElementById("botonEliminarPadre");
      botonEliminarPadre.hidden = true;
      console.log("eliminar padre 3 ");

      
      var divAgregarPadre = document.getElementById("divAgregarPadreOculto");
      divAgregarPadre.hidden = false;
      
      // hacemos que se oculte el selector de ubicaciones padre y el label
      var selectorPadre = document.getElementById("nuevoPadre");
      selectorPadre.hidden = true;
      var labelPadre = document.getElementById("nuevoPadreLabel");
      labelPadre.hidden = true;


      // mostramos el boton de agregar padre por si se trata de una confusión
      var botonAgregarPadre = document.getElementById("botonAgregrarPadreEditar");
      botonAgregarPadre.hidden = false;
      console.log("eliminar padre 4");

    }

    
    function agregarPadre(){
      // ocultamos el bton agregarPadre
      var botonAgregarPadre = document.getElementById("botonAgregrarPadreEditar");
      botonAgregarPadre.hidden = true;
      
      var inputEliminarPadre = document.getElementById("inputEliminarPadre");
      inputEliminarPadre.value = 0;

      // mostramos el label
      var labelPadre = document.getElementById("nuevoPadreAgregarLabel");
      labelPadre.hidden = false;

      // mostramos el selector con el listado de ubicaciones padre
      var selectorPadre = document.getElementById("nuevoPadreBoton");
      selectorPadre.hidden = false;
    }


  // fin del script de los mapas
  </script>

  <script type="text/javascript">


  $(".acordion").collapse();

  $("#tabla_ubicaciones_hijo").bootstrapTable({
    method: "get",
    locale: navigator.language,
    url: "/private/docLaruex/ubicacionesDatosPadre/{{ ubicacion.id.id }}/",
    cache: false,
    columns: [
      {
        title: "",
        field: "id__icono",
        align: "center",
      },
      {
        title: "ID",
        field: "id",
        align: "center",
      },
      {
        title: "Nombre",
        field: "id__nombre",
        align: "center",
      },
      {
        title: "Latitud",
        field: "latitud",
        align: "center",
      },
      {
        title: "Longitud",
        field: "longitud",
        align: "center",
      },
      {
        title: "Tipo",
        field: "tipo_ubicacion__nombre",
        align: "center",
      },
      {
        title: "Estado",
        field: "id__id_estado__nombre",
        align: "center",
        formatter: function (value, row) {
          var estado = "";
          if (row.id__id_estado__nombre == "Operativo") {
            estado =
              '<i class="fa-solid fa-circle" style="color: #79DB77; font-size:20px" data-toggle="tooltip" data-placement="bottom" title="Operativo"></i>';
          } else if (
            row.id__id_estado__nombre == "Mantenimiento"
          ) {
            estado =
              '<i class="fa-solid fa-circle" style="color: #EB8E34; font-size:20px" data-toggle="tooltip" data-placement="bottom" title="Mantenimiento"></i>';
          } else {
            estado =
              '<i class="fa-solid fa-circle" style="color: #EB533D; font-size:20px" data-toggle="tooltip" data-placement="bottom" title="No operativo"></i>';
          }
          return estado;
        },
      },
      {
        title: "Acciones",
        field: "action",
        align: "center",
        formatter: function (value, row) {
          
          var botonVerUbicacion = '<a href="/private/docLaruex/verObjeto/' + row.id + '/" class="mx-1" title="Abrir" ><i class="fa-solid fa-arrow-right-to-bracket fa-lg" style="color:#68B29E"></i></a>';

          // Definimos las variables  
          var admin = '{{administrador}}';
          var habilitacionesUsuario = '{{habilitacionesUsuario}}';
          var habilitacionNecesaria = '{{habilitacionNecesaria}}';
          var existeHabilitacion = 'False'

          // Comprobamos si las habilitaciones del procedimiento está entre las habilitaciones del usuario logueado  
          for (var i = 0; i < habilitacionesUsuario.length; i++) {
            if (habilitacionesUsuario[i] == habilitacionNecesaria) {
              existeHabilitacion = 'True';
            }
          }
          if(existeHabilitacion == 'True' || admin == 'True') {
              return (botonVerUbicacion);
          }
        },
      },
    ],
    search: true,
    sortName: "id",
    sortOrder: "desc",
  });

  $("#tabla_equipos").bootstrapTable({
    method: "get",
    locale: navigator.language,
    url: "/private/docLaruex/equiposAsociados/{{ ubicacion.id.id }}/",
    cache: false,
    columns: [
      {
        title: "",
        field: "id__icono",
        align: "center",
      },
      {
        title: "Código Laruex",
        field: "cod_laruex",
        align: "center",          
        sortable: "true",
        formatter: function (value, row) {
          var codigo = row.cod_laruex;
          var fecha = new Date(row.fecha_alta);
          return (
            codigo + '/' + fecha.getFullYear()
          );
        },
      },
      {
        title: "Nombre",
        field: "id__nombre",
        align: "center",
      },
      {
        title: "Código Uex",
        field: "cod_uex",
        align: "center",
      },
      {
        title: "Número de serie",
        field: "num_serie",
        align: "center",
      },
      {
        title: "Fecha de alta",
        field: "fecha_alta",
        sortable: "true",
        align: "center",
        formatter: function (value, row) {
          var fecha = new Date(row.fecha_alta);
          return (
            $.datepicker.formatDate("dd-mm-yy", fecha)
          );
      },
      },
      {
        title: "Acciones",
        field: "action",
        align: "center",
        formatter: function (value, row) {
        
          var botonVerEquipo = '<a href="/private/docLaruex/verObjeto/' + row.id + '/" class="mx-1" title="Abrir" ><i class="fa-solid fa-arrow-right-to-bracket fa-lg" style="color:#68B29E"></i></a>';

          // Definimos las variables  
          var admin = '{{administrador}}';
          var habilitacionesUsuario = '{{habilitacionesUsuario}}';
          var habilitacionNecesaria = '{{habilitacionNecesaria}}';
          var existeHabilitacion = 'False'

          
          return (botonVerEquipo);
        },  
      },
    ],
    search: true,
    sortName: "id_equipo",
    sortOrder: "asc",
  });

  
  function addZero(i) {
    if (i < 10) { i = "0" + i }
    return i;
  }

  
   // Tabla con lista de referencias asociadas
   $("#tabla_referencias_asociadas").bootstrapTable({
    method: "get",
    url: "/private/docLaruex/archivosAsociados/{{ ubicacion.id.id }}/",
    cache: false,
    locale: navigator.language,
    columns: [
      {
        title: "ID",
        field: "id_relacionado",
        align: "center",
      },
      {
        title: "Nombre",
        field: "id_relacionado__nombre",
        align: "center",
      },
      {
        title: "Tipo",
        field: "id_relacionado__tipo",
        align: "center",
      },
      {
        title: "Creador",
        field: "creador",
        align: "center",
        formatter: function (value, row) {
          return (
            row.id_relacionado__creador__first_name +
            " " +
            row.id_relacionado__creador__last_name
          );
        },
      },
      {
        title: "Fecha",
        field: "id_relacionado__fecha_subida",
        sortable: "true",
        align: "center",
        formatter: function (value, row) {
          var fecha = new Date(row.id_relacionado__fecha_subida);
          return (
            $.datepicker.formatDate("dd-mm-yy", fecha) +
            " " +
            addZero(fecha.getHours()) +
            ":" +
            addZero(fecha.getMinutes())
          );
        },
      },
      {
        title: "Estado",
        field: "id_relacionado__id_estado__id",
        align: "center",
        
        formatter: function (value, row) {
          var defecto = '<span class="badge" style="background-color: #EB8E34;">En Revisión</span>';
          switch (row.id_relacionado__id_estado__id) {
            case 1:
              estado = '<span class="badge badge-success" style="background-color: #21b563;">Operativo</span>';
              return estado;
              break;
            case 2:
              estado = '<span class="badge" style="background-color: #21b563;">En Vigor</span>';
              return estado;
              break;

            case 3:
              estado = '<span class="badge" style="background-color: #EB8E34;">En Mantenimiento</span>';
              return estado;
              break;
            case 4:
              estado = '<span class="badge" style="background-color: #EB8E34;">En Revisión</span>';
              return estado;
              break;
            case 5:
              estado = '<span class="badge" style="background-color: #524e4e;">Obsoleto</span>';
              return estado;
              break;
            case 6:
              estado = '<span class="badge" style="background-color: #b52121;">No operativo</span>';
              return estado;
              break;
            case 7:
              estado = '<span class="badge" style="background-color: #b52121;">Baja</span>';
              return estado;
              break;

            default:
              console.log("No se ha encontrado el estado", row.id_relacionado__id)
              return defecto;

          }
        },
    },{
        title: "Acciones",
        field: "action",
        align: "center",
        formatter: function (value, row) {

          // Definimos las variables  
          var admin = '{{administrador}}';
          var habilitacionesUsuario = '{{ habilitacionesUsuario }}';
          var habilitacionNecesaria = row.id_relacionado__id_habilitacion;
          var existeHabilitacion = 'False';
          var objeto = '{{ubicacion.id.id}}'; 
          var rol = '{{rol}}'; 

          
          var botonVerDocumento = '<a href="/private/docLaruex/verObjeto/' + row.id_relacionado + '/" class="mx-1" title="Abrir" ><i class="fa-solid fa-arrow-right-to-bracket fa-lg" style="color:#68B29E"></i></a>';
          var botonDescargarDocumentoPDF = '<a href="/private/docLaruex/consultarArchivo/' + row.id_relacionado + '/' + '" class="mx-1" title="Descargar" download><i class="fa-solid fa-file-pdf fa-lg" style="color:#A11020"></i></a>';
          var botonDescargarDocumentoWord = '<a href="/private/docLaruex/consultarArchivoEditable/' + row.id_relacionado + '/' + '" class="mx-1" title="Descargar" download><i class="fa-duotone fa-file-signature fa-lg" style="color:#266353"></i></a>';
          var botonEliminarAsociacion = '<a href="/private/docLaruex/eliminarAsocicion/' + row.id_relacionado + '/' +  objeto + '/" class="mx-1" title="Eliminar Asociacion" data-toggle="modal" data-target="#modalEliminarAsociacion" onclick="$('+"'#formularioModalEliminarAsociacion').attr('action', '/private/docLaruex/eliminarAsocicion/"+ row.id_relacionado +"/"+ objeto + "/');"+'"  style="color:#AE2012"><i class="fa-duotone fa-link-slash" ></i></a>';

          if (admin == 'True') {
            if(row.id_relacionado__ruta_editable){

              return (botonVerDocumento + botonDescargarDocumentoPDF + botonDescargarDocumentoWord +botonEliminarAsociacion);
            }else{
              return (botonVerDocumento + botonDescargarDocumentoPDF +botonEliminarAsociacion);
            }
          } else if (rol == 'Responsable' || rol == 'Director') {
            if (row.id_relacionado){
              return (botonVerDocumento + botonDescargarDocumentoPDF + botonDescargarDocumentoWord);
            }else{
              return (botonVerDocumento + botonDescargarDocumentoPDF);
            }
            
          }else {
              return (botonVerDocumento + botonDescargarDocumentoPDF);
          }
        },
      },
    ],
    search: true,
    sortOrder: "desc",
  });

  /*
    ------------ TABLAS Y FUNCIONES DEL MODAL ASOCIAR USUARIOS ------------
  */

  //tabla del modal asociar objetos
  $("#tabla_archivos_para_asociar").bootstrapTable({
    method: "get",
    locale: navigator.language,
    url: "/private/docLaruex/archivosDatosAsociar",
    cache: false,
    columns: [
      {
        title: "ID",
        field: "id",
        align: "center",
      }, {
        title: 'Empleado',
        field: "nombre",
        align: "center",
      },{
        title: 'Tipo',
        field: "tipo",
        align: "center",
      }, {
        title: "",
        field: "action",
        align: "center",
        formatter: function (value, row) {
          return (
            '<div onclick="addValueTable(' + row.id + ', &apos;' + row.nombre + '&apos;)" class="mx-1" title="select"><i class="fa-solid fa-angles-right fa-lg" style="color:#68B29E"></i></div>'
          );
        },
      },
    ],
    search: true,
    sortName: "id",
    sortOrder: "asc",
  });

  function addValueTable(id, 
  nombre, tipo) {
    $("#tabla_archivos_para_asociar_seleccionados").bootstrapTable('insertRow', {
      index: 0,
      row: {
        id: id,
        nombre: nombre ,
      }
    });
  }

  // tatbla de elementos seleccionados
  $("#tabla_archivos_para_asociar_seleccionados").bootstrapTable({
    locale: navigator.language,
    cache: false,
    columns: [
      {
        title: "ID",
        field: 'id',
        align: "center",
      }, {
        title: "Empleado",
        field: 'nombre',
        align: "center"
      },{
        title: "",
        field: "action",
        align: "center",
        formatter: function (value, row) {
          return (
            '<div onclick="deleteValue(' + row.id + ')" class="mx-1" ><i class="fa-solid fa-xmark fa-lg" style="color:#F52220"></i></div>'

          );
        },
      },
    ],
    search: true,
    sortName: "id",
    sortOrder: "asc",
  });

  function deleteValue(id) {
    $("#tabla_archivos_para_asociar_seleccionados").bootstrapTable('remove', {
      field: 'id',
      values: [id]
    })
  }

  // cambiamos la funcionalidad del boton submit del formulario
  $("#formularioAsociarArchivo").submit(function (e) {
    // cancelamos el funcionamiento por defecto del boton submit
    e.preventDefault();
    $table = $("#tabla_archivos_para_asociar_seleccionados");
    var idSeleccionado = "";
    var cargoIDSeleccionado = "";
    for (let value of $table.bootstrapTable('getData')) {
      console.log("info file");
      console.log(value);
      idSeleccionado = idSeleccionado + value["id"] + "#";
      
      console.log(idSeleccionado);
    }
    
    $("#idArchivosSeleccionados").val(idSeleccionado);
    console.log($("#idArchivosSeleccionados").val());
    // capturamos la información del formulario 
    var data = new FormData(this);
    // ejecuta una url/action con la capacidad de gestionar la salida
    
    $.ajax({
      url: "/private/docLaruex/asociarArchivo/{{ ubicacion.id.id }}/",
      type: "POST",
      data: data,
      cache: false,
      contentType: false,
      processData: false,
      // gestiono el return del view
      success: function () {
        $table.bootstrapTable('removeAll');
        $("#idArchivosSeleccionados").val("");
        $('#tabla_referencias_asociadas').bootstrapTable('refresh');
        $('#cerrarAsociar').trigger('click');
      }
    });
  });

       // cambiamos la funcionalidad del boton submit del formulario de envio de notificaciones
  // ++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
  $("#formularioEditarUbicacion").submit(function (e) {
    // cancelamos el funcionamiento por defecto del boton submit
    e.preventDefault();
    // capturamos la información del formulario 
    var data = new FormData(this);
    // ejecuta una url/action con la capacidad de gestionar la salida
    $.ajax({
      url: "/private/docLaruex/editarObjeto/{{ubicacion.id.id}}/",
      type: "POST",
      data: data,
      cache: false,
      contentType: false,
      processData: false,
      // gestiono el return del view
      success: function () {
        crearAviso('objetoGuardar', 'Ubicación modificada con éxito', 'alert-success', 2000);
        $("#reset").trigger("click");
        $('#cerrar').trigger('click');
        location.reload();
        
      }
    });
  });
  

  $("#tabla_llaves_almacenadas").bootstrapTable({
    method: "get",
    url: "/private/docLaruex/llavesAlmacenadasUbicacionsDatos/{{ ubicacion.id.id }}/",
    cache: false,
    locale: navigator.language,
    columns: [
    {
      title: 'Color',
      field: 'id_llave__color',
      align: "center",
      formatter: function (value, row) {
        var color = row.id_llave__color;
          return('<i class="fa-solid fa-key fa-2x" style="color: ' + color + '"></i>');
      },
    },{
      title: 'Código',
      field: 'id_llave__id',
      align: "center"
    },{
      title: 'Nombre',
      field: 'id_llave__nombre',
      align: "center"
    },{
      title: '¿Qué abre?',
      field: 'id_ubicacion__id__nombre',
      align: "center",
      formatter: function (value, row) {
        if(row.id_ubicacion__id__padre){
          return("[" + row.id_ubicacion__id__padre__nombre + "] "+ row.id_ubicacion__id__nombre);
        }else{
          return(row.id_ubicacion__id__nombre);

        }
      },
    },{
      title: "Acciones",
      field: "action",
      align: "center",
      formatter: function (value, row) {
        var admin = '{{administrador}}';
        var botonVerLlave = '<a href="/private/docLaruex/verLlave/' + row.id_llave__id + '/" class="mx-1" title="Abrir" ><i class="fa-solid fa-arrow-right-to-bracket fa-lg" style="color:#68B29E"></i></a>';
        if (admin == 'True') { 
          var botonEditarLlave = '<a href="/private/docLaruex/editarLlave/' + row.id_llave__id + '/' + '" class="mx-1" title="Editar"><i class="fa-duotone fa-money-check-pen" style="color:#4F5775"></i></a>';
          return (botonVerLlave + botonEditarLlave);
        } else {
          return (botonVerLlave);
        }
      },
  },
    ],
    search: true,
    sortName: "id",
    sortOrder: "desc",
  });
  
  </script><!--collapse con listado de equipos asociados a la estación -->
{% endblock %}