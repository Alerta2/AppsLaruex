{% extends "base/base_docLaruex.html" %}
{% load static %}

{% block content %}

<style>
  .nav-tabs-bordered .nav-link {
    margin-bottom: -2px;
    border: none;
    color: #2c384e;
}
  .nav-tabs-bordered .nav-link.active {
    background-color: #fff;
    color: #4154f1;
    border-bottom: 2px solid #4154f1;
}
.nav-tabs {
    --bs-nav-tabs-border-color: #dee2e6;
    --bs-nav-tabs-border-radius: 0.375rem;
    --bs-nav-tabs-link-hover-border-color: #e9ecef #e9ecef #dee2e6;
    --bs-nav-tabs-link-active-color: #495057;
    --bs-nav-tabs-link-active-bg: #fff;
    --bs-nav-tabs-link-active-border-color: #dee2e6 #dee2e6 #fff;
    border-bottom: var(--bs-nav-tabs-border-width) solid var(--bs-nav-tabs-border-color);
}

  /*===========================
    Section Title One CSS
  ===========================*/
  .section-title-one {
    text-align: center;
    max-width: 750px;
    margin: auto;
    margin-bottom: 50px;
    position: relative;
    z-index: 5;
    color: rgb(16, 110, 134);
  }
  @media only screen and (min-width: 768px) and (max-width: 991px) {
    .section-title-one {
      margin-bottom: 45px;
    }
  }
  @media (max-width: 767px) {
    .section-title-one {
      margin-bottom: 35px;
    }
  }
  .section-title-one h2 {
    margin-bottom: 15px;
  }
  @media only screen and (min-width: 768px) and (max-width: 991px) {
    .section-title-one h2 {
      font-size: 2rem;
      line-height: 2.8rem;
    }
  }
  @media (max-width: 767px) {
    .section-title-one h2 {
      font-size: 1.5rem;
      line-height: 1.9rem;
    }
  }

  /*===========================
    Otros CSS
  ===========================*/
  
  hr {
    height: 10px;
    width: 20%;
    margin: auto;
    background-color: rgb(5, 215, 243);
    color: rgb(5, 215, 243);
  }

  h6 {
    font-family: 'Poppins', sans-serif;
    color: #394747;
    font-size: 36px;
  }



  ul.pagination li .page-link {
    background-color: rgb(255, 255, 255) !important;
    color: rgb(41, 68, 87);

  }

  ul.pagination li.active .page-link {
    background-color: rgb(41, 68, 87) !important;
    border-color: rgb(41, 68, 87) !important;
  }

  ul.pagination li .page-link:hover {
    filter: brightness(85%);

  }

  ul.pagination li.active .page-link:hover {
    filter: brightness(120%);

  }

  .btn-light {
    color: rgb(41, 68, 87);
  }

  th {
    color: rgb(41, 68, 87);
  }

  .addFicheroEditable {
    color: rgb(9, 58, 65);
  }

  .addFicheroEditable:hover {
    color: rgb(133, 198, 228);
  }

  /* estilo añadirFichero PDF*/
  .addFicheroPDF {
    color: rgb(161, 16, 32);
  }

  .addFicheroPDF:hover {
    color: rgb(99, 10, 20);
  }


  /* hover de los botones*/
  .enlace:hover {
    color: #064061;
  }

  .descargaWord:hover {
    color: #064061;
  }  
  .enviarNotificacion:hover {
    color: #064061;
  }

  .modificarObjeto:hover {
    color: #bb3e03;
  }

  .descargaPDF:hover {
    color: #6c0900;
  }

  .file-upload {
    border: 1px solid #ccc;
    display: inline-block;
    padding: 6px 12px;
    cursor: pointer;
  }

  .highlight-row {
  background-color: #66ffc763;
}



</style>

{% if procedimiento.id_doc.id_estado.id == 5 %}
<div class="jumbotron" style="background-image: linear-gradient(to bottom right, #FFA13B, #cb0f0f);">
  <h1 class="display-3" style="color: #ffffff; text-align: center;"><strong>¡Cuidado!</strong></h1>
  <h3  style="color: #ffffff; text-align: center;">El procedimiento que está visualizando está obsoleto</h3>
</div>

{% elif procedimiento.id_doc.id_estado.id == 3 %}
<div class="jumbotron" style="background-image: linear-gradient(to bottom right, #D9AFD9, #97D9E1);">
  <h1 class="display-3" style="color: #ffffff; text-align: center;"><strong>¡Cuidado!</strong></h1>
  <h3  style="color: #ffffff; text-align: center;">El procedimiento que está visualizando está en mantenimiento</h3>
</div>


{% elif procedimiento.id_doc.id_estado.id == 4 %}
<div class="jumbotron" style="background-image: linear-gradient(to bottom right, #4e73df, #4baea0);">
  <h1 class="display-3" style="color: #ffffff; text-align: center;"><strong>¡Cuidado!</strong></h1>
  <h3  style="color: #ffffff; text-align: center;">El procedimiento que está visualizando está en revisión</h3>
</div>
{% endif %}

<!-- ============= breadcrumb ============= -->
<div class="card-body">
  <nav><h5 class="card-title">{{ procedimiento.id_doc.nombre }} {{ procedimiento.titulo }}</h5>
    <div class="row">
      <div class="col-8">
        <ol class="breadcrumb" style="background-color:#fff !important">
          <li class="breadcrumb-item" style="font-size: large;"><a href="{% url 'docLaruex:docLaruexPortada' %}"><i
                class="bi bi-house-door"></i></a></li>
          <li class="breadcrumb-item" style="font-size: large;"><a href="{% url 'docLaruex:docLaruexObjeto' %}">Listado de Objetos</a></li>
          <li class="breadcrumb-item" style="font-size: large;"><a
              href="\private/docLaruex/tipoObjeto/{{ procedimiento.id_doc.tipo }}/">
              {{ procedimiento.id_doc.tipo }}s</a></li>
          <li class="breadcrumb-item active" style="font-size: large;">{{ procedimiento.id_doc.nombre }}</li>
        </ol>
      </div>
      <div class="d-flex justify-content-end">
        <a class="mx-1" title="Enviar nota relacionada con {{ procedimiento.id_doc.nombre }}" data-toggle="modal" data-target="#modalFormularioEnviarNota" style="color: #001219; align-items: md-center"><i class="fa-duotone fa-message-pen fa-2x enviarNotificacion"></i></a>
        <a class="mx-1" title="Notas relacionadas con {{ procedimiento.id_doc.nombre }}" data-toggle="modal" data-target="#modalFormularioVerNotas" style="color: #001219; align-items: md-center"><i class="fa-duotone fa-messages fa-2x enviarNotificacion"></i></a>
      </div>
    </div>
  </nav>
</div>



<!-- =================== Información de Proveedor =================== -->

<section class="section profile">
  <div class="row">
    <div class="col-xl-4">

      <div class="card">
        <div class="card-body profile-card pt-4 d-flex flex-column align-items-center">
          
          <div class="card-icon rounded-circle d-flex align-items-center justify-content-center"
            style="background-color: #41c9ef2f;"><i class="fa-solid fa-books fa-4x" style="color: #18414b; "></i>
          </div>
             
          <div class="text-center">
          <h3 class="my-2">
              {% if procedimiento.id_doc.id_estado.id == 1 or procedimiento.id_doc.id_estado.id == 2 %}
              <span class="badge text-white"
                  style="background-color: #21b563; vertical-align:middle">{{procedimiento.id_doc.id_estado.nombre}}</span>
            {% elif procedimiento.id_doc.id_estado.id == 3 or procedimiento.id_doc.id_estado.id == 4 %}
            <span class="badge text-white"
                style="background-color: #EB8E34; vertical-align:middle">{{procedimiento.id_doc.id_estado.nombre}}</span>
            {% elif procedimiento.id_doc.id_estado.id == 5 %}
            <span class="badge text-white "
                style="background-color: #524e4e; vertical-align:middle">{{procedimiento.id_doc.id_estado.nombre}}</span>
            {% else %}
            <span class="badge text-white "
                style="background-color: #b52121; vertical-align:middle">{{procedimiento.id_doc.id_estado.nombre}}</span>
            {% endif %}
          </h3>
          </div> 
  
          <h2>{{procedimiento.id_doc.nombre}}</h2>
          <h3 class="text-center">{{procedimiento.titulo}}</h3>  
          
          
            
          <!-- ======= Botones ======-->
          <h6 class="d-flex justify-content-end">            
          {% if cargo == "Responsable" or administrador %}
            <a href="/archivos/{{ procedimiento.id_doc.tipo }}/{{ procedimiento.id_doc.ruta }}"
              title="Agregar una plantilla de formato y asociarlo al procedimiento" class="mx-1" data-toggle="modal"
              data-target="#modalAsociarFormato" style="color: #0a9396"><i
                class="fa-duotone fa-file-invoice  enlace"></i></a>
            <!-- boton que permite la carga de nuevas versiones del procedimiento -->

            <a href="/archivos/{{ procedimiento.id_doc.tipo }}/{{ procedimiento.id_doc.ruta }}"
              title="Subir nueva versión de Procedimiento" class="mx-1" data-toggle="modal" data-toggle="tooltip"
              data-target="#modalActualizarVersion" style="color: #005f73; align-items: md-center" download><i
                class="fa-duotone fa-book-circle-arrow-up enlace"></i></a>

            <!-- boton que permite asociar elementos al formato actual-->
            <a href="/archivos/{{ documento.id_doc.tipo }}/{{ documento.id_doc.ruta }}"
              title="Asociar referencia a un archivo u objeto" class="mx-1" data-toggle="modal" data-toggle="tooltip"
              data-target="#modalAsociarArchivo" style="color: #0A9396;" download><i
                class="fa-duotone fa-link  enlace"></i></a>

            <!-- boton que permite asociar elementos al formato actual-->
            <a href="/archivos/{{ documento.id_doc.tipo }}/{{ documento.id_doc.ruta }}"
            title="Añadir anexo al procedimiento {{ procedimiento.id_doc.nombre }}" class="mx-1" data-toggle="modal" data-toggle="tooltip"
            data-target="#modalAgregarAnexo" style="color: #db870a;"><i
              class="fa-duotone fa-file-plus enlace"></i></a>
          {% endif %}


          {% if cargo == "Técnico" or cargo == "Responsable" or administrador %}
          <!-- boton que permite la descarga del procedimiento que estamos visualizando-->
          <a href="{{ media }}/{{ procedimiento.id_doc.tipo }}/{{ procedimiento.id_doc.ruta }}"
            title="Descarga procedimiento pdf" class="mx-1" style="color: #ae2012; align-items: md-center" download><i
            class="fa-duotone fa-file-pdf descargaPDF"></i></a>

        {% endif %}
        {% if cargo == "Responsable" or administrador %} 
          {% if procedimiento.id_doc.ruta_editable %}
            <a href="{{ media }}/{{ procedimiento.id_doc.tipo }}/{{ procedimiento.id_doc.ruta_editable }}"
              title="Descarga procedimiento word" class="mx-1" style="color: #1d6893; align-items: md-center" download><i
                class="fa-solid fa-file-word descargaWord"></i></a>
          {% endif %}
          <a title="cambiar estado" class="mx-1" data-target="#modalFormularioCambiarEstado" data-toggle="modal"
          style="color: #001219; align-items: md-center"><i class="fa-duotone fa-sign-hanging descargaWord"></i></a>
        {% endif %}
          </h6>
        </div>
      </div>

    </div>

    <div class="col-xl-8">

      <div class="card">
        <div class="card-body pt-3">
          <!-- Bordered Tabs -->
          <ul class="nav nav-tabs nav-tabs-bordered">

            <li class="nav-item">
              <button class="nav-link active" data-bs-toggle="tab" data-bs-target="#profile-overview">Información</button>
            </li>  

            <li class="nav-item">
              <button class="nav-link" data-bs-toggle="tab" data-bs-target="#profile-formatos">Formatos</button>
            </li> 
            <li class="nav-item">
              <button class="nav-link" data-bs-toggle="tab" data-bs-target="#profile-referencias-asociadas">Documentos y Referencias</button>
            </li>

            <li class="nav-item">
              <button class="nav-link" data-bs-toggle="tab" data-bs-target="#profile-historial-procedimiento">Historial de versiones</button>
            </li>           

            

            {% if administrador %}
            <li class="nav-item">
              <button class="nav-link" data-bs-toggle="tab" data-bs-target="#profile-editar">
                Editar
              </button>
            </li>
            
            <li class="nav-item">
              <button class="nav-link" data-bs-toggle="tab" data-bs-target="#profile-eliminar">Eliminar</button>
            </li>
            {% endif %}

          </ul>
          <div class="tab-content pt-2">
            <!-- Información destacada del procedimiento -->
            <div class="tab-pane fade show active profile-overview" id="profile-overview">
              <h5 class="card-title">Información del {{procedimiento.id_doc.nombre}}</h5>

              <div class="row">
                <div class="col-lg-3 col-md-4 label">Fecha</div>
                <div class="col-lg-9 col-md-8">{{ procedimiento.fecha_verificacion.date }}</div>
              </div>

              <div class="row">
                <div class="col-lg-3 col-md-4 label ">Título</div>
                <div class="col-lg-9 col-md-8">{{procedimiento.titulo}}</div>
              </div>

              <div class="row">
                <div class="col-lg-3 col-md-4 label ">Versión</div>
                <div class="col-lg-9 col-md-8">{{ procedimiento.version }}</div>
              </div>

              <div class="row">
                <div class="col-lg-3 col-md-4 label ">Responsable</div>
                <div class="col-lg-9 col-md-8">
                  {{ procedimiento.responsable.first_name }} {{procedimiento.responsable.last_name}}</div>
              </div>


              <div class="row">
                <div class="col-lg-3 col-md-4 label">Revisor</div>
                <div class="col-lg-9 col-md-8">{{ procedimiento.revisor.first_name }} {{procedimiento.revisor.last_name}}</div>
              </div>

              
              <h5 class="card-title">Modificaciones</h5>
              <p class="medium fst-italic" style="white-space: pre-line;">{{ procedimiento.modificaciones }}</p>


              <h5 class="card-title">Otra información</h5>

              <div class="row">
                <div class="col-lg-3 col-md-4 label">Habilitación:</div>
                <div class="col-lg-9 col-md-8">{{procedimiento.id_doc.id_habilitacion.titulo}}</div>
              </div>

              <div class="row">
                <div class="col-lg-3 col-md-4 label">Subido por:</div>
                <div class="col-lg-9 col-md-8">{{ procedimiento.id_doc.creador.first_name }} {{ procedimiento.id_doc.creador.last_name }}</div>
              </div>

            </div>

            <!-- Formatos plantillas -->
            <div class="tab-pane fade profile-formatos pt-3" id="profile-formatos">


              <h5 class="card-title">Plantillas de los formatos asociados al {{procedimiento.id_doc.nombre}}</h5> 
              <table id="tabla_formatos_asociados" data-toggle="table" data-search="true" data-show-columns="true"
              data-show-columns-toggle-all="true" data-show-fullscreen="true" data-buttons="buttons" data-show-toggle="true"
              data-buttons-class="" data-show-export="true" data-export-types="['excel', 'pdf']" data-show-refresh="true"
              data-pagination="true" data-id-field="id" data-page-list="[10, 25, 50, 100, All]" data-toolbar="#toolbar">
              </table>
                          
            </div>

            <!-- Historial de versiones del procedimiento -->
            <div class="tab-pane fade profile-historial-procedimiento pt-3" id="profile-historial-procedimiento">

              <h5 class="card-title">Histórico del {{procedimiento.id_doc.nombre}}</h5>
              <table id="tabla_historial_procedimientos" data-toggle="table" data-search="true" data-show-columns="true"
              data-show-columns-toggle-all="true" data-show-fullscreen="true" data-buttons="buttons" data-show-toggle="true"
              data-buttons-class="" data-show-export="true" data-export-types="['excel', 'pdf']" data-show-refresh="true"
              data-pagination="true" data-id-field="id" data-page-list="[10, 25, 50, 100, All]" data-toolbar="#toolbar">
              </table>

            </div>

            <!-- Referencias Asociadas -->
            <div class="tab-pane fade profile-referencias-asociadas pt-3" id="profile-referencias-asociadas">

              <!-- Tabla de referencias Asociadas -->
              <table id="tabla_referencias_asociadas" data-toggle="table" data-search="true" data-show-columns="true"
              data-show-columns-toggle-all="true" data-show-fullscreen="true" data-buttons="buttons" data-show-toggle="true"
              data-buttons-class="" data-show-export="true" data-export-types="['excel', 'pdf']" data-show-refresh="true"
              data-pagination="true" data-id-field="id" data-page-list="[10, 25, 50, 100, All]" data-toolbar="#toolbar"></table>

            </div>


            <!-- Editar Procedimiento -->
            <div class="tab-pane fade profile-editar pt-3" id="profile-editar">

              <!-- Edit Form -->
              <form id="formularioEditarProcedimiento" action="/private/docLaruex/editarObjeto/{{procedimiento.id_doc.id}}/" method="POST"
              enctype="multipart/form-data">
              {% csrf_token %}

                <div class="row mb-3">
                  <label for="nuevaHabilitacion" class="col-md-4 col-lg-3 col-form-label">Habilitación</label>
                    <div class="col-md-8 col-lg-9">
                      <select class="form-control" id="nuevaHabilitacion" name="nuevaHabilitacion">
                        <option value="{{procedimiento.id_doc.id_habilitacion.id}}" selected hidden>{{itemStock.id_ubicacion__id__nombre}}
                          {{procedimiento.id_doc.id_habilitacion.titulo}} 
                        </option>
                        {% for habilitacion in habilitaciones %}
                        <option value="{{habilitacion.id}}">
                          {{habilitacion.titulo}}
                        </option>
                        {% endfor %}
                      </select>
                    </div>
                </div>

                <div class="row mb-3">
                  <label for="nuevoTitulo" class="col-md-4 col-lg-3 col-form-label">Titulo</label>
                  <div class="col-md-8 col-lg-9">
                    <input name="nuevoTitulo" type="text" class="form-control" id="nuevoTitulo" pattern="[a-zA-Z\w\s\sáéíóúÁÉÍÓÚüÜñÑ,]{1,255}" value="{{procedimiento.titulo}}">
                  </div>
                </div>

                <div class="row mb-3">
                  <label for="nuevoNombre" class="col-md-4 col-lg-3 col-form-label">Nombre</label>
                  <div class="col-md-3 col-lg-3">
                    <input name="nuevoNombre" type="text" class="form-control" id="nuevoNombre" value="{{procedimiento.id_doc.nombre}}" >
                  </div>
                  <label for="nuevaVersion" class="col-md-3 col-lg-3 col-form-label d-flex justify-content-end">Version</label>
                  <div class="col-md-2 col-lg-2 ">
                    <input name="nuevaVersion" type="number" class="form-control" id="nuevaVersion" value="{{procedimiento.version}}" >
                  </div>
                </div>  

                 
                
                <div class="row mb-3">
                  <label for="nuevaFechaVerificacion" class="col-md-4 col-lg-3 col-form-label">Fecha de Verificación</label>
                  <div class="col-md-4 col-lg-4">
                    <input type="date" placeholder="{{itemStock.cantidad}}"class="form-control" name="nuevaFechaVerificacion" id="nuevaFechaVerificacion" value="{{procedimiento.fecha_verificacion.date|safe }}">
                  </div>
                </div>

                <div class="row mb-3">
                  <label for="nuevoResponsable" class="col-md-4 col-lg-3 col-form-label">Responsable</label>
                    <div class="col-md-4 col-lg-4">
                      <select class="form-control" id="nuevoResponsable" name="nuevoResponsable">
                        <option value="{{procedimiento.responsable.id}}" selected hidden>{{procedimiento.responsable.first_name}}
                          {{procedimiento.responsable.last_name}}</option>
                        {% for responsable in responsables %}
                        <option value="{{responsable.id}}">
                          {{responsable.first_name}} {{responsable.last_name}}
                        </option>
                        {% endfor %}
                      </select>
                    </div>
                </div>

                
                <div class="row mb-3">
                  <label for="nuevoRevisor" class="col-md-4 col-lg-3 col-form-label">Revisor</label>
                    <div class="col-md-4 col-lg-4">
                      <select class="form-control" id="nuevoRevisor" name="nuevoRevisor">
                        <option value="{{procedimiento.revisor.id}}" selected hidden> {{procedimiento.revisor.first_name}}
                          {{procedimiento.revisor.last_name}}</option>
                        {% for responsable in responsables %}
                        <option value="{{responsable.id}}">
                          {{responsable.first_name}} {{responsable.last_name}}
                        </option>
                        {% endfor %}
                      </select>
                    </div>
                </div>

                <div class="row mb-3">
                  <label for="nuevaModificacion" class="col-md-4 col-lg-3 col-form-label">Modificaciones</label>
                  <div class="col-md-8 col-lg-9">
                    <textarea name="nuevaModificacion" class="form-control" id="nuevaModificacion" style="height: 100px">{{ procedimiento.modificaciones}}</textarea>
                  </div>
                </div>

                <div class="row mb-3 d-flex justify-content-center">
                  
                  <div class="col-md-6 col-lg-6  d-flex justify-content-end">
                      <div class="form-group">
                        <label for="nuevoAdjuntoProcedimiento"><i class="fa-solid fa-file-pdf fa-4x addFicheroPDF">
                          </i>
                        </label>
                        <input type="file" class="form-control-file" style="display: none; visibility: none;" id="nuevoAdjuntoProcedimiento"
                          name="nuevoAdjuntoProcedimiento" onchange="mostrarNombreArchivoNuevo(this.value)" />
                        <spam class="text-center"><strong id="mostrarNombreArchivoNuevo"><br></strong>
                          <spam id="nuevo-file-name"></spam>
                      </div>
                    
                  </div>
                  <div class="col-md-6 col-lg-6  d-flex justify-content-start">

                      <div class="form-group">
                        <label for="nuevoAdjuntoEditableProcedimiento"><i class="fa-solid fa-file-signature fa-4x addFicheroEditable">
                          </i>
                        </label>
                      
                        <input type="file" class="form-control-file" style="display: none; visibility: none;"
                          id="nuevoAdjuntoEditableProcedimiento" name="nuevoAdjuntoEditableProcedimiento"
                          onchange="mostrarNombreArchivoEditableNuevo(this.value)" />
                      
                      
                        <spam class="text-center"><strong id="mostrarNombreArchivoEditableNuevo"><br></strong>
                          <spam id="nuevo-file-name-editable"></spam>
                        </spam>
                      </div>
                    </div>
                </div>

                <div class="text-center">
                  <button type="submit" class="btn btn-primary" >Guardar</button>
                </div>
              </form><!-- End Profile Edit Form -->

            </div>

            <!-- Eliminar Procedimiento -->
            <div class="tab-pane fade profile-edit pt-3" id="profile-eliminar">

              <!-- Formulario eliminar Procedimiento -->
              <form form id="fomularioEliminarObjeto" action="/private/docLaruex/eliminarObjeto/{{ procedimiento.id_doc.id }}/"
              method="POST" enctype="multipart/form-data">
              {% csrf_token %}

                <div class="row mb-3">
                  <label class="text-center">¿Estás seguro de eliminar el procedimiento {{procedimiento.id_doc.nombre}} versión {{procedimiento.version}} ({{procedimiento.titulo}})?</label>
                </div>
                <div class="text-center">
                  <button id="eliminarProcedimiento" type="submit" class="btn btn-danger" onclick="crearAviso('guardarEliminarProcedimiento', 'Procedimiento {{ procedimiento.nombre }} eliminado con éxito', 'alert-success', 3000)">Eliminar</button>

                  <button  id="canclearEliminarStock" type="reset" class="btn btn-secondary" onclick="crearAviso('cerrarEliminarProcedimiento', 'No se ha podido eliminar el procedimiento {{ procedimiento.id_doc.nombre }}{{ procedimiento.version }}', 'alert-warning', 3000); location.reload()">Cancelar</button>
                </div>
              </form><!-- End Profile Edit Form -->

            </div>

          </div><!-- End Bordered Tabs -->

        </div>
      </div>

    </div>
  </div>
</section>

<!-- ============= MODALS ============= -->



<!-- Modal Asociar Formato Plantilla con Formulario -->

<div id="modalAsociarFormato" class="modal fade bd-example-modal-lg" tabindex="-1" role="dialog"
  aria-labelledby="modalAsociarFormato" aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-dialog-centered modal-lg">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="TituloModal"><strong>Asociar Formato al Procedimiento
            {{procedimiento.id_doc.nombre}}</strong>

        </h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <!-- END Cabecera del ModalAsciarFormato -->

      <!-- Body del ModalAsociarFormato -->
      <div class="modal-body">
        <form id="formularioAsociarFormato" enctype="multipart/form-data">
          {% csrf_token %}
          <div class="row" hidden>
            <div class="col">
              <div class="form-group">
                <label for="habilitacion">Habilitación</label>
                <select class="form-select" data-rule="required" id="habilitacion" name="habilitacion">
                  <option value="{{procedimiento.id_doc.id_habilitacion.id}}" selected>
                    {{procedimiento.id_doc.id_habilitacion.titulo}}
                  </option>
                </select>
              </div>
            </div>
          </div>
          <div class="row">
            <div class="col">
              <div class="form-group">
                <label for="tipoObjeto">Tipo de Archivo</label>
                <input type="text" class="form-control" id="tipoObjeto" name="tipoObjeto" data-rule="required" readonly
                  value="Formato" />
              </div>
            </div>
            <div class="col">
              <div class="form-group">
                <label for="procedimientoAsociado">Procedimiento Asociado</label>
                <input type="text" class="form-control" id="procedimientoAsociado" name="procedimientoAsociado"
                  data-rule="required" readonly value="{{procedimiento.id_doc.nombre}}" />
              </div>
            </div>
            
            <div class="col" hidden>
              <div class="form-group">                  
                <input type="text" id="padreFormato" name="padre" class="form-control"
                required value="{{procedimiento.id_doc.id}}" readonly />
              </div>
            </div>
            <div class="col">
              <div class="form-group">
                <label for="plantilla">Plantilla</label>
                <input type="text" class="form-control" id="plantilla" name="plantilla" data-rule="required" readonly
                  hidden value="1" />
                <input type="text" class="form-control" readonly value="Plantilla" />
              </div>
            </div>
          </div>

          <div class="row">
            <div class="col-3">
              <div class="form-group">
                <label for="fechaEdicion">Fecha de Edición</label>
                <input type="date" id="fechaEdicion" name="fechaEdicion" class="form-control" required />
              </div>
            </div>

            <div class="col-3">
              <div class="form-group">
                <label for="nombreObjeto">Nombre del Formato</label>
                <input type="text" class="form-control" id="nombreObjeto" placeholder="Ej. F-07 " name="nombreObjeto"
                  data-rule="required" pattern="[F]{1}[-]{1}[0-9]{1,4}"
                  title="El formato debe seguir la siguiente estructura F-032 o F-01" />
              </div>
            </div>

            <div class="col-2">
              <div class="form-group">
                <label for="versionFormato">Version</label>
                <input type="number" class="form-control" id="version" placeholder="3 " name="versionFormato"
                  data-rule="required" />
              </div>
            </div>

            <div class="col-4">
              <div class="form-group">
                <label for="AdjuntoEditable">¿Tiene archivo editable?</label>
                <select class="form-select" data-rule="required" id="AdjuntoEditable" name="AdjuntoEditable"
                  onchange="mostrarAdjuntoEditable(this.value)">
                  <option value="1">Si</option>
                  <option value="0">No</option>
                </select>
              </div>
            </div>
          </div>

          <div class="row">
            <div class="col">
              <div class="form-group">
                <label for="tituloFormato" class="col-md-auto">Titulo del Formato</label>
                <input type="text" class="form-control col-md-auto" id="tituloFormato"
                  placeholder="Formato de Calibración de Balanzas" pattern="[a-zA-Z\w\s\sáéíóúÁÉÍÓÚüÜñÑ,]{1,255}"
                  title="No permite guiones ni otros caracteres que no sean espacios" name="tituloFormato"
                  data-rule="required" />
              </div>
            </div>
            <div class="col-md-4 col-12">
              <div class="form-group">
                <label for="editor">Editor</label>
                <select class="form-select" data-rule="required" id="editor" name="editor">
                  {% for editor in editores %}
                  <option value="{{editor.id}}">
                    {{editor.first_name}} {{editor.last_name}}
                  </option>
                  {% endfor %}
                </select>
              </div>
            </div>
          </div>

          <div class="row d-flex justify-content-center">
            <div class="col-md-auto">
              <div class="form-group">
                <label for="ficheroAdjuntoFormato"><i class="fa-solid fa-file-pdf fa-4x addFicheroPDF"></i>
                </label>
                <input type="file" class="form-control-file" style="display: none; visibility: none;"
                  id="ficheroAdjuntoFormato" name="ficheroAdjuntoFormato" onchange="mostrarNombreArchivo(this.value)" />
                <spam class="text-center"><strong id="mostrarNombreArchivo"></strong>
                  <spam id="file-name"></spam>
                </spam>

              </div>
            </div>
            <div class="col-md-auto" id="adjuntoEditable" style="display: block;">
              <div class="form-group">
                <label for="ficheroAdjuntoFormatoEditable"><i
                    class="fa-solid fa-file-signature fa-4x addFicheroEditable">
                  </i>
                </label>
                <input type="file" class="form-control-file" style="display: none; visibility: none;"
                  id="ficheroAdjuntoFormatoEditable" name="ficheroAdjuntoFormatoEditable"
                  onchange="mostrarNombreArchivoEditable(this.value)" />
                <spam class="text-center"><strong id="mostrarNombreArchivoEditable"><br></strong>
                  <spam id="file-name-editable"></spam>
                </spam>
              </div>
            </div>
          </div>
          <!-- END Body del ModalAsociarFormato -->

          <!-- Footer del ModalAsociarFormato -->
          <div class="modal-footer">
            <button id="cerrarModalAsociarFormato" type="button" class="btn btn-secondary" data-dismiss="modal">
              Cerrar
            </button>
            <button type="submit" value="submit" class="btn btn-primary">
              Guardar
            </button>
          </div>
          <!-- END Footer del ModalAsociarFormato -->
        </form>
      </div>
    </div>
  </div>
</div>

<!-- Modal Actualizar Versión Procedimiento con Formulario  -->
<div id="modalActualizarVersion" class="modal fade bd-example-modal-lg" tabindex="-1" role="dialog"
  aria-labelledby="modalActualizarVersion" aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-dialog-centered modal-lg">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="TituloModal"><strong>Subir nueva versión del Procedimiento
            {{procedimiento.id_doc.nombre}}</strong>
        </h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <!-- Body del formulario modalNuevaVersion -->
      <div class="modal-body">
        <div class="modal-body">
          <form id="formularioActualizarVersion" enctype="multipart/form-data">
            {% csrf_token %}
            <div class="row" hidden>
              <div class="col">
                <div class="form-group">
                  <label for="habilitacion">Habilitación</label>
                  <input type="text" class="form-control" id="habilitacion" name="habilitacion" data-rule="required"
                    readonly value="{{procedimiento.id_doc.id_habilitacion.id}}" hidden />
                  <input type="text" class="form-control" readonly
                    value="{{procedimiento.id_doc.id_habilitacion.titulo}}" />
                </div>
              </div>
            </div>
            <div class="row" hidden>
              <div class="col-md-4 col-lg-4">
                <div class="form-group">
                  <label for="tipoObjeto">Tipo de Archivo</label>
                  <input type="text" class="form-control" id="tipoObjeto" name="tipoObjeto" data-rule="required"
                    readonly value="Procedimiento" />
                </div>
              </div>
              <div class="col-md-4 col-lg-4">
                <div class="form-group">
                  <label for="nombreObjeto">Nombre del Procedimiento</label>
                  <input type="text" class="form-control" id="nombreObjeto" name="nombreObjeto" data-rule="required"
                    readonly value="{{procedimiento.id_doc.nombre}}" />
                </div>
              </div>

              <div class="col-md-4 col-lg-4">
                <div class="form-group">
                  <label for="version">Version</label>
                  <input type="number" class="form-control" id="version" name="version" data-rule="required" readonly
                    value="{{procedimiento.version|add:'1'}}" />
                    
                  <input type="text" class="form-control" id="versionActualizada" name="versionActualizada" data-rule="required" readonly
                  value="1" hidden/>
                </div>
              </div>
          </div>
            <div class="row">
              <div class="col-md-12 col-lg-12">
                <div class="form-group">
                  <label for="tituloProcedimiento">Titulo del Procedimiento</label>
                  <input type="text" class="form-control" id="tituloProcedimiento"
                    name="tituloProcedimiento" data-rule="required" value="{{procedimiento.titulo}}" />
                </div>

              </div>
            </div>
            <div class="row">
              <div class="col-md-4 col-lg-4">
                <div class="form-group">
                  <label for="fechaVerificacion">Fecha de Verificación</label>
                  <input type="date" id="fechaVerificacion" name="fechaVerificacion" class="form-control" required />
                </div>
              </div>
              <div class="col-md-4 col-lg-4">
                <div class="form-group">
                  <label for="responsable">Responsable</label>
                  <select class="form-select" data-rule="required" id="responsable" name="responsable">
                    {% for responsable in responsables %}
                    <option value="{{responsable.id}}">
                      {{responsable.first_name}} {{responsable.last_name}}
                    </option>
                    {% endfor %}
                  </select>
                </div>
              </div>
              <div class="col-md-4 col-lg-4">
                <div class="form-group">
                  <label for="revisor">Revisor</label>
                  <select class="form-select" data-rule="required" id="revisor" name="revisor">
                    {% for revisor in revisores %}
                    <option value="{{revisor.id}}">
                      {{revisor.first_name}} {{revisor.last_name}}
                    </option>
                    {% endfor %}
                  </select>
                </div>
              </div>
            </div>
            <div class="row">
              <div class="col-md-12 col-lg-12">
                <div class="form-group">
                  <label for="revisor">Modificaciones realizadas</label>
                  <textarea class="form-control" name="modificaciones" rows="5" data-rule="required"
                    placeholder="Modificaciones realizadas" required></textarea>
                </div>
              </div>
            </div>

            <div class="row d-flex justify-content-center">
              <div class="col-md-auto">
                <div class="form-group">
                  <label for="ficheroAdjuntoProcedimiento"><i class="fa-solid fa-file-pdf fa-4x addFicheroPDF">
                    </i>
                  </label>
                  <input type="file" class="form-control-file" style="display: none; visibility: none;"
                    id="ficheroAdjuntoProcedimiento" name="ficheroAdjuntoProcedimiento"
                    onchange="mostrarNombreProcedimiento(this.value)" />
                  <spam class="text-center"><strong id="mostrarNombreProcedimiento"></strong>
                    <spam id="file-name-procedimiento"></spam>
                  </spam>
                </div>
              </div>

              <div class="col-md-auto" id="adjuntoEditable" style="display: block;">
                <div class="form-group">
                  <label for="ficheroAdjuntoProcedimientoEditable"><i
                      class="fa-solid fa-file-signature fa-4x addFicheroEditable">
                    </i>
                  </label>

                  <input type="file" class="form-control-file" style="display: none; visibility: none;"
                    id="ficheroAdjuntoProcedimientoEditable" name="ficheroAdjuntoProcedimientoEditable"
                    onchange="mostrarNombreProcedimientoEditable(this.value)" />


                  <spam class="text-center"><strong id="mostrarNombreProcedimientoEditable"><br></strong>
                    <spam id="file-name-procedimientoEditable"></spam>
                  </spam>
                </div>
              </div>
            </div>

        </div>
        <div class="modal-footer">
          <button id="cerrarActualizarVersion" type="button" class="btn btn-secondary" data-dismiss="modal">
            Cerrar
          </button>
          <button id="guardar" type="submit" value="submit" class="btn btn-primary">
            Guardar
          </button>
        </div>
        <!-- END Footer del ModalNueva version -->
        </form>
      </div>
      <!-- End Body del formulario modalNuevaVersion -->
    </div>
  </div>
</div>

<!-- ========== Modal para asociar Archivos al Formato ========== -->
<div id="modalAsociarArchivo" class="modal fade bd-example-modal-lg" tabindex="-1" role="dialog"
  aria-labelledby="modalAsociarArchivo" aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-dialog-centered modal-xl">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="TituloModal">
          <strong>
            Seleccione los archivos que desea asociar.
          </strong>
        </h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span
            aria-hidden="true">&times;</span></button>
      </div>
      <!-- END Cabecera del ModalAsciarFormato -->

      <!-- Body del modalAsociarArchivo -->
      <div class="modal-body">
        <form id="formularioAsociarArchivo">
          {% csrf_token %}
          <div class="row justify-content-center">
            <div class="col-lg-5">
              <div class="card card p-4 ">
                <h5 class="card-title text-center">Archivos</h5>
                <table class="table-sm table-hover" id="tabla_objetos_para_asociar" data-search="true"
                  data-buttons-class="light" data-pagination="true" data-id-field="id" data-page-list="[10]"
                  data-toolbar="#toolbar"></table>
              </div>
            </div>
            {% if device_info.type == 'phone' %}


            {% else %}
            <div class="col-lg-1 col-12 my-auto text-center">
              <i id="flechas" class="fa-solid fa-arrow-right-arrow-left fa-3x" style="color: rgb(41,68,87)"></i>
            </div>
            {% endif %}

            <div class="col-lg-5">
              <div class="card p-4">
                <h5 class="card-title text-center">Archivos Seleccionados</h5>
                <table id="tabla_objetos_para_asociar_seleccionados" class="table-sm table-hover" data-search="true"
                  data-buttons-class="light" data-pagination="true" data-id-field="id" data-page-list="[10]"
                  data-toolbar="#toolbar"></table>
              </div>
            </div>
          </div>
      </div>


      <input type="text" id="idFormatoActual" value="{{ procedimiento.id_doc.id }}" hidden name="idFormatoActual"
        data-rule="required" />
      <input type="text" id="idArchivosSeleccionados" hidden name="idArchivosSeleccionados" data-rule="required" />

      <!-- Footer del ModalAsociarFormato -->
      <div class="modal-footer d-flex">

        <button id="cerrarAsociar" type="button" class="btn btn-secondary" data-dismiss="modal">
          Cerrar
        </button>
        <button type="submit" value="submit" class="btn btn-primary">
          Guardar
        </button>
      </div>
      <!-- END Footer del ModalAsociarFormato -->

      </form>
    </div>
  </div>
</div><!-- END Body del ModalAsociarFormato -->
</div> <!-- END modalAsociarArchivo -->


<!-- ========== Modal Agregar Anexo ================= -->
<div id="modalAgregarAnexo" class="modal fade" tabindex="-1" role="dialog"
  aria-labelledby="myLargeModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-dialog-centered modal-lg">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="TituloModal">Añadir Anexo al {{procedimiento.id_doc.nombre}}</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <form id="formularioAgregarAnexo"
          action="/private/docLaruex/agregarArchivo/" method="POST"
          enctype="multipart/form-data">
          {% csrf_token %}
            <div class="row">
              <div class="col" hidden>
                <div class="form-group">                  
                  <input type="text" id="habilitacion" name="habilitacion" class="form-control"
                  required value="{{procedimiento.id_doc.id_habilitacion.id}}" readonly />
                </div>
              </div>
              <div class="col" hidden>
                <div class="form-group">                  
                  <input type="text" id="tipoDocumento" name="tipoDocumento" class="form-control"
                  required value="7" readonly />
                </div>
              </div>
              <div class="col" hidden >
                <div class="form-group">                  
                  <input type="text" id="tipoObjeto" name="tipoObjeto" class="form-control"
                  required value="Documento" readonly />
                </div>
              </div>
              <div class="col" hidden>
                <div class="form-group">                  
                  <input type="text" id="padreAnexo" name="padre" class="form-control"
                  required value="{{procedimiento.id_doc.id}}" readonly />
                </div>
              </div>
              <div class="col">
                <div class="form-group">
                  <label for="fechaActualizacion">Fecha</label>
                  <input type="date" id="fechaActualizacion" name="fechaActualizacion" class="form-control"
                    required />
                </div>


              </div>
              <div class="col">
                <div class="form-group">
                  <label for="versionDocumento">Version</label>
                  <input type="number" class="form-control" id="versionDocumento" placeholder="3 " name="versionDocumento"
                    data-rule="required" />
                </div>
              </div>
            </div>
            <div class="row">
              <div class="col">
                <div class="form-group">
                  <label for="nombreObjeto">Nombre del archivo</label>
                  <input type="text" class="form-control" id="nombreObjeto"
                    placeholder="Ejemplo:  Anexo I-Dispositivo de control de radón ensuelos." name="nombreObjeto" data-rule="required" />
                </div>
              </div>
            </div>

            <div class="row d-flex justify-content-center">
              <div class="col-md-auto" id="adjuntoNoEditable">
                <div class="form-group">
                  <label for="ficheroAdjuntoDocumento"><i id="pdf-file"
                      class="fa-solid fa-file-pdf fa-4x addFicheroPDF">
                    </i>
                  </label>
                  <input type="file" class="form-control-file" style="display: none; visibility: none;"
                    id="ficheroAdjuntoDocumento" name="ficheroAdjuntoDocumento"
                    onchange="mostrarNombreAnexo(this.value)" />
                  <spam class="text-center"><strong id="mostrarNombreAnexo"><br></strong>
                    <spam id="file-name-anexo"></spam>
                  </spam>

                </div>
              </div>



            <div class="modal-footer">
              <button id="cerrar" type="button" class="btn btn-secondary" data-dismiss="modal">
                Cerrar
              </button>
              <button id="reset" type="reset" class="btn btn-secondary" hidden>
              </button>
              <button type="submit" value="submit" class="btn btn-primary">
                Guardar
              </button>
            </div>
          </div>
        </form>
      </div>
    </div>
  </div>
</div>

<!-- ========== Modal Cambiar Estado ================= -->
<div id="modalFormularioCambiarEstado" class="modal fade" tabindex="-1" role="dialog" aria-labelledby="myLargeModalLabel"
  aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-dialog-centered modal-lg">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="TituloModalCambiarEstado">Cambiar estado del {{ procedimiento.id_doc.nombre}}</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <form id="formularioCambiarEstado" action="/private/docLaruex/editarEstado/{{ procedimiento.id_doc.id}}/" method="POST"
          enctype="multipart/form-data">
          {% csrf_token %}
          <div class="row">
            <div class="col">
              <div class="form-group">
                <input type="text" class="form-control" id="id_doc" name="id_doc" data-rule="required" 
                  value="{{ procedimiento.id_doc.id }}" hidden />
              </div>
            </div>
        </div>
        <div class="row">
          <div class="col-4">
            <div class="form-group">
              <label>Estado actual</label>
              <input type="text" value ="{{procedimiento.id_doc.id_estado.nombre}}" class="form-control" disabled>
            
            </div>
          </div>
          <div class="col-8">
            <div class="form-group">
              <label for="nuevoEstado">Nuevo estado</label>
               <select class="form-select my-auto" id="nuevoEstado" name="nuevoEstado" >
                {% for estado in estados %}
                  <option value="{{estado.id}}">
                    {{estado.nombre}}
                  </option>
                {% endfor %}
                </select>
            </div>
          </div>
        </div>

          <div class="modal-footer">
            <button id="cerrar" type="button" class="btn btn-secondary" data-dismiss="modal" >
              Cerrar
            </button>
            <button id="reset" type="reset" class="btn btn-secondary" hidden>
            </button>
            <button type="submit" value="submit" class="btn btn-primary" >
              Guardar
            </button>
          </div>
        </form>
      </div>
    </div>
  </div>
</div>


<!-- ========== Modal Enviar Notificacion ================= -->
<div id="modalFormularioEnviarNota" class="modal fade" tabindex="-1" role="dialog" aria-labelledby="myLargeModalLabel"
  aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-dialog-centered modal-lg">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="TituloModal">Generar notificación asociada a {{ procedimiento.id_doc.nombre}}</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <form id="formularioModalEnviarNota"  method="POST"
          enctype="multipart/form-data">
          {% csrf_token %}
          <div class="row">
            <div class="col">
              <div class="form-group">
                <input type="text" class="form-control" id="id_doc" name="id_doc" data-rule="required" 
                  value="{{ procedimiento.id_doc.id }}" hidden />
              </div>
              <div class="form-group">
                <input type="text" class="form-control" id="estadoNotificacion" name="estadoNotificacion" data-rule="required" 
                  value="1" hidden />
              </div>
            </div>
        </div>
        <div class="row">
          <div class="col-12">
              <div class="form-group">
                <label for="tituloNotificacion">Título</label>
                <input type="text" class="form-control" id="tituloNotificacion" name="tituloNotificacion" data-rule="required" required />
              </div>
          </div>
        </div>
        <div class="row">
          <div class="col-12">
            <div class="form-group">
              <label for="resumenNotificacion">Resumen</label>
              <textarea class="form-control" id="resumenNotificacion" name="resumenNotificacion" rows="5" data-rule="required"
                placeholder="Escriba un comentario" required></textarea>
            </div>

          </div>
        </div>

          <div class="modal-footer">
            <button id="cerrarNotificacion" type="button" class="btn btn-secondary" data-dismiss="modal" >
              Cerrar
            </button>
            <button id="resetNotificacion" type="reset" class="btn btn-secondary" hidden>
            </button>
            <button type="submit" value="submit" class="btn btn-primary" >
              Guardar
            </button>
          </div>
        </form>
      </div>
    </div>
  </div>
</div>


<!-- ========== Modal Ver Notas ================= -->
<div id="modalFormularioVerNotas" class="modal fade" tabindex="-1" role="dialog" aria-labelledby="myLargeModalLabel"
  aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-dialog-centered modal-lg">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="TituloModal">Generar notificación asociada a {{ procedimiento.id_doc.nombre}}</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
          {% csrf_token %}
          <div class="row">
            <div class="col">
              <table class="table-sm table-hover" id="tabla_notificaciones" data-search="true"
              data-buttons-class="light" data-pagination="true" data-id-field="id" data-page-list="[10]"
              data-toolbar="#toolbar"></table>
            </div>
        </div>

          <div class="modal-footer">
            <button id="cerrarVerNotas" type="button" class="btn btn-secondary" data-dismiss="modal" >
              Cerrar
            </button>
          </div>
      </div>
    </div>
  </div>
</div>

<!-- ============= Modal Eliminar Asociacion ====================-->

<div id="modalEliminarAsociacion" class="modal fade" tabindex="-1" role="dialog" aria-labelledby="myLargeModalLabel"
aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-dialog-centered modal-lg">
    <div class="modal-content">
      <div class="modal-header">

        <h5 class="modal-title" id="TituloModalEliminarAsociacion"><strong>¿Estas seguro que deseas eliminar esta asociación?</strong> </h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
        <form id="formularioModalEliminarAsociacion" action="/private/docLaruex/eliminarAsociacion/0/" method="POST"
          enctype="multipart/form-data">
          {% csrf_token %}
          <!-- indica el tipo de objeto se que va a añadir -->
          <div class="modal-footer d-flex justify-content-center">
            <button id="cerrarEliminarAsociacion" type="button" class="btn btn-secondary" data-dismiss="modal" hidden>Cerrar</button>
            <button class="btn btn-secondary" data-dismiss="modal"  id="cancelEliminarAsociacion" name="cancel" onclick="crearAviso('eliminarObjetoCancelar', 'No se ha podido eliminar la referencia', 'alert-warning', 3000)">Cancelar</button>
            <button type="submit" value="submit" class="btn btn-danger" onclick="crearAviso('eliminarObjetoGuardar', 'Referencia  eliminada', 'alert-success', 3000)">
              Eliminar
            </button>
          </div>
        </form>
    </div>
  </div>
</div>



<script type="text/javascript">

  // TABLAS DEFINITIVAS 

  $("#tabla_formatos_asociados").bootstrapTable({
    method: "get",
    url: "/private/docLaruex/formatosAsociados/{{ procedimiento.id_doc.nombre }}/",
    cache: false,
    locale: navigator.language,
    columns: [
      {
        title: "Código",
        field: "id_doc__nombre",
        align: "center",
      },
      {
        title: "Título",
        field: "titulo",
        align: "center",
      },
      {
        title: "Versión",
        field: "version",
        align: "center",
      },
      {
        title: "Fecha",
        field: "fecha_edicion",
        sortable: "true",
        align: "center",
        formatter: function (value, row) {
          var fecha = new Date(row.fecha_edicion);
          return (
            $.datepicker.formatDate("dd-mm-yy", fecha)
          );
        },
      },
      {
        title: "Acciones",
        field: "action",
        align: "center",
        formatter: function (value, row) {        

          var botonDescargarPDF = '<a href="/private/docLaruex/consultarArchivo/' + row.id_doc + '/' + '" class="mx-1" title="Descargar" download><i class="fa-solid fa-file-pdf fa-lg" style="color:#A11020"></i></a>';
          var botonDescargarExcel = '<a href="/private/docLaruex/consultarArchivo/' + row.id_doc + '/' + '" class="mx-1" title="Descargar" download><i class="fa-duotone fa-file-excel fa-lg" style="color:#128C33"></i></a>';
          var botonDescargarEditable = '<a href="/private/docLaruex/consultarArchivoEditable/' + row.id_doc + '/' + '" class="mx-1" title="Descargar" download><i class="fa-duotone fa-file-signature fa-lg" style="color:#266353"></i></a>';

          var botonVer = '<a href="/private/docLaruex/verObjeto/' + row.id_doc + '/" class="mx-1" title="Abrir" ><i class="fa-solid fa-arrow-right-to-bracket fa-lg" style="color:#68B29E"></i></a>';
          var botonEditar = '<a href="/private/docLaruex/editarObjeto/' + row.id_doc + '/' + '" class="mx-1" title="Editar"><i class="fa-solid fa-money-check-pen" style="color:#4F5775"></i></a>';
          var botonEliminar = '<a href="/private/docLaruex/eliminarArchivo/' + row.id_doc + '/' + '" class="mx-1" title="Eliminar"><i class="fa-solid fa-x" style="color:#AE2012"></i></a>';


          var admin = '{{administrador}}';
          if (row.id__ruta)
            extension_ruta = row.id__ruta.split(".").pop();
          if (row.id__ruta_editable)
            extension_ruta_editable = row.id__ruta_editable.split(".").pop();

          if (admin == 'True') {
            if (row.id__ruta && row.id__ruta_editable){
              if(extension_ruta_editable  == "xlsx" || extension_ruta_editable == "xls"){
                return (botonVer + botonDescargarPDF + botonDescargarExcel + botonEditar)
              }else{
                return (botonVer + botonDescargarPDF + botonDescargarEditable + botonEditar )
              }
            }else if (!row.id__ruta && row.id__ruta_editable){
              if(extension_ruta_editable  == "xlsx" || extension_ruta_editable == "xls"){
                return (botonVer  + botonDescargarExcel + botonEditar)
              }else{
                return (botonVer + botonDescargarEditable + botonEditar)
              }
            }else{
              return (botonVer  + botonDescargarPDF + botonEditar)
            }
          }else{
            
            if (row.id__ruta && row.id__ruta_editable){
              if(extension_ruta_editable  == "xlsx" || extension_ruta_editable == "xls"){
                return (botonVer + botonDescargarPDF + botonDescargarExcel)
              }else{
                return (botonVer + botonDescargarPDF + botonDescargarEditable)
              }
            }else if (!row.id__ruta && row.id__ruta_editable){
              if(extension_ruta_editable  == "xlsx" || extension_ruta_editable == "xls"){
                return (botonVer  + botonDescargarExcel)
              }else{
                return (botonVer + botonDescargarEditable)
              }
            }else{
              return (botonVer  + botonDescargarPDF)
            }
          }
        },
      },
    ],
    search: true,
    sortName: "fecha_subida",
    sortOrder: "desc",
  });


  $("#tabla_historial_procedimientos").bootstrapTable({
    method: "get",
    url: "/private/docLaruex/historialProcedimiento/{{ procedimiento.id_doc.nombre }}/",
    cache: false,
    locale: navigator.language,
    columns: [
      {
        title: "Código",
        field: "id_doc__nombre",
        align: "center",
      },
      {
        title: "Estado",
        field: "id_doc__id_estado",
        align: "center",
        formatter: function (value, row) {
          var defecto = '<span class="badge" style="background-color: #EB8E34;">En Revisión</span>';
          switch (row.id_doc__id_estado) {
            case 1:
              estado = '<span class="badge badge-success" style="background-color: #21b563;">Operativo</span>';
              return estado;
              break;
            case 2:
              estado = '<span class="badge" style="background-color: #21b563;">En Vigor</span>';
              return estado;
              break;

            case 3:
              estado = '<span class="badge" style="background-color: #EB8E34;">En Mantenimiento</span>';
              return estado;
              break;
            case 4:
              estado = '<span class="badge" style="background-color: #EB8E34;">En Revisión</span>';
              return estado;
              break;
            case 5:
              estado = '<span class="badge" style="background-color: #524e4e;">Obsoleto</span>';
              return estado;
              break;
            case 6:
              estado = '<span class="badge" style="background-color: #b52121;">No operativo</span>';
              return estado;
              break;
            case 7:
              estado = '<span class="badge" style="background-color: #b52121;">Baja</span>';
              return estado;
              break;

            default:
              console.log("No se ha encontrado el estado", row.id_doc__id_estado)
              return defecto;

          }
        },
      },
      {
        title: "Título",
        field: "titulo",
        align: "center",
      },
      {
        title: "Versión",
        field: "version",
        align: "center",
      },
      {
        title: "Responsable",
        field: "responsable",
        align: "center",
        formatter: function (value, row) {
          return (
            row.responsable__first_name + " " + row.responsable__last_name
          );
        },
      },
      {
        title: "Revisor",
        field: "revisor",
        align: "center",
        formatter: function (value, row) {
          return row.revisor__first_name + " " + row.revisor__last_name;
        },
      },
      {
        title: "Fecha",
        field: "fecha_verificacion",
        sortable: "true",
        align: "center",
        formatter: function (value, row) {
          var fecha = new Date(row.fecha_verificacion);
          return (
            $.datepicker.formatDate("dd-mm-yy", fecha) 
          );
        },
      },
      {
        title: "Modificaciones",
        field: "modificaciones",
        align: "center",
      },
      {
        title: "Acciones",
        field: "action",
        align: "center",
        formatter: function (value, row) {       

            var botonDescargarPDF = '<a href="/private/docLaruex/consultarArchivo/' + row.id_doc + '/' + '" class="mx-1" title="Descargar" download><i class="fa-solid fa-file-pdf fa-lg" style="color:#A11020"></i></a>';
            var botonDescargarExcel = '<a href="/private/docLaruex/consultarArchivo/' + row.id_doc + '/' + '" class="mx-1" title="Descargar" download><i class="fa-duotone fa-file-excel fa-lg" style="color:#128C33"></i></a>';
            var botonDescargarEditable = '<a href="/private/docLaruex/consultarArchivoEditable/' + row.id_doc + '/' + '" class="mx-1" title="Descargar" download><i class="fa-duotone fa-file-signature fa-lg" style="color:#266353"></i></a>';

            var botonVer = '<a href="/private/docLaruex/verObjeto/' + row.id_doc + '/" class="mx-1" title="Abrir" ><i class="fa-solid fa-arrow-right-to-bracket fa-lg" style="color:#68B29E"></i></a>';
            var botonEditar = '<a href="/private/docLaruex/editarObjeto/' + row.id_doc + '/' + '" class="mx-1" title="Editar"><i class="fa-solid fa-money-check-pen" style="color:#4F5775"></i></a>';
            var botonEliminar = '<a href="/private/docLaruex/eliminarArchivo/' + row.id_doc + '/' + '" class="mx-1" title="Eliminar"><i class="fa-solid fa-x" style="color:#AE2012"></i></a>';


            var admin = '{{administrador}}';
            if (row.id__ruta)
              extension_ruta = row.id__ruta.split(".").pop();
            if (row.id__ruta_editable)
              extension_ruta_editable = row.id__ruta_editable.split(".").pop();

            if (admin == 'True') {
              if (row.id__ruta && row.id__ruta_editable){
                if(extension_ruta_editable  == "xlsx" || extension_ruta_editable == "xls"){
                  return (botonVer + botonDescargarPDF + botonDescargarExcel + botonEditar)
                }else{
                  return (botonVer + botonDescargarPDF + botonDescargarEditable + botonEditar )
                }
              }else if (!row.id__ruta && row.id__ruta_editable){
                if(extension_ruta_editable  == "xlsx" || extension_ruta_editable == "xls"){
                  return (botonVer  + botonDescargarExcel + botonEditar)
                }else{
                  return (botonVer + botonDescargarEditable + botonEditar)
                }
              }else{
                return (botonVer  + botonDescargarPDF + botonEditar)
              }
            }else{
              
              if (row.id__ruta && row.id__ruta_editable){
                if(extension_ruta_editable  == "xlsx" || extension_ruta_editable == "xls"){
                  return (botonVer + botonDescargarPDF + botonDescargarExcel)
                }else{
                  return (botonVer + botonDescargarPDF + botonDescargarEditable)
                }
              }else if (!row.id__ruta && row.id__ruta_editable){
                if(extension_ruta_editable  == "xlsx" || extension_ruta_editable == "xls"){
                  return (botonVer  + botonDescargarExcel)
                }else{
                  return (botonVer + botonDescargarEditable)
                }
              }else{
                return (botonVer  + botonDescargarPDF)
              }
            }
        },
      },
    ],
    search: true,
    sortName: "fecha_subida",
    sortOrder: "desc",

    

    rowStyle: function(row, index) {
      var versionActual = "{{procedimiento.version}}";
        if (row.version == versionActual ) {
          return {classes: "highlight-row"}
        } else {
            return {}
        }
    }

  });

  $("#tabla_referencias_asociadas").bootstrapTable({
    method: "get",
    url: "/private/docLaruex/archivosAsociados/{{ procedimiento.id_doc.id }}/",
    cache: false,
    locale: navigator.language,
    columns: [
      {
        title: "Nombre",
        field: "id_relacionado__nombre",
        align: "center",
      },
      {
        title: "Tipo",
        field: "id_relacionado__tipo",
        align: "center",
      },
      {
        title: "Creador",
        field: "creador",
        align: "center",
        formatter: function (value, row) {
          return (
            row.id_relacionado__creador__first_name +
            " " +
            row.id_relacionado__creador__last_name
          );
        },
      },
      {
        title: "Fecha",
        field: "id_relacionado__fecha_subida",
        sortable: "true",
        align: "center",
        formatter: function (value, row) {
          var fecha = new Date(row.id_relacionado__fecha_subida);
          return (
            $.datepicker.formatDate("dd-mm-yy", fecha) 
          );
        },
      },
      {
        title: "Estado",
        field: "estado",
        align: "center",
        
        formatter: function (value, row) {
          var defecto = '<span class="badge" style="background-color: #EB8E34;">En Revisión</span>';
          switch (row.id_relacionado__id_estado__id) {
            case 1:
              estado = '<span class="badge badge-success" style="background-color: #21b563;">Operativo</span>';
              return estado;
              break;
            case 2:
              estado = '<span class="badge" style="background-color: #21b563;">En Vigor</span>';
              return estado;
              break;

            case 3:
              estado = '<span class="badge" style="background-color: #EB8E34;">En Mantenimiento</span>';
              return estado;
              break;
            case 4:
              estado = '<span class="badge" style="background-color: #EB8E34;">En Revisión</span>';
              return estado;
              break;
            case 5:
              estado = '<span class="badge" style="background-color: #524e4e;">Obsoleto</span>';
              return estado;
              break;
            case 6:
              estado = '<span class="badge" style="background-color: #b52121;">No operativo</span>';
              return estado;
              break;
            case 7:
              estado = '<span class="badge" style="background-color: #b52121;">Baja</span>';
              return estado;
              break;

            default:
              console.log("No se ha encontrado el estado", row.id_relacionado__id)
              return defecto;

          }
        },
      },
      {
        title: "Acciones",
        field: "action",
        align: "center",
        formatter: function (value, row) {   
          objeto = '{{procedimiento.id_doc.id}}' 
          
          var admin = '{{administrador}}';   

          var botonDescargarPDF = '<a href="/private/docLaruex/consultarArchivo/' + row.id_relacionado + '/' + '" class="mx-1" title="Descargar" download><i class="fa-solid fa-file-pdf fa-lg" style="color:#A11020"></i></a>';
          var botonDescargarExcel = '<a href="/private/docLaruex/consultarArchivo/' + row.id_relacionado + '/' + '" class="mx-1" title="Descargar" download><i class="fa-duotone fa-file-excel fa-lg" style="color:#128C33"></i></a>';
          var botonDescargarEditable = '<a href="/private/docLaruex/consultarArchivoEditable/' + row.id_relacionado + '/' + '" class="mx-1" title="Descargar" download><i class="fa-duotone fa-file-signature fa-lg" style="color:#266353"></i></a>';

          var botonVer = '<a href="/private/docLaruex/verObjeto/' + row.id_relacionado + '/" class="mx-1" title="Abrir" ><i class="fa-solid fa-arrow-right-to-bracket fa-lg" style="color:#68B29E"></i></a>';
          var botonEditar = '<a href="/private/docLaruex/editarObjeto/' + row.id_relacionado + '/' + '" class="mx-1" title="Editar"><i class="fa-solid fa-money-check-pen" style="color:#4F5775"></i></a>';
          var botonEliminar = '<a href="/private/docLaruex/eliminarArchivo/' + row.id_relacionado + '/' + '" class="mx-1" title="Eliminar"><i class="fa-solid fa-x" style="color:#AE2012"></i></a>';

          var botonEliminarReferencia = '<a href="/private/docLaruex/eliminarAsocicion/' + row.id_relacionado + '/' +  objeto + '/" class="mx-1" title="Eliminar Asociacion" data-toggle="modal" data-target="#modalEliminarAsociacion" onclick="$('+"'#formularioModalEliminarAsociacion').attr('action', '/private/docLaruex/eliminarAsocicion/"+ row.id_relacionado +"/"+ objeto + "/');"+'"  style="color:#AE2012"><i class="fa-duotone fa-link-slash" ></i></a>';


          if (row.id_relacionado__ruta)
            extension_ruta = row.id_relacionado__ruta.split(".").pop();
          if (row.id_relacionado__ruta_editable)
            extension_ruta_editable = row.id_relacionado__ruta_editable.split(".").pop();

          if (admin == 'True') {
            if (row.id_relacionado__ruta && row.id_relacionado__ruta_editable){
              if(extension_ruta_editable  == "xlsx" || extension_ruta_editable == "xls"){
                return (botonVer + botonDescargarPDF + botonDescargarExcel + botonEditar + botonEliminarReferencia)
              }else{
                return (botonVer + botonDescargarPDF + botonDescargarEditable + botonEditar + botonEliminarReferencia)
              }
            }else if (!row.id_relacionado__ruta && row.id_relacionado__ruta_editable){
              if(extension_ruta_editable  == "xlsx" || extension_ruta_editable == "xls"){
                return (botonVer  + botonDescargarExcel + botonEditar + botonEliminarReferencia)
              }else{
                return (botonVer + botonDescargarEditable + botonEditar 
                + botonEliminarReferencia)
              }
            }else{
              return (botonVer  + botonDescargarPDF + botonEditar + botonEliminarReferencia)
            }
          }else{
            
            if (row.id__ruta && row.id__ruta_editable){
              if(extension_ruta_editable  == "xlsx" || extension_ruta_editable == "xls"){
                return (botonVer + botonDescargarPDF + botonDescargarExcel)
              }else{
                return (botonVer + botonDescargarPDF + botonDescargarEditable)
              }
            }else if (!row.id__ruta && row.id__ruta_editable){
              if(extension_ruta_editable  == "xlsx" || extension_ruta_editable == "xls"){
                return (botonVer  + botonDescargarExcel)
              }else{
                return (botonVer + botonDescargarEditable)
              }
            }else{
              return (botonVer  + botonDescargarPDF)
            }
          }
        },
      },
    ],
    search: true,
    sortOrder: "desc",
  });




  // =============================================
  //          Tablas de Asociar Archivos
  // =============================================


  $("#tabla_objetos_para_asociar").bootstrapTable({
    method: "get",
    locale: navigator.language,
    url: "/private/docLaruex/objetosDatosAsociar",
    cache: false,
    columns: [
      {
        title: "Nombre",
        align: "center",
        formatter: function (value, row) {
          if (row.nombre == null)
            return row.id_doc__nombre;
          else
            return row.nombre;
        }
      },
      {
        title: "Version",
        align: "center",
        formatter: function (value, row) {
          if (row.version == null)
            return "-";
          else
            return row.version;
        }
      },
      {
        title: "Tipo",
        align: "center",
        formatter: function (value, row) {
          if (row.tipo == null)
            return row.id_doc__tipo;
          else
            return row.tipo;
        }
      },
      {
        title: "",
        field: "action",
        align: "center",
        formatter: function (value, row) {
          if (row.id == null) {
            row.id = row.id_doc__id;
            row.nombre = row.id_doc__nombre;
            row.tipo = row.id_doc__tipo;
          }
          else {
            row.version = "-";
          }
          return (

            '<div onclick="addValueTable(' + row.id + ',&apos;' + row.nombre + '&apos;,&apos;' + row.version + '&apos;,&apos;' + row.tipo + '&apos;)" class="mx-1" title="select"><i class="fa-solid fa-angles-right fa-lg" style="color:#68B29E"></i></div>'
          );
        },
      },
    ],
    search: true,
    sortName: "fecha_subida",
    sortOrder: "desc",
  });

  function addValueTable(id, nombre, version, tipo) {
    $("#tabla_objetos_para_asociar_seleccionados").bootstrapTable('insertRow', {
      index: 0,
      row: {
        id: id,
        nombre: nombre,
        id__version: version,
        tipo: tipo
      }
    });
  }

  
  // tatbla de elementos seleccionados
  $("#tabla_objetos_para_asociar_seleccionados").bootstrapTable({
    locale: navigator.language,
    cache: false,
    columns: [
      {
        title: "Nombre",
        field: "nombre",
        align: "center",
      },
      {
        title: "Version",
        field: "id__version",
        align: "center",
      },
      {
        title: "Tipo",
        field: "tipo",
        align: "center",
      },
      {
        title: "",
        field: "action",
        align: "center",
        formatter: function (value, row) {
          return (
            '<div onclick="deleteValue(' + row.id + ')" class="mx-1" ><i class="fa-solid fa-xmark fa-lg" style="color:#F52220"></i></div>'

          );
        },
      },
    ],
    search: true,
    sortName: "fecha_subida",
    sortOrder: "desc",
  });

  $("#tabla_notificaciones").bootstrapTable({
    method: "get",
    url: "/private/docLaruex/notificacionesDatos/{{ procedimiento.id_doc.id }}/",
    cache: false,
    locale: navigator.language,
    columns: [
      {
        title: "Fecha",
        field: "fecha",
        sortable: "true",
        align: "center",
        formatter: function (value, row) {
          var fecha = new Date(row.fecha);
          return (
            $.datepicker.formatDate("dd-mm-yy", fecha)
          );
        },
      },
      {
        title: "Título",
        field: "titulo",
        align: "center",
      },
      {
        title: "Resumen",
        field: "resumen",
        align: "center",
      },
      {
        title: "Creador",
        field: "creador",
        align: "center",
        formatter: function (value, row) {
          return row.creador__first_name + " " + row.creador__last_name;
        },
      },
      {
        title: "Estado",
        field: "estado_notificacion__nombre",
        align: "center",
        formatter: function (value, row) {
          var defecto = '<span class="badge" style="background-color: #524e4e;">Enviada</span>';
          switch (row.estado_notificacion__id) {
            case 1:
              estado = '<span class="badge badge-success" style="background-color: #524e4e;">Enviada</span>';
              return estado;
              break;
            case 2:
              estado = '<span class="badge" style="background-color: #0A9396;">Recibida</span>';
              return estado;
              break;

            case 3:
              estado = '<span class="badge" style="background-color: #EB8E34;">En tramite</span>';
              return estado;
              break;
            case 4:
              estado = '<span class="badge" style="background-color: #21b563;">Cerrada</span>';
              return estado;
              break;
            case 5:
              estado = '<span class="badge" style="background-color: #b52121;">No atendida</span>';
              return estado;
              break;

            default:
              return defecto;

          }
        },
      },
    ],
    search: true,
    sortName: "id",
    sortOrder: "desc",
  });


  // =============================================
  //          Funciones Auxiliares
  // =============================================

    // mostramos el nombre del archivo en el input de adjuntar archivo y cambiamos el label del boton de adjuntar archivo
  function mostrarNombreArchivoNuevo(value) {

    document.getElementById('nuevo-file-name').innerHTML = value;

    document.getElementById('mostrarNombreArchivoNuevo').style.display = 'none';
  }

  // mostramos el nombre del archivo en el input de adjuntar archivo y cambiamos el label del boton de adjuntar archivo
  function mostrarNombreArchivoEditableNuevo(value) {

    document.getElementById('nuevo-file-name-editable').innerHTML = value;


    document.getElementById('mostrarNombreArchivoEditableNuevo').style.display = 'none';

  }

  // muestra la opción de agregar un archivo editable al añadir una nueva plantilla de formato
  function mostrarAdjuntoEditable(value) {
    if (value == "1") {
      document.getElementById('adjuntoEditable').style.display = 'block';

    } else {
      document.getElementById('adjuntoEditable').style.display = 'none';
    }
  }


  // mostramos el nombre del archivo en el input de adjuntar archivo y cambiamos el label del boton de adjuntar archivo
  function mostrarNombreArchivo(value) {

    document.getElementById('file-name').innerHTML = value;

    document.getElementById('mostrarNombreArchivo').style.display = 'none';
  }
  // mostramos el nombre del archivo en el input de adjuntar archivo y cambiamos el label del boton de adjuntar archivo
  function mostrarNombreArchivoEditable(value) {

    document.getElementById('file-name-editable').innerHTML = value;


    document.getElementById('mostrarNombreArchivoEditable').style.display = 'none';

  }


  
  // mostramos el nombre del archivo en el input de adjuntar archivo y cambiamos el label del boton de adjuntar archivo
  function mostrarNombreProcedimiento(value) {

    document.getElementById('file-name-procedimiento').innerHTML = value;

    document.getElementById('mostrarNombreProcedimiento').style.display = 'none';
  }

  // mostramos el nombre del archivo en el input de adjuntar archivo y cambiamos el label del boton de adjuntar archivo
  function mostrarNombreProcedimientoEditable(value) {

    document.getElementById('file-name-procedimientoEditable').innerHTML = value;


    document.getElementById('mostrarNombreProcedimientoEditable').style.display = 'none';

  }

  // mostramos el nombre del archivo en el input de adjuntar archivo y cambiamos el label del boton de adjuntar archivo
  function mostrarNombreAnexo(value) {

    document.getElementById('file-name-anexo').innerHTML = value;

    document.getElementById('mostrarNombreAnexo').style.display = 'none';
  }


  // =============================================
  //              Formularios
  // =============================================

    // cambiamos la funcionalidad del boton submit al agregar un nuevo formulario
    $("#formularioAsociarFormato").submit(function (e) {
    // cancelamos el funcionamiento por defecto del boton submit
    e.preventDefault();
    // capturamos la información del formulario 
    var data = new FormData(this);
    // ejecuta una url/action con la capacidad de gestionar la salida
    $.ajax({
      url: "/private/docLaruex/agregarArchivo/",
      type: "POST",
      data: data,
      cache: false,
      contentType: false,
      processData: false,
      // gestiono el return del view
      success: function () {
        document.getElementById('formularioAsociarFormato').reset();
        crearAviso('objetoGuardar', 'Formato agregado y asociado con éxito', 'alert-success', 2000);
        $('#tabla_formatos_asociados').bootstrapTable('refresh');
        $('#cerrarModalAsociarFormato').trigger('click');
      }
    });
  });

    // ------ ACTUALIZAR VERSIÓN DEL PROCEDIMIENTO ------

    // cambiamos la funcionalidad del boton submit de subir una nueva versión del Procedimiento
    $("#formularioActualizarVersion").submit(function (e) {
    // cancelamos el funcionamiento por defecto del boton submit
    e.preventDefault();
    // capturamos la información del formulario 
    var data = new FormData(this);
    // ejecuta una url/action con la capacidad de gestionar la salida
    $.ajax({
      url: "/private/docLaruex/agregarArchivo/",
      type: "POST",
      data: data,
      cache: false,
      contentType: false,
      processData: false,
      // gestiono el return del view
      success: function () {
        document.getElementById('formularioActualizarVersion').reset();
        crearAviso('objetoGuardar', 'Nueva versión del procedimiento agregada con éxito', 'alert-success', 2000)
        $('#tabla_historial_procedimientos').bootstrapTable('refresh');
        $('#cerrarActualizarVersion').trigger('click');
        location.reload();
      }
    });
  });

  // ------ ASOCIAR ARCHIVOS AL PROCEDIMIENTO ------
  $("#formularioAsociarArchivo").submit(function (e) {
    // cancelamos el funcionamiento por defecto del boton submit
    e.preventDefault();
    $table = $("#tabla_objetos_para_asociar_seleccionados");
    var idSeleccionado = "";
    for (let value of $table.bootstrapTable('getData')) {
      idSeleccionado = idSeleccionado + value["id"] + "#";
    }
    console.log(idSeleccionado);
    $("#idArchivosSeleccionados").val(idSeleccionado);
    // capturamos la información del formulario 
    var data = new FormData(this);
    // ejecuta una url/action con la capacidad de gestionar la salida
    $.ajax({
      url: "/private/docLaruex/asociarArchivos/",
      type: "POST",
      data: data,
      cache: false,
      contentType: false,
      processData: false,
      // gestiono el return del view
      success: function () {
        crearAviso('ModalAgregar', 'Archivo asociado con éxito', 'alert-success', 2000);
        $table.bootstrapTable('removeAll');
        $("#idArchivosSeleccionados").val("");
        $('#tabla_referencias_asociadas').bootstrapTable('refresh');
        $('#cerrarAsociar').trigger('click');
      }
    });
  });


  
// ------ AGREGAR ANEXOS AL PROCEDIMIENTO ------
$("#formularioAgregarAnexo").submit(function (e) {

// cancelamos el funcionamiento por defecto del boton submit
e.preventDefault();
// capturamos la información del formulario 
var data = new FormData(this);
// ejecuta una url/action con la capacidad de gestionar la salida
$.ajax({
  url: "/private/docLaruex/agregarArchivo/",
  type: "POST",
  data: data,
  cache: false,
  contentType: false,
  processData: false,
  // gestiono el return del view
  success: function () {
    crearAviso('objetoGuardar', 'Anexo agregado con éxito', 'alert-success', 2000)
    $(".divFormularios").remove();
    $("#reset").trigger("click");
    $('#tabla_referencias_asociadas').bootstrapTable('refresh');
    $('#cerrar').trigger('click');
    $("#modalAgregarAnexo").trigger('reset');
    location.reload();
  }
});
});

 // ------ AGREGAR Notas al PROCEDIMIENTO ------
  $("#formularioModalEnviarNota").submit(function (e) {
    // cancelamos el funcionamiento por defecto del boton submit
    e.preventDefault();
    // capturamos la información del formulario 
    var data = new FormData(this);
    // ejecuta una url/action con la capacidad de gestionar la salida
    $.ajax({
      url: "/private/docLaruex/agregarNotificacion/",
      type: "POST",
      data: data,
      cache: false,
      contentType: false,
      processData: false,
      // gestiono el return del view
      success: function () {
        crearAviso('objetoGuardar', 'Notificacion guardado con éxito', 'alert-success', 2000)
        $('#tabla_notificaciones').bootstrapTable('refresh');
        $(".modalFormularioEnviarNota").remove();
        $("#resetNotificacion").trigger("click");
        $('#cerrarNotificacion').trigger('click');
        
      }
    });
  });

  // ------ MOSTRAR NOTAS ASOCIADAS AL PROCEDIMIENTO ------


</script>
{% endblock %}