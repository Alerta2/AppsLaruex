{% extends "base/base_docLaruex.html" %} {% load static %} {% block content %}


<style>

  /*===========================
    Estilo de los card en CSS
  ===========================*/

.nav-tabs-bordered .nav-link {
    margin-bottom: -2px;
    border: none;
    color: #2c384e;
}
  .nav-tabs-bordered .nav-link.active {
    background-color: #fff;
    color: #4154f1;
    border-bottom: 2px solid #4154f1;
}
.nav-tabs {
    --bs-nav-tabs-border-color: #dee2e6;
    --bs-nav-tabs-border-radius: 0.375rem;
    --bs-nav-tabs-link-hover-border-color: #e9ecef #e9ecef #dee2e6;
    --bs-nav-tabs-link-active-color: #495057;
    --bs-nav-tabs-link-active-bg: #fff;
    --bs-nav-tabs-link-active-border-color: #dee2e6 #dee2e6 #fff;
    border-bottom: var(--bs-nav-tabs-border-width) solid var(--bs-nav-tabs-border-color);
}
  /*===========================
    HOver de Botones
  ===========================*/
  .enviarNotificacion:hover {
    color: #064061;
  }

  .descargarDocumento:hover{
    color: #bb3e03;
  }
  
  .descargarCertificado:hover {
    color: #001219;
  }

  .borderless tr, .borderless td, .borderless th {
      border: none !important;
  }

  /*===========================
    Section Title One CSS
  ===========================*/
  .section-title-one {
    text-align: center;
    max-width: 750px;
    margin: auto;
    margin-bottom: 50px;
    position: relative;
    z-index: 5;
    color: rgb(16, 110, 134);
  }
  @media only screen and (min-width: 768px) and (max-width: 991px) {
    .section-title-one {
      margin-bottom: 45px;
    }
  }
  @media (max-width: 767px) {
    .section-title-one {
      margin-bottom: 35px;
    }
  }
  .section-title-one h2 {
    margin-bottom: 15px;
  }
  @media only screen and (min-width: 768px) and (max-width: 991px) {
    .section-title-one h2 {
      font-size: 2rem;
      line-height: 2.8rem;
    }
  }
  @media (max-width: 767px) {
    .section-title-one h2 {
      font-size: 1.5rem;
      line-height: 1.9rem;
    }
  }
  
  hr {
    height: 10px;
    width: 20%;
    margin: auto;
    background-color: rgb(5, 215, 243);
    color: rgb(5, 215, 243);
  }

  h6 {
    font-family: 'Poppins', sans-serif;
    color: #394747;
    font-size: 36px;
  }
  /*---------------------------------
  imagen
  ---------------------------------*/
  div.polaroid {
    
  width:65%;
  background-color: white;
  
  box-shadow: 0 4px 8px 0 rgba(0, 0, 0, 0.2), 0 6px 20px 0 rgba(0, 0, 0, 0.19);
  margin-bottom: 25px;
  }

  #imgCurso{
    width: 100%;
  }

  div.container {
  text-align: center;
  padding: 10px 20px;
  }

      /*--------------------------------------------------------------
    # Descargar Certificado
    --------------------------------------------------------------*/
    .cta {
    position: relative;
    margin: auto;
    padding: 12px 18px;
    transition: all 0.2s ease;
    border: none;
    background: none;
    }

    .cta:before {
    content: "";
    position: absolute;
    top: 0;
    left: 0;
    display: block;
    border-radius: 50px;
    background: #b1dae7;
    width: 45px;
    height: 45px;
    transition: all 0.3s ease;
    }

    .cta span {
    position: relative;
    font-family: "Ubuntu", sans-serif;
    font-size: 18px;
    font-weight: 700;
    letter-spacing: 0.05em;
    color: #234567;
    }

    .cta svg {
    position: relative;
    top: 0;
    margin-left: 10px;
    fill: none;
    stroke-linecap: round;
    stroke-linejoin: round;
    stroke: #234567;
    stroke-width: 2;
    transform: translateX(-5px);
    transition: all 0.3s ease;
    }

    .cta:hover:before {
    width: 100%;
    background: #b1dae7;
    }

    .cta:hover svg {
    transform: translateX(0);
    }

    .cta:active {
    transform: scale(0.95);
    }


    
  /* estilo añadirFichero PDF*/
  .addFicheroPDF {
    color: rgb(161, 16, 32);
  }

  .addFicheroPDF:hover {
    color: rgb(99, 10, 20);
  }
  /* estilo añadirFichero PDF*/
  .addFicheroActualizado {
    color: #0a9663;
  }
</style>


<!--======  Start Section Title One ======-->
<div class="section-title-one">
  <div class="container">
     <div class="row">
        <div class="col-lg-12">
           <div class="text-center">
              <div class="content">
                 <h1 class="fw-bold">{{ infoCurso.id__nombre }}</h1>
                 <hr>
              </div>
            </div>
        </div>
      </div>
  </div>
     <!-- row -->
</div>



<!--======  Seccion con la imagen y la descripción del curso ======-->
<div class="section">
  <div class="row">
    <div class="col">
      <div class="d-flex justify-content-end">
        <h5>
          <a class="mx-1" title="Enviar nota relacionada con {{ curso.id.nombre }}" data-toggle="modal" data-target="#modalFormularioEnviarNota" style="color: #001219; align-items: md-center"><i class="fa-duotone fa-message-pen fa-2xl enviarNotificacion"></i></a>
          <a class="mx-1" title="Notas relacionadas con {{ curso.id.nombre }}" data-toggle="modal" data-target="#modalFormularioVerNotas" style="color: #001219; align-items: md-center"><i class="fa-duotone fa-messages fa-2xl enviarNotificacion"></i></a>
          <a class="mx-1" title="cambiar estado" data-target="#modalFormularioCambiarEstado" data-toggle="modal"
          style="color: #001219; align-items: md-center"><i class="fa-duotone fa-sign-hanging fa-2xl enviarNotificacion"></i></a>
        </h5>
      </div>
    </div>
  </div>
  <div class="row ">
     <!-- ===================== Descripción del curso ===================== -->
    <div class="col">

      <div class="polaroid mx-auto">
        <!-- debe estar cargado en el static del curso no de la aplicación -->
        <img id="imgCurso" src="{% static 'niceAdminAssets' %}/img/Curso/{{ infoCurso.imagen }}" alt="" >
        <div class="container d-flex justify-content-center">
          <ul style="list-style: none">  
            <li>
              <h5>
                <a href="{{ media }}/{{ curso.id.tipo }}/{{ curso.id.ruta }}" class="mx-1" title="upload"
                style="color: #9B2226" download><i class="fa-solid fa-file-pdf fa-2xl addFicheroPDF"> </i></a>
                {% if administrador %}
                <a  class="mx-1" title="generar certificado" data-toggle="modal" onclick="generarCertificado()"
                style="color: #9B2226; align-items: md-center"><i class="fa-duotone fa-graduation-cap fa-2xl descargarCertificado"></i></a>

                <!-- boton que permite asociar elementos al formato actual-->
                <a href="" title="Asociar Archivo" class="mx-" data-toggle="modal" data-toggle="tooltip"
                  data-target="#modalAsociarArchivo" style="color: #0A9396; "><i class="fa-duotone fa-link fa-2xl enlace enviarNotificacion"></i></a>
                
                {% endif %}
                {% if curso.id.id_estado.id == 3 or curso.id.id_estado.id == 4 %}
                <!-- boton que permite asociar elementos al formato actual-->
                <a href="" title="Asociar asistentes" class="mx-" data-toggle="modal" data-toggle="tooltip"
                  data-target="#modalAsociarAsistentes" style="color: #032525; "><i class="fa-duotone fa-user-plus fa-2xl enlace enviarNotificacion"></i></a>

                {% endif %}
                
              </h5>
            </li>
            <li>
              <h4>
                {% if curso.id.id_estado.id == 1 or curso.id.id_estado.id == 2 %}
                  <span class="badge text-white"
                      style="background-color: #21b563; vertical-align:middle">{{curso.id.id_estado.nombre}}</span>
                {% elif curso.id.id_estado.id == 3 or curso.id.id_estado.id == 4 %}
                <span class="badge text-white"
                    style="background-color: #EB8E34; vertical-align:middle">{{curso.id.id_estado.nombre}}</span>
                {% elif curso.id.id_estado.id == 5 %}
                <span class="badge text-white "
                    style="background-color: #524e4e; vertical-align:middle">{{curso.id.id_estado.nombre}}</span>
                {% else %}
                <span class="badge text-white "
                    style="background-color: #b52121; vertical-align:middle">{{curso.id.id_estado.nombre}}</span>
                {% endif %} 
              </h4>
            </li>
            <li >          
              <h6 style=" font-size: x-large;">{{ infoCurso.tipo_curso__nombre }}</h6>
            </li>
            <li>
              <h6 style="font-size: medium;"><i class="fa-solid fa-calendar-days me-2"></i> Del {{ infoCurso.fecha_inicio|date:"j" }} al {{ infoCurso.fecha_fin}}</h6>
            </li>
            <li>
              <h6 style="font-size: medium;"><i class="fa-sharp fa-solid fa-hourglass-end me-2"></i>{{ infoCurso.horas|floatformat:"0" }} Horas</h6>
            </li>
          </ul>
        </div>
      </div>
    </div>
     <!-- ===================== Descripción y contenido del curso ===================== -->
    <div class="col">
       <!-- ===================== Descripción del curso ===================== -->

          <div class="section profile">
            <div class="card mx-auto">
              <div class="card-body pt-3">
                <!-- Bordered Tabs -->
                <ul class="nav nav-tabs nav-tabs-bordered">
      
                  <li class="nav-item">
                    <button class="nav-link active" data-bs-toggle="tab" data-bs-target="#profile-resumen">Resumen</button>
                  </li>  
      
                  <li class="nav-item">
                    <button class="nav-link" data-bs-toggle="tab" data-bs-target="#profile-overview">Descripción</button>
                  </li>  
      
                  <li class="nav-item">
                    <button class="nav-link" data-bs-toggle="tab" data-bs-target="#profile-contenido">Contenido</button>
                  </li> 
                  <li class="nav-item">
                    <button class="nav-link" data-bs-toggle="tab" data-bs-target="#profile-listado-asistentes">Asistentes</button>
                  </li>
      
                  <li class="nav-item">
                    <button class="nav-link" data-bs-toggle="tab" data-bs-target="#profile-referencias-asociadas">Documentos y Referencias</button>
                  </li>
                  {% if curso.id.id_estado.id == 3 or curso.id.id_estado.id == 4 %}
                  <li class="nav-item">
                    <button class="nav-link" data-bs-toggle="tab" data-bs-target="#profile-agregar-contenido">Agregar Contenido</button>
                  </li>
                  {% endif %}
                 
                  {% if administrador %}
                  <li class="nav-item">
                    <button class="nav-link" data-bs-toggle="tab" data-bs-target="#profile-editar">
                      Editar
                    </button>
                  </li>
                  <li class="nav-item">
                    <button class="nav-link" data-bs-toggle="tab" data-bs-target="#profile-eliminar">Eliminar</button>
                  </li>
                  {% endif %}
      
                </ul>
      
                <div class="tab-content pt-2">
                  <!-- Información Resumen del curso -->
                  <div class="tab-pane fade show active profile-resumen" id="profile-resumen">
                    <h5 class="card-title">Resumen del curso</h5>
      
                    <div class="row">
                      <div class="col-lg-12 col-md-12">{{ infoCurso.resumen }}</div>
                    </div>
                  
      
                  </div>
                  <!-- Información Descripción del curso -->
                  <div class="tab-pane fade show profile-overview" id="profile-overview">
                    <h5 class="card-title">Descripción del curso</h5>
      
                    <div class="row">
                      <div class="col-lg-12 col-md-12">{{ infoCurso.descripcion }}</div>
                    </div>
                  
      
                  </div>
      
                  <!-- Contenido del curso -->
                  <div class="tab-pane fade profile-contenido pt-3" id="profile-contenido">
                    <h5 class="card-title">Contenido del curso</h5> 
                    {% for content in contenidoCurso %}
                      {% regroup content by id_contenido__fecha_ponencia|date:"Y-m-d" as contenidos_por_dia %}
                      {% for dia in contenidos_por_dia %}
                        <div class="row">
                          <div class="col my-2">
                            <h6 class="h6 text-bold" style="color: #001219;">{{ content.id_contenido__fecha_ponencia|date:"l" }} día {{ content.id_contenido__fecha_ponencia|date:"j" }} de {{ content.id_contenido__fecha_ponencia|date:"F" }} de {{ content.id_contenido__fecha_ponencia|date:"o" }}</h6>
                            <h6 class="h6"><strong>{{ content.id_contenido__fecha_ponencia|time:"H:i" }} </strong> {{ content.id_contenido__nombre_ponencia }}
                              {% if content.id_contenido__archivo %}
                              <a href="{{ media }}/{{ curso.id.tipo }}/{{ curso.id.id }}/{{ content.id_contenido__archivo }}" style="color: #ca6702;" download><i class="fa-solid fa-download mx-2 descargarDocumento"></i></a>
                              {% endif %}
                              
                              {% if administrador %}
                              <a href="/private/docLaruex/editarContenidoCurso/{{curso.id.id}}/{{ content.id_contenido__id }}/" class="mx-1" title="Editar"><i class="fa-duotone fa-money-check-pen" style="color:#032525"></i></a>
                              
                              <a href="/private/docLaruex/eliminarContenidoCurso/{{curso.id.id}}/{{ content.id_contenido__id }}/" class="mx-1" title="Eliminar ContenidoCurso" data-toggle="modal" data-target="#modalEliminarContenidoCurso" onclick="$('form#formularioModalEliminarContenidoCurso').attr('action', '/private/docLaruex/eliminarContenidoCurso/{{curso.id.id}}/{{ content.id_contenido__id }}/');" style="color:#AE2012"><i class="fa-solid fa-xmark" ></i></a>
                              
                              {% endif %}
                            </h6>
                            <h6 class="h6" style="color: #005F73;">{{ content.id_contenido__ponente__nombre }}</h6>
                            
                            
                          </div>
                        </div>
                        {% endfor %}
                       {% endfor %}
                                
                  </div>
      
                  <!-- Historial de versiones del formato -->
                  <div class="tab-pane fade profile-listado-asistentes pt-3" id="profile-listado-asistentes">
      
                    <h5 class="card-title">Listado de asistentes</h5>
                      <label for="idCategoria"><strong>Tipo</strong></label>
                      <select class="form-control form-select" id="tipoAsistente" name="tipoAsistente" onchange="getSelecionados()">
                        <option value="Ponente">Ponentes</option>
                        <option value="Asistente">Asistentes</option>
                        <option value="Todos" selected>Todos</option>
                      </select>
                    <table id="tabla_relacion_asistentes" data-toggle="table" data-search="true" data-show-columns="true"
                    data-show-columns-toggle-all="true" data-show-fullscreen="true" data-buttons="buttons" data-show-toggle="true"
                    data-buttons-class="" data-show-export="true" data-export-types="['excel', 'pdf']" data-show-refresh="true"
                    data-pagination="true" data-id-field="id" data-page-list="[10, 25, 50, 100, All]" data-toolbar="#toolbar">
                    </table>
      
                  </div>
      
                  <!-- Referencias Asociadas -->
                  <div class="tab-pane fade profile-referencias-asociadas pt-3" id="profile-referencias-asociadas">
      
                    <!-- Tabla de referencias Asociadas -->
                    <table id="tabla_referencias_asociadas" data-toggle="table" data-search="true" data-show-columns="true"
                    data-show-columns-toggle-all="true" data-show-fullscreen="true" data-buttons="buttons" data-show-toggle="true"
                    data-buttons-class="" data-show-export="true" data-export-types="['excel', 'pdf']" data-show-refresh="true"
                    data-pagination="true" data-id-field="id" data-page-list="[10, 25, 50, 100, All]" data-toolbar="#toolbar"></table>
                    
      
                  </div>
                  
                  <!-- Agregar contenido -->
                  <div class="tab-pane fade profile-agregar-contenido pt-3" id="profile-agregar-contenido">

                    <!-- Edit Form -->
                    <form id="formularioAgregarContenido" action="/private/docLaruex/agregarContenidoCurso/" method="POST"
                    enctype="multipart/form-data">
                    {% csrf_token %}          
                    
                    <div class="row my-2">
      
                      <div class="col-md-12">
                        <label for="nombrePonencia" class="form-label">Titulo de la ponencia</label>
                        <input type="text" class="form-control" name="nombrePonencia" id="nombrePonencia" required>
                      </div>
                      <div class="col-md-12" hidden>
                        <input type="text" class="form-control" name="idCurso" id="idCurso" value="{{curso.id.id}}">
                      </div>
                    </div>
                
                    <div class="row my-2">
                      <div class="col-md-6">
                        <label for="fechaPonencia" class="form-label">Fecha y Hora de la Ponencia</label>
                        <input type="datetime-local" id="fechaPonencia" name="fechaPonencia" class="form-control" required/>
                      </div>
                      
                      <div class="col-6">
                        <div class="form-group">
                          <label for="ponente">Ponente</label>
                          <select class="form-select" id="ponente" name="ponente" >
                            {% for contacto in contactos %}
                              <option value="{{contacto.id}}" required>{{contacto.nombre}}</option>
                            {% endfor %}
                          </select>
                        </div>
                      </div>
                    </div>
                
                    <div class="row my-2">
                      <div class="col">
                        <label for="descripcionPonencia" class="form-label">Descripción de la ponencia</label>
                        <textarea class="form-control" name="descripcionPonencia" id="descripcionPonencia" rows="5" 
                        placeholder="Añade aquí una breve descripción de la ponencia" required></textarea>
                      </div>
                    </div>
                    <div class="row">
                      <div class="col">
                        <div class="form-group d-flex justify-content-center my-2">
                          <label for="archivoPonencia">
                            <i id="pdf-filePonencia"
                            class="fa-duotone fa-file-arrow-up fa-4x addFicheroPDF"></i>
                          </label>
                          <input type="file" class="form-control-file" style="display: none; visibility: none;"
                            id="archivoPonencia" name="archivoPonencia"
                            onchange="mostrarNombreArchivo(this.value)" />
                        </div>      
                        <div class="text-center"><strong id="mostrarNombreArchivo"><br></strong>
                          <spam id="archivo-name"></spam>
                        </div>
                      </div>
                    </div>

                    <div class="text-center my-4">
                      <button class="col-2 cta" type="submit">
                        <span>Guardar</span>
                      </button>  
                      
                    </div>
                        
              
              
                    <!-- END Body del ModalAsociarFormato -->
      
                    </form><!-- End Profile Edit Form -->
      
                  </div>
      
                  <!-- Editar Curso -->
                  <div class="tab-pane fade profile-editar pt-3" id="profile-editar">
      
                    <!-- Edit Form -->
                    <form id="formularioEditarCurso" action="/private/docLaruex/editarObjeto/{{curso.id.id}}/" method="POST"
                    enctype="multipart/form-data">
                    {% csrf_token %}
                        <div class="row divFormularioEditarCurso">
                          <div class="col">
                            <div class="form-group">
                              <label for="nuevaHabilitacion">Habilitación</label>
                              <select class="form-select" data-rule="required" id="nuevaHabilitacion" name="nuevaHabilitacion">
                                <option value="{{curso.id.id_habilitacion.id}}" selected hidden>
                                  {{curso.id.id_habilitacion.titulo}}
                                </option>
                                {% for habilitacion in habilitaciones %}
                                <option value="{{habilitacion.id}}">
                                  {{habilitacion.titulo}}
                                </option>
                                {% endfor %}
                              </select>
                            </div>
                          </div>
                        </div>
                        <div class="row">
                          <div class="col" hidden>
                            <div class="form-group">
                              <input type="text" class="form-control" id="tipoObjeto" name="tipoObjeto" data-rule="required"
                                value="{{curso.id.tipo}}" />
                            </div>
                          </div>
                          <div class="col">
                            <div class="form-group">
                              <label for="nuevoNombre">Nombre</label>
                              <input type="text" class="form-control" name="nuevoNombre" id="nuevoNombre" value="{{curso.id.nombre}}" />
                            </div>
                          </div>
                        </div>
                        <div class="row">
                          <div class="col-2">
                            <div class="form-group">
                              <label for="nuevaVersion">Horas</label>
                              <input type="number" step="0.01" placeholder="{{curso.horas}}"class="form-control" name="nuevasHoras" id="nuevasHoras" value="{{curso.horas|safe}}" />
                            </div>
                          </div>
                          <div class="col-5">
                            <div class="form-group">
                              <label for="nuevaFechaInicio">Fecha de Inicio</label>
                              <input type="date" id="nuevaFechaInicio" name="nuevaFechaInicio" class="form-control"
                                value="{{curso.fecha_inicio|safe}}" />
                            </div>
                          </div>
                          <div class="col-5">
                            <div class="form-group">
                              <label for="nuevaFechaFin">Fecha de Fin</label>
                              <input type="date" id="nuevaFechaFin" name="nuevaFechaFin" class="form-control"
                              value="{{curso.fecha_fin|safe}}" />
                            </div>
                          </div>
              
                        </div>
                        <div class="row">
                          <div class="col">
                            <div class="form-group">
                              <label for="nuevoTipoCurso">Tipo de Curso</label>
                              <select class="form-control" id="nuevoTipoCurso" name="nuevoTipoCurso">
                                
                                <option value="{{curso.tipo_curso.id}}" selected hidden> {{curso.tipo_curso.nombre}}
                                </option>
                                {% for tipo in tipoCursos %}
                                  <option value="{{tipo.id}}">{{tipo.nombre}}</option>
                                {% endfor %}
                              </select>
                            </div>
                          </div>
                          <div class="col">
                            <label for="nuevoPatrocinador">Patrocinador</label>
                            <select class="form-control" id="nuevoPatrocinador" name="nuevoPatrocinador">
                              <option value="{{curso.patrocinadores.id}}" selected hidden>
                                {{curso.patrocinadores.nombre}}
                              </option>
                              {% for patrocinador in patrocinadores %}
                                <option value="{{patrocinador.id}}">{{patrocinador.nombre}}</option>
                              {% endfor %}
                            </select>
                          </div>
                        </div>

                        <div class="row">
                          <div class="col">
                            <div class="form-group">
                              <label for="nuevoResumen">Resumen</label>
                              <textarea class="form-control" name="nuevoResumen" id="nuevoResumen" rows="5" 
                              placeholder="Añade aquí los comentarios" >{{curso.resumen}}</textarea>
                            </div>
                          </div>
                        </div>

                        <div class="row">
                          <div class="col">
                            <div class="form-group">
                              <label for="nuevaDescripcion" >Descripción del curso</label>
                              <textarea class="form-control" name="nuevaDescripcion" id="nuevaDescripcion" rows="10" 
                              placeholder="Añade aquí los comentarios" >{{curso.descripcion}}</textarea>
                            </div>
                          </div>
                        </div>

                        <div class="row">
                          <div class="col">
                            <div class="form-group d-flex justify-content-center my-2">
                              <label for="nuevoFicheroAdjuntoCurso">
                                <i id="pdf-fileCurso"
                                class="fa-duotone fa-file-arrow-up fa-4x addFicheroPDF"></i>
                              </label>
                              <input type="file" class="form-control-file" style="display: none; visibility: none;"
                                id="nuevoFicheroAdjuntoCurso" name="nuevoFicheroAdjuntoCurso"
                                onchange="mostrarNombreArchivoCurso(this.value)" />
                            </div>      
                            <div class="text-center"><strong id="mostrarNombreArchivoCurso"><br></strong>
                              <spam id="archivoCurso-name"></spam>
                            </div>
                          </div>
                        </div>
                        <div class="text-center my-4">
                          <button class="col-2 cta" type="submit">
                            <span>Guardar</span>
                          </button>  
                          
                        </div>
                        
              
              
                    <!-- END Body del ModalAsociarFormato -->
      
                    </form><!-- End Profile Edit Form -->
      
                  </div>
      
          

                  <!-- Eliminar Curso -->
                  <div class="tab-pane fade profile-eliminar pt-3" id="profile-eliminar">
      
                    <!-- Formulario eliminar Procedimiento -->
                    <form form id="fomularioEliminarObjeto" action="/private/docLaruex/eliminarObjeto/{{ curso.id.id }}/"
                    method="POST" enctype="multipart/form-data">
                    {% csrf_token %}
      
                      <div class="row mb-3">
                        <label class="text-center">¿Estás seguro de eliminar el curso {{curso.id.nombre}} ?</label>
                      </div>
                      <div class="text-center">
                        <button id="eliminarCurso" type="submit" class="btn btn-danger" onclick="crearAviso('guardarEliminarCurso', 'Curso {{ curso.id.nombre }} eliminado con éxito', 'alert-success', 3000)">Eliminar</button>
      
                        <button  id="canclearEliminarCurso" type="reset" class="btn btn-secondary" onclick="crearAviso('cerrarEliminarCurso', 'No se ha podido eliminar el curso {{ curso.id.nombre }}', 'alert-warning', 3000); location.reload()">Cancelar</button>
                      </div>
                    </form><!-- End Profile Edit Form -->
      
                  </div>
      
                </div><!-- End Bordered Tabs -->
      
              </div>
            </div>
          </div>
          
    </div>
  </div>
</div>



<!-- ========== Modal Enviar Notificacion ================= -->
<div id="modalFormularioEnviarNota" class="modal fade" tabindex="-1" role="dialog" aria-labelledby="myLargeModalLabel"
  aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-dialog-centered modal-lg">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="TituloModal">Generar notificación asociada al curso de {{ curso.id.nombre}} </h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <form id="formularioModalEnviarNota" action="/private/docLaruex/agregarNotificacion/" method="POST"
          enctype="multipart/form-data">
          {% csrf_token %}
          <div class="row">
            <div class="col">
              <div class="form-group">
                <input type="text" class="form-control" id="id" name="id" data-rule="required" 
                  value="{{ curso.id.id }}" hidden />
              </div>
              <div class="form-group">
                <input type="text" class="form-control" id="estadoNotificacion" name="estadoNotificacion" data-rule="required" 
                  value="1" hidden />
              </div>
            </div>
        </div>
        <div class="row">
          <div class="col-12">
              <div class="form-group">
                <label for="tituloNotificacion">Título</label>
                <input type="text" class="form-control" id="tituloNotificacion" name="tituloNotificacion" data-rule="required" required />
              </div>
          </div>
        </div>
        <div class="row">
          <div class="col-12">
            <div class="form-group">
              <label for="resumenNotificacion">Resumen</label>
              <textarea class="form-control" id="resumenNotificacion" name="resumenNotificacion" rows="5" data-rule="required"
                placeholder="Escriba un comentario" required></textarea>
            </div>

          </div>
        </div>

          <div class="modal-footer">
            <button id="cerrar" type="button" class="btn btn-secondary" data-dismiss="modal" >
              Cerrar
            </button>
            <button id="reset" type="reset" class="btn btn-secondary" hidden>
            </button>
            <button type="submit" value="submit" class="btn btn-primary" >
              Guardar
            </button>
          </div>
        </form>
      </div>
    </div>
  </div>
</div>

<!-- ========== Modal Ver Notas ================= -->
<div id="modalFormularioVerNotas" class="modal fade" tabindex="-1" role="dialog" aria-labelledby="myLargeModalLabel"
  aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-dialog-centered modal-lg">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="TituloModal">Notas del curso {{ curso.id.nombre }}</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <form id="formularioModalEnviarNota" action="/private/docLaruex/agregarNotificacion/" method="POST"
          enctype="multipart/form-data">
          {% csrf_token %}
          <div class="row">
            <div class="col">
              <table class="table-sm table-hover" id="tabla_notificaciones" data-search="true"
              data-buttons-class="light" data-pagination="true" data-id-field="id" data-page-list="[10]"
              data-toolbar="#toolbar"></table>
            </div>
        </div>

          <div class="modal-footer">
            <button id="cerrar" type="button" class="btn btn-secondary" data-dismiss="modal" >
              Cerrar
            </button>
          </div>
        </form>
      </div>
    </div>
  </div>
</div>

<!-- ========== Modal Cambiar Estado ================= -->
<div id="modalFormularioCambiarEstado" class="modal fade" tabindex="-1" role="dialog" aria-labelledby="myLargeModalLabel"
  aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-dialog-centered modal-lg">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="TituloModalCambiarEstado">Cambiar estado del {{ curso.id.nombre}}</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <form id="formularioCambiarEstado" action="/private/docLaruex/editarEstado/{{ curso.id.id}}/" method="POST"
          enctype="multipart/form-data">
          {% csrf_token %}
          <div class="row">
            <div class="col">
              <div class="form-group">
                <input type="text" class="form-control" id="id" name="id" data-rule="required" 
                  value="{{ curso.id.id }}" hidden />
              </div>
            </div>
        </div>
        <div class="row">
          <div class="col-4">
            <div class="form-group">
              <label>Estado actual</label>
              <input type="text" value ="{{curso.id.id_estado.nombre}}" class="form-control" disabled>
            
            </div>
          </div>
          <div class="col-8">
            <div class="form-group">
              <label for="nuevoEstado">Nuevo estado</label>
               <select class="form-select my-auto" id="nuevoEstado" name="nuevoEstado" >
                {% for estado in estados %}
                  <option value="{{estado.id}}">
                    {{estado.nombre}}
                  </option>
                {% endfor %}
                </select>
            </div>
          </div>
        </div>

          <div class="modal-footer">
            <button id="cerrar" type="button" class="btn btn-secondary" data-dismiss="modal" >
              Cerrar
            </button>
            <button id="reset" type="reset" class="btn btn-secondary" hidden>
            </button>
            <button type="submit" value="submit" class="btn btn-primary" >
              Guardar
            </button>
          </div>
        </form>
      </div>
    </div>
  </div>
</div>

<!-- ========== Modal para asociar Archivos al documento ========== -->
<div id="modalAsociarArchivo" class="modal fade bd-example-modal-lg" tabindex="-1" role="dialog"
  aria-labelledby="modalAsociarArchivo" aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-dialog-centered modal-xl">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="TituloModal">
          <strong>
            Seleccione los archivos que desea asociar.
          </strong>
        </h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span
            aria-hidden="true">&times;</span></button>
      </div>
      <!-- END Cabecera del modalAsociarArchivo -->

      <!-- Body del modalAsociarArchivo -->
      <div class="modal-body">
        <form id="formularioAsociarArchivo" enctype="multipart/form-data">
          {% csrf_token %}

          <div class="row justify-content-center">
            <div class="col-lg-5">
              <div class="card card p-4 ">
                <h5 class="card-title text-center">Lista de Archivos</h5>
                <table class="table-sm table-hover" id="tabla_archivos_para_asociar" data-search="true"
                  data-buttons-class="light" data-pagination="true" data-id-field="id" data-page-list="[10]"
                  data-toolbar="#toolbar"></table>
              </div>
            </div>

            <div class="col-lg-1 col-12 my-auto text-center">
              <i id="flechas" class="fa-solid fa-arrow-right-arrow-left fa-3x" style="color: rgb(41,68,87)"></i>
            </div>

            <div class="col-lg-5">
              <div class="card p-4">
                <h5 class="card-title text-center">Archivos seleccionados</h5>
                <table id="tabla_archivos_para_asociar_seleccionados" class="table-sm table-hover" data-search="true"
                  data-buttons-class="light" data-pagination="true" data-id-field="id" data-page-list="[10]"
                  data-toolbar="#toolbar"></table>
              </div>
            </div>
          </div>
      </div>
      <input type="text" id="idArchivoActual" value="{{ id }}" hidden name="idArchivoActual" data-rule="required" />
      <input type="text" id="idArchivosSeleccionados" value="{{ id }}" hidden name="idArchivosSeleccionados"
        data-rule="required" />

      <!-- Footer del ModalAsociarArchivo -->
      <div class="modal-footer d-flex">

        <button id="cerrarAsociar" type="button" class="btn btn-secondary" data-dismiss="modal">
          Cerrar
        </button>
        <button type="submit" value="submit" class="btn btn-primary">
          Guardar
        </button>
      </div>
      <!-- END Footer del ModalAsociarArchivo -->
    </div>
  </div>
</div><!-- END Body del ModalAsociarArchivo -->
</form>
</div> <!-- END ModalAsociarArchivo -->



<!-- ============= Modal Eliminar Asociación  ====================-->

<div id="modalEliminarAsociacion" class="modal fade" tabindex="-1" role="dialog" aria-labelledby="myLargeModalLabel"
aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-dialog-centered modal-lg">
    <div class="modal-content">
      <div class="modal-header">

        <h5 class="modal-title" id="TituloModalEliminarAsociacion"><strong>¿Estas seguro que deseas eliminar esta asociación?</strong> </h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      
 
        <form id="formularioModalEliminarAsociacion" action="/private/docLaruex/eliminarAsociacion/0/" method="POST"
          enctype="multipart/form-data">
          {% csrf_token %}
          <!-- indica el tipo de objeto se que va a añadir -->
          <div class="modal-footer d-flex justify-content-center">
            <button id="cerrarEliminarAsociacion" type="button" class="btn btn-secondary" data-dismiss="modal" hidden>Cerrar</button>
            <button class="btn btn-secondary" data-dismiss="modal"  id="cancelEliminarAsociacion" name="cancel" onclick="crearAviso('eliminarObjetoCancelar', 'No se ha podido eliminar', 'alert-warning', 3000)">Cancelar</button>
            <button type="submit" value="submit" class="btn btn-danger" onclick="crearAviso('eliminarObjetoGuardar', 'Objeto  eliminado', 'alert-success', 3000)">
              Eliminar
            </button>
          </div>
        </form>
    </div>
  </div>
</div>


<!-- ============= Modal Eliminar Asociación  ====================-->

<div id="modalEliminarContenidoCurso" class="modal fade" tabindex="-1" role="dialog" aria-labelledby="myLargeModalLabel"
aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-dialog-centered modal-lg">
    <div class="modal-content">
      <div class="modal-header">

        <h5 class="modal-title" id="TituloModalEliminarContenidoCurso"><strong>¿Estas seguro que deseas eliminar eeste contenido?</strong> </h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      
 
        <form id="formularioModalEliminarContenidoCurso" action="/private/docLaruex/eliminarContenidoCurso/0/" method="POST"
          enctype="multipart/form-data">
          {% csrf_token %}
          <!-- indica el tipo de objeto se que va a añadir -->
          <div class="modal-footer d-flex justify-content-center">
            <button id="cerrarEliminarContenidoCurso" type="button" class="btn btn-secondary" data-dismiss="modal" hidden>Cerrar</button>
            <button class="btn btn-secondary" data-dismiss="modal"  id="cancelEliminarContenidoCurso" name="cancel" onclick="crearAviso('eliminarContenidoCurso', 'No se ha podido eliminar', 'alert-warning', 3000)">Cancelar</button>
            <button type="submit" value="submit" class="btn btn-danger" onclick="crearAviso('eliminarContenidoCursoGuardar', 'Contenido eliminado', 'alert-success', 3000)">
              Eliminar
            </button>
          </div>
        </form>
    </div>
  </div>
</div>

<!-- ============= Modal Eliminar Asociación  ====================-->

<div id="modalEliminarAsistente" class="modal fade" tabindex="-1" role="dialog" aria-labelledby="myLargeModalLabel"
aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-dialog-centered modal-lg">
    <div class="modal-content">
      <div class="modal-header">

        <h5 class="modal-title" id="TituloModalEliminarAsistente"><strong>¿Estas seguro que deseas eliminar este asistente del {{curso.id.nombre}}?</strong> </h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      
 
        <form id="formularioModalEliminarAsistente" action="/private/docLaruex/eliminarAsistente/0/" method="POST"
          enctype="multipart/form-data">
          {% csrf_token %}
          <!-- indica el tipo de objeto se que va a añadir -->
          <div class="modal-footer d-flex justify-content-center">
            <button id="cerrarEliminarAsistente" type="button" class="btn btn-secondary" data-dismiss="modal" hidden>Cerrar</button>
            <button class="btn btn-secondary" data-dismiss="modal"  id="cancelEliminarAsistente" name="cancel" onclick="crearAviso('eliminarObjetoCancelar', 'No se ha podido eliminar', 'alert-warning', 3000)">Cancelar</button>
            <button type="submit" value="submit" class="btn btn-danger" onclick="crearAviso('eliminarObjetoGuardar', 'Asistente eliminado', 'alert-success', 3000)">
              Eliminar
            </button>
          </div>
        </form>
    </div>
  </div>
</div>

<!-- ========== Modal para asociar habilitaciones a usuarios ========== -->
<div id="modalAsociarAsistentes" class="modal fade bd-example-modal-lg" tabindex="-1" role="dialog"
    aria-labelledby="modalAsociarAsistentes" aria-hidden="true">
    <div class="modal-dialog modal-dialog-scrollable modal-dialog-centered modal-xl">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="TituloModal">
            <strong>
              Seleccione los usuarios que desea asociar.
            </strong>
          </h5>
          <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span
              aria-hidden="true">&times;</span></button>
        </div>
        <!-- END Cabecera del modalAsociarAsistentes -->

        <!-- Body del modalAsociarAsistentes -->
        <div class="modal-body">
          <form id="formularioAsociarAsistentes" enctype="multipart/form-data">
            {% csrf_token %}
            <div class="row justify-content-center" hidden>
              <div class="col-11 ">
                <div class="card card p-4 ">
                  <div class="form-group">
                    <input required type="number" class="form-control" id="nombreObjeto"
                      name="nombreObjeto" value="{{curso.id.id}}" readonly>
                  </div>
                </div>
              </div>
            </div>

            <div class="row justify-content-center">
              <div class="col-lg-5">
                <div class="card card p-4 ">
                  <h5 class="card-title text-center">Lista de Usuarios</h5>
                  <table class="table-sm table-hover" id="tabla_usuarios_para_asociar" data-search="true"
                    data-buttons-class="light" data-pagination="true" data-id-field="id" data-page-list="[10]"
                    data-toolbar="#toolbar"></table>
                </div>
              </div>

              <div class="col-lg-1 col-12 my-auto text-center">
                <i id="flechas" class="fa-solid fa-arrow-right-arrow-left fa-3x" style="color: rgb(41,68,87)"></i>
              </div>

              <div class="col-lg-5">
                <div class="card p-4">
                  <h5 class="card-title text-center">Usuarios seleccionados</h5>
                  <table id="tabla_usuarios_para_asociar_seleccionados" class="table-sm table-hover" data-search="true"
                    data-buttons-class="light" data-pagination="true" data-id-field="id" data-page-list="[10]"
                    data-toolbar="#toolbar"></table>
                </div>
              </div>
            </div>
        </div>
        <input type="text" id="idUsuarioActual" value="{{ id }}" hidden name="idUsuarioActual" data-rule="required" />
        <input type="text" id="idUsuariosSeleccionados" value="{{ id }}" hidden name="idUsuariosSeleccionados"
          data-rule="required" />

        <!-- Footer del ModalAsociarAsistentes -->
        <div class="modal-footer d-flex">

          <button id="cerrarAsociarAsistentes" type="button" class="btn btn-secondary" data-dismiss="modal">
            Cerrar
          </button>
          <button type="submit" value="submit" class="btn btn-primary">
            Guardar
          </button>
        </div>
        <!-- END Footer del ModalAsociarAsistentes -->
      </div>
    </div>
  </div><!-- END Body del ModalAsociarAsistentes -->
  </form>
</div> <!-- END ModalAsociarAsistentes -->


<!-- ========== Modal para Ver imagen ========== -->
  <!-- Section: Modals -->
  <section class="">
    <!-- Modal 1 -->
    <div
      class="modal fade"
      id="modalVerImagen"
      tabindex="-1"
      aria-labelledby="modalVerImagen"
      aria-hidden="true"
    >
      <div class="modal-dialog modal-dialog-centered" role="document">
        <div class="modal-content">
          <div class="modal-body">
            <img src="" class="img-fluid" id="imagenModal">
          </div>
        </div>
      </div>
    </div>
  </section>


<script>
  // ===================== Tabla con lista de notificaciones =====================



  function getSelecionados() {
    // get value of selected  element in select box
    var tipo = document.getElementById("tipoAsistente").value;
    var id_curso = '{{ curso.id.id }}';
    console.log(typeof(tipo));
    if (tipo == "Todos"){
      $("#tabla_relacion_asistentes").bootstrapTable('refresh', { url: "/private/docLaruex/asistentesCursoDatos/" + id_curso + "/" });
    }else{
      // actualizar la tabla con los seleccionados
      $("#tabla_relacion_asistentes").bootstrapTable('refresh', { url: "/private/docLaruex/asistentesCursoTipoDatos/" + id_curso + "/" + tipo + "/" });
    }
  }

  $(document).on('click', '.imagen-modal', function(event) {
    event.preventDefault();
    var imageUrl = $(this).find('img').attr('src');
    console.log(imageUrl);
    $('#imagenModal').attr('src', imageUrl);
    $('#modalVerImagen').modal('show');
  });

  $("#tabla_notificaciones").bootstrapTable({
    method: "get",
    url: "/private/docLaruex/notificacionesDatos/{{ curso.id.id }}/",
    cache: false,
    locale: navigator.language,
    columns: [
      {
        title: "Fecha",
        field: "fecha",
        sortable: "true",
        align: "center",
        formatter: function (value, row) {
          var fecha = new Date(row.fecha);
          return (
            $.datepicker.formatDate("dd-mm-yy", fecha)
          );
        },
      },
      {
        title: "Título",
        field: "titulo",
        align: "center",
      },
      {
        title: "Resumen",
        field: "resumen",
        align: "center",
      },
      {
        title: "Creador",
        field: "creador",
        align: "center",
        formatter: function (value, row) {
          return row.creador__first_name + " " + row.creador__last_name;
        },
      },
      {
        title: "Estado",
        field: "estado_notificacion__nombre",
        align: "center",
        formatter: function (value, row) {
          var defecto = '<span class="badge" style="background-color: #524e4e;">Enviada</span>';
          switch (row.estado_notificacion__id) {
            case 1:
              estado = '<span class="badge badge-success" style="background-color: #524e4e;">Enviada</span>';
              return estado;
              break;
            case 2:
              estado = '<span class="badge" style="background-color: #0A9396;">Recibida</span>';
              return estado;
              break;

            case 3:
              estado = '<span class="badge" style="background-color: #EB8E34;">En tramite</span>';
              return estado;
              break;
            case 4:
              estado = '<span class="badge" style="background-color: #21b563;">Cerrada</span>';
              return estado;
              break;
            case 5:
              estado = '<span class="badge" style="background-color: #b52121;">No atendida</span>';
              return estado;
              break;

            default:
              return defecto;

          }
        },
      },
    ],
    search: true,
    sortName: "id",
    sortOrder: "desc",
  });


      // cambiamos la funcionalidad del boton submit del formulario de envio de notificaciones
  // ++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
  $("#formularioModalEnviarNota").submit(function (e) {
    // cancelamos el funcionamiento por defecto del boton submit
    e.preventDefault();
    // capturamos la información del formulario 
    var data = new FormData(this);
    // ejecuta una url/action con la capacidad de gestionar la salida
    $.ajax({
      url: "/private/docLaruex/agregarNotificacion/",
      type: "POST",
      data: data,
      cache: false,
      contentType: false,
      processData: false,
      // gestiono el return del view
      success: function () {
        crearAviso('objetoGuardar', 'Notificacion guardado con éxito', 'alert-success', 2000)
        $('#tabla_notificaciones').bootstrapTable('refresh');
        $(".divFormularios").remove();
        $("#reset").trigger("click");
        $('#cerrar').trigger('click');
        
      }
    });
  });

  function generarCertificado(){
      window.open("/private/docLaruex/generarCertificadoCurso/"+ "{{ curso.id.id }}","/");
    }

    
  function addZero(i) {
    if (i < 10) { i = "0" + i }
    return i;
  }

  
   // Tabla con lista de referencias asociadas
   $("#tabla_referencias_asociadas").bootstrapTable({
    method: "get",
    url: "/private/docLaruex/archivosAsociados/{{ curso.id.id }}/",
    cache: false,
    locale: navigator.language,
    columns: [
      {
        title: "ID",
        field: "id_relacionado",
        align: "center",
      },
      {
        title: "Nombre",
        field: "id_relacionado__nombre",
        align: "center",
      },
      {
        title: "Tipo",
        field: "id_relacionado__tipo",
        align: "center",
      },
      {
        title: "Creador",
        field: "creador",
        align: "center",
        formatter: function (value, row) {
          return (
            row.id_relacionado__creador__first_name +
            " " +
            row.id_relacionado__creador__last_name
          );
        },
      },
      {
        title: "Fecha",
        field: "id_relacionado__fecha_subida",
        sortable: "true",
        align: "center",
        formatter: function (value, row) {
          var fecha = new Date(row.id_relacionado__fecha_subida);
          return (
            $.datepicker.formatDate("dd-mm-yy", fecha) +
            " " +
            addZero(fecha.getHours()) +
            ":" +
            addZero(fecha.getMinutes())
          );
        },
      },
      {
        title: "Estado",
        field: "id_relacionado__id_estado__id",
        align: "center",
        
        formatter: function (value, row) {
          var defecto = '<span class="badge" style="background-color: #EB8E34;">En Revisión</span>';
          switch (row.id_relacionado__id_estado__id) {
            case 1:
              estado = '<span class="badge badge-success" style="background-color: #21b563;">Operativo</span>';
              return estado;
              break;
            case 2:
              estado = '<span class="badge" style="background-color: #21b563;">En Vigor</span>';
              return estado;
              break;

            case 3:
              estado = '<span class="badge" style="background-color: #EB8E34;">En Mantenimiento</span>';
              return estado;
              break;
            case 4:
              estado = '<span class="badge" style="background-color: #EB8E34;">En Revisión</span>';
              return estado;
              break;
            case 5:
              estado = '<span class="badge" style="background-color: #524e4e;">Obsoleto</span>';
              return estado;
              break;
            case 6:
              estado = '<span class="badge" style="background-color: #b52121;">No operativo</span>';
              return estado;
              break;
            case 7:
              estado = '<span class="badge" style="background-color: #b52121;">Baja</span>';
              return estado;
              break;

            default:
              console.log("No se ha encontrado el estado", row.id_relacionado__id)
              return defecto;

          }
        },
    },{
        title: "Acciones",
        field: "action",
        align: "center",
        formatter: function (value, row) {
          // Definimos las variables  
          var admin = '{{administrador}}';
          var habilitacionesUsuario = '{{ habilitacionesUsuario }}';
          var habilitacionNecesaria = row.id_relacionado__id_habilitacion;
          var existeHabilitacion = 'False';
          var objeto = '{{curso.id.id}}'; 
          var rol = '{{rol}}'; 

          var botonVerDocumento = '<a href="/private/docLaruex/verObjeto/' + row.id_relacionado + '/" class="mx-1" title="Abrir" ><i class="fa-solid fa-arrow-right-to-bracket fa-lg" style="color:#68B29E"></i></a>';
          var botonDescargarDocumentoPDF = '<a href="/private/docLaruex/consultarArchivo/' + row.id_relacionado + '/' + '" class="mx-1" title="Descargar" download><i class="fa-solid fa-file-pdf fa-lg" style="color:#A11020"></i></a>';
          var botonDescargarDocumentoWord = '<a href="/private/docLaruex/consultarArchivoEditable/' + row.id_relacionado + '/' + '" class="mx-1" title="Descargar" download><i class="fa-duotone fa-file-signature fa-lg" style="color:#266353"></i></a>';          
          var botonEliminarAsociacion = '<a href="/private/docLaruex/eliminarAsocicion/' + row.id_relacionado + '/' +  objeto + '/" class="mx-1" title="Eliminar Asociacion" data-toggle="modal" data-target="#modalEliminarAsociacion" onclick="$('+"'#formularioModalEliminarAsociacion').attr('action', '/private/docLaruex/eliminarAsocicion/"+ row.id_relacionado +"/"+ objeto + "/');"+'"  style="color:#AE2012"><i class="fa-duotone fa-link-slash" ></i></a>';


          if (admin == 'True') {
            if(row.id_relacionado__ruta_editable){

              return (botonVerDocumento + botonDescargarDocumentoPDF + botonDescargarDocumentoWord +botonEliminarAsociacion);
            }else{
              return (botonVerDocumento + botonDescargarDocumentoPDF +botonEliminarAsociacion);
            }
          } else if (rol == 'Responsable' || rol == 'Director') {
            if (row.id_relacionado){
              return (botonVerDocumento + botonDescargarDocumentoPDF + botonDescargarDocumentoWord);
            }else{
              return (botonVerDocumento + botonDescargarDocumentoPDF);
            }
            
          }else {
              return (botonVerDocumento + botonDescargarDocumentoPDF);
          }
        },
      },
    ],
    search: true,
    sortOrder: "desc",
  });

  /*
    ------------ TABLAS Y FUNCIONES DEL MODAL ASOCIAR USUARIOS ------------
  */

  //tabla del modal asociar objetos
  $("#tabla_archivos_para_asociar").bootstrapTable({
    method: "get",
    locale: navigator.language,
    url: "/private/docLaruex/archivosDatosAsociar",
    cache: false,
    columns: [
      {
        title: "ID",
        field: "id",
        align: "center",
      }, {
        title: 'Empleado',
        field: "nombre",
        align: "center",
      },{
        title: 'Tipo',
        field: "tipo",
        align: "center",
      }, {
        title: "",
        field: "action",
        align: "center",
        formatter: function (value, row) {
          return (
            '<div onclick="addValueTable(' + row.id + ', &apos;' + row.nombre + '&apos;)" class="mx-1" title="select"><i class="fa-solid fa-angles-right fa-lg" style="color:#68B29E"></i></div>'
          );
        },
      },
    ],
    search: true,
    sortName: "id",
    sortOrder: "asc",
  });

  function addValueTable(id, 
  nombre, tipo) {
    $("#tabla_archivos_para_asociar_seleccionados").bootstrapTable('insertRow', {
      index: 0,
      row: {
        id: id,
        nombre: nombre ,
      }
    });
  }

  // tatbla de elementos seleccionados
  $("#tabla_archivos_para_asociar_seleccionados").bootstrapTable({
    locale: navigator.language,
    cache: false,
    columns: [
      {
        title: "ID",
        field: 'id',
        align: "center",
      }, {
        title: "Empleado",
        field: 'nombre',
        align: "center"
      },{
        title: "",
        field: "action",
        align: "center",
        formatter: function (value, row) {
          return (
            '<div onclick="deleteValue(' + row.id + ')" class="mx-1" ><i class="fa-solid fa-xmark fa-lg" style="color:#F52220"></i></div>'

          );
        },
      },
    ],
    search: true,
    sortName: "id",
    sortOrder: "asc",
  });

  function deleteValue(id) {
    $("#tabla_archivos_para_asociar_seleccionados").bootstrapTable('remove', {
      field: 'id',
      values: [id]
    })
  }

  // cambiamos la funcionalidad del boton submit del formulario
  $("#formularioAsociarArchivo").submit(function (e) {
    // cancelamos el funcionamiento por defecto del boton submit
    e.preventDefault();
    $table = $("#tabla_archivos_para_asociar_seleccionados");
    var idSeleccionado = "";
    var cargoIDSeleccionado = "";
    for (let value of $table.bootstrapTable('getData')) {
      console.log("info file");
      console.log(value);
      idSeleccionado = idSeleccionado + value["id"] + "#";
      
      console.log(idSeleccionado);
    }
    
    $("#idArchivosSeleccionados").val(idSeleccionado);
    console.log($("#idArchivosSeleccionados").val());
    // capturamos la información del formulario 
    var data = new FormData(this);
    // ejecuta una url/action con la capacidad de gestionar la salida
    
    $.ajax({
      url: "/private/docLaruex/asociarArchivo/{{ curso.id.id }}/",
      type: "POST",
      data: data,
      cache: false,
      contentType: false,
      processData: false,
      // gestiono el return del view
      success: function () {
        $table.bootstrapTable('removeAll');
        $("#idArchivosSeleccionados").val("");
        $('#tabla_referencias_asociadas').bootstrapTable('refresh');
        $('#cerrarAsociar').trigger('click');
      }
    });
  });

  
  //tabla del modal asociar objetos
  $("#tabla_usuarios_para_asociar").bootstrapTable({
    method: "get",
    locale: navigator.language,
    url: "/private/docLaruex/contactosDatosAsociarCurso",
    cache: false,
    columns: [
      {
        title: "ID",
        field: "id",
        align: "center",
      },{
        title: 'Empleado',
        align: "center",
        formatter: function (value, row) {
          return (
            row.nombre
          );
        },
      }, {
        title: "",
        field: "action",
        align: "center",
        formatter: function (value, row) {
          return (
            '<div onclick="addValueTable(' + row.id + ', &apos;' + row.nombre + '&apos;)" class="mx-1" title="select"><i class="fa-solid fa-angles-right fa-lg" style="color:#68B29E"></i></div>'
          );
        },
      },
    ],
    search: true,
    sortName: "id",
    sortOrder: "asc",
  });

  
  function addValueTable(id, nombre) {
    $("#tabla_usuarios_para_asociar_seleccionados").bootstrapTable('insertRow', {
      index: 0,
      row: {
        id: id,
        nombre: nombre,
      }
    });
  }

  // tatbla de elementos seleccionados
  $("#tabla_usuarios_para_asociar_seleccionados").bootstrapTable({
    locale: navigator.language,
    cache: false,
    columns: [
      {
        title: "ID",
        field: 'id',
        align: "center",
      }, {
        title: "Asistente",
        field: 'nombre',
        align: "center"
      }, {
        title: "Tipo",
        field: 'tipo',
        align: "center",
        formatter: function (value, row) {
          return ( 
            '<select class="form-select" data-rule="required" id="tipoAsistente'+row.id.toString()+'" name="tipoAsistente"><option value="Ponente">Ponente</option><option value="Asistente" selected="selected">Asistente</option></select>'

          );
        },
      }, {
        title: "",
        field: "action",
        align: "center",
        formatter: function (value, row) {
          return (
            '<div onclick="deleteValue(' + row.id + ')" class="mx-1" ><i class="fa-solid fa-xmark fa-lg" style="color:#F52220"></i></div>'

          );
        },
      },
    ],
    search: true,
    sortName: "id",
    sortOrder: "asc",
  });


  // tatbla de elementos seleccionados
  $("#tabla_relacion_asistentes").bootstrapTable({
    method: "get",
    locale: navigator.language,
    url: "/private/docLaruex/asistentesCursoDatos/{{curso.id.id}}",
    cache: false,
    columns: [ {
        title: "Imagen",
        field: 'id_asistente__img',
        align: "center",
        formatter: function (value, row) {
            var mediaRuta = "{% get_media_prefix %}";
           var imagen ='<a href="" title="Ver Imagen" data-target="#modalVerImagen" class="mx- imagen-modal" data-toggle="modal" data-toggle="tooltip" ><img src="'+ mediaRuta +'archivos/Contacto/'+ row.id_asistente__img +'" alt="Profile" class="rounded-circle" style=" max-width: 40px; " ></a>';
          return (
            imagen
          );
        },
      }, {
        title: "Tipo",
        field: 'tipo',
        align: "center",
      },{
        title: "Asistente",
        field: 'id_asistente__nombre',
        align: "center"
      },{
        title: "",
        field: "action",
        align: "center",
        formatter: function (value, row) {
           var curso = '{{curso.id.id}}';
           var admin = '{{administrador}}';
           var botonVerContactoAsistente = '<a href="/private/docLaruex/contacto/' + row.id_asistente__id + '/" class="mx-1" title="Abrir" ><i class="fa-solid fa-arrow-right-to-bracket fa-lg" style="color:#68B29E"></i></a>';

           
          var botonEliminarAsistenteContacto = '<a href="/private/docLaruex/eliminarAsistente/' + row.id_asistente__id + '/' +  curso + '/" class="mx-1" title="Eliminar Asistente" data-toggle="modal" data-target="#modalEliminarAsistente" onclick="$('+"'#formularioModalEliminarAsistente').attr('action', '/private/docLaruex/eliminarAsistente/"+ row.id_asistente__id +"/"+ curso + "/');"+'"  style="color:#AE2012"><i class="fa-duotone fa-link-slash" ></i></a>';
          if (admin == 'True'){
            return (
              botonVerContactoAsistente + botonEliminarAsistenteContacto
            );
            
          }else{
            return (
              botonVerContactoAsistente
            );
          }
        },
      },
    ],
    search: true,
    sortName: "id",
    sortOrder: "asc",
  });

  function deleteValue(id) {
    $("#tabla_usuarios_para_asociar_seleccionados").bootstrapTable('remove', {
      field: 'id',
      values: [id]
    })
  }

  // cambiamos la funcionalidad del boton submit del formulario
  $("#formularioAsociarAsistentes").submit(function (e) {
    // cancelamos el funcionamiento por defecto del boton submit
    e.preventDefault();
    $table = $("#tabla_usuarios_para_asociar_seleccionados");
    var idSeleccionado = "";
    var tipoIDSeleccionado = "";
    for (let value of $table.bootstrapTable('getData')) {
      console.log("info file");
      console.log(value);
      idSeleccionado = idSeleccionado + value["id"] +"@" + document.getElementById('tipoAsistente'+value["id"].toString()).value + "#";
      
      console.log(idSeleccionado);
    }
    
    $("#idUsuariosSeleccionados").val(idSeleccionado);
    console.log($("#idUsuariosSeleccionados").val());
    // capturamos la información del formulario 
    var data = new FormData(this);
    // ejecuta una url/action con la capacidad de gestionar la salida
    
    $.ajax({
      url: "/private/docLaruex/asociarAsistentesCurso/",
      type: "POST",
      data: data,
      cache: false,
      contentType: false,
      processData: false,
      // gestiono el return del view
      success: function () {
        $table.bootstrapTable('removeAll');
        $("#idUsuariosSeleccionados").val("");
        $('#tabla_relacion_asistentes').bootstrapTable('refresh');
        $('#cerrarAsociarAsistentes').trigger('click');
      }
    });
  });

  // mostramos el nombre de la imagen en el input de adjuntar archivo y cambiamos el label del boton de adjuntar archivo
  function mostrarNombreArchivo(value) {

    document.getElementById('archivo-name').innerHTML = value;

    document.getElementById('mostrarNombreArchivo').style.display = 'none';

    const elemento = document.getElementById('pdf-filePonencia')
    const nuevoElemento = document.createElement("i");
    nuevoElemento.className = "fa-duotone fa-file-check fa-4x addFicheroActualizado";
    elemento.replaceWith(nuevoElemento);
    }


  // mostramos el nombre de la imagen en el input de adjuntar archivo y cambiamos el label del boton de adjuntar archivo
  function mostrarNombreArchivoCurso(value) {

    document.getElementById('archivoCurso-name').innerHTML = value;

    document.getElementById('mostrarNombreArchivoCurso').style.display = 'none';

    const elemento = document.getElementById('pdf-fileCurso')
    const nuevoElemento = document.createElement("i");
    nuevoElemento.className = "fa-duotone fa-file-check fa-4x addFicheroActualizado";
    elemento.replaceWith(nuevoElemento);
    }


</script>


<!--collapse con listado de equipos asociados a la estación -->
{% endblock %}