{% extends "base/base_docLaruex.html" %}
{% load static %}

{% block content %}

<style>
  ul.pagination li .page-link {
    background-color: rgb(255, 255, 255) !important;
    color: rgb(41, 68, 87);

  }

  ul.pagination li.active .page-link {
    background-color: rgb(41, 68, 87) !important;
    border-color: rgb(41, 68, 87) !important;
  }

  ul.pagination li .page-link:hover {
    filter: brightness(85%);

  }


  ul.pagination li.active .page-link:hover {
    filter: brightness(120%);

  }

  .btn-light {
    color: rgb(41, 68, 87);
  }

  th {
    color: rgb(41, 68, 87);
  }

  table {
    width: auto;
    height: auto;
    font-size: auto;
    padding: auto;
    margin: auto;
  }

  #flechas {
    width: auto;
    height: auto;
  }

  /* --------------------------------
  *  ESTILO DE LOS BOTONES
  -----------------------------------*/
  .add:hover {
    color: #ce8312;
  }

  .duplicar:hover {
    color: #005f73;
  }

  .eliminar:hover {
    color: #9b2226;
  }

  .mover:hover {
    color: #001219;
  }

  .print:hover {
    color: #001219;
  }

  /*  3 estilo del campo añadir archivo*/
  .addFichero {
    color: rgb(9, 58, 65);
  }

  .addFichero:hover {
    color: rgb(133, 198, 228);
  }


  .addFichero:hover {
    color: rgb(133, 198, 228);
  }

  /* estilo añadirFichero PDF*/
  .addFicheroPDF {
    color: rgb(161, 16, 32);
  }

  .addFicheroPDF:hover {
    color: rgb(99, 10, 20);
  }

  .enviarNotificacion:hover {
    color: #064061;
  }

  /* estilo añadirFichero PDF*/
  .addFoto {
    color: #064061;
  }

  .addFoto:hover {
    color: #397fa7;
  }

    .okFoto {
    color: #25bd71;
  }

  .file-upload {
    border: 1px solid #ccc;
    display: inline-block;
    padding: 6px 12px;
    cursor: pointer;
  }

  /* ===============================
  *  Estilo del los botones
  =================================*/

  .agregarFormacion:hover {
    color: #032031;
  }

  .descargaPDF:hover {
    color: #c36d0b;
  }

  .eliminar:hover {
    color: #4f0208;
  }

  .retirarStockUbicacion:hover {
    color: #042e37;
  }

  .entrar:hover {
    color: #195746;
  }

  .modificarObjeto:hover {
    color: #bb3e03;
  }


  .generarQR {
    --fa-primary-color: #6a3c90;
    --fa-secondary-color: #6a3c90;
  }

  .generarQR:hover {
    --fa-primary-color: #c7a9e0;
    --fa-secondary-color: #9875b5;
    ;
  }
</style>

<!-- breadcrumb   -->

<div class="card-body">

  {% if equipo.fecha_baja %}
  <h5 class="card-title" style="color: #c52e2e;">{{ equipo.id.nombre }}

    {% else %}
    <h5 class="card-title">{{ equipo.id.nombre }}
      <!-- RESTRINGIR ADMINISTRADOR -->
      <a href="/private/docLaruex/editarObjeto/{{ equipo.id.id }}/" title="Editar" style="color:#f3773e"><i
          class="fa-duotone fa-money-check-pen modificarObjeto mx-2"></i></a>
      {% endif %}

    </h5>
    <nav>
      <ol class="breadcrumb" style="background-color:#fff !important">
        <li class="breadcrumb-item" style="font-size: large;"><a href="\private/docLaruex/"><i
              class="bi bi-house-door"></i></a></li>
        <li class="breadcrumb-item" style="font-size: large;"><a href="\private/docLaruex/objetos">Listado de
            Objetos</a>
        </li>
        <li class="breadcrumb-item" style="font-size: large;"><a href="\private/docLaruex/tipoObjeto/Equipo">Listado de
            Equipos</a>
        </li>
        <li class="breadcrumb-item" style="font-size: large;"><a
            href="\private/docLaruex/verObjeto/{{ equipo.id.id }}/">{{ equipo.id.nombre }}</a></li>
      </ol>
    </nav>
</div>


<section class="section dashboard d-flex justify-content-center">
  <div class="row">
    <div class="col-lg-4 col-md-6 col-12 my-auto">
      {% if tarea %}
      <!-- Código Laruex Card -->
      <div class="card info-card revenue-card">
        <div class="card-body">
          <div class="d-flex align-items-center">

            <div class="ps-3 text-center">
              {% if registro.estado__id == 1 %}
              <h6>Próximo mantenimiento</h6>
              <h2 style="color:#005f73"><i class="fa-duotone fa-clock fa-beat fa-lg me-2"
                  style="color: #005f73;"></i><strong>{{tarea.fecha_proximo_mantenimiento|date}}</strong></h2>
              {% elif registro.estado__id == 2 %}
              <h6>Cuidado, mantenimiento a punto de cumplir</h6>

              <h2 style="color:#bb3e03"><i class="fa-duotone fa-clock fa-beat fa-lg me-2"
                  style="color: #bb3e03;"></i><strong>{{tarea.fecha_proximo_mantenimiento|date}}</strong></h2>

              {% elif registro.estado__id == 4 %}
              <h6 class="my-2">¡Alerta!, mantenimiento fuera de plazo</h6>
              <h2 style="color:#ae2012"><i class="fa-duotone fa-clock fa-beat fa-lg me-2"
                  style="color: #ae2012;"></i><strong>{{tarea.fecha_proximo_mantenimiento|date}}</strong></h2>
              {% else %}
              <h6 class="my-2"><strong>Mantenimiento cancelado</strong></h3>
                {% endif %}
            </div>
          </div>
        </div>
      </div><!-- Código Laruex Card -->
      {% endif %}
      <!-- Fecha de alta Card -->
      <div class="card info-card revenue-card">
        <div class="card-body">
          <div class="d-flex align-items-center">
            <div class="card-icon rounded-circle d-flex align-items-center justify-content-center">
              <i class="fa-solid fa-calendar-day" style="color: #0b5332;"></i>
            </div>
            <div class="ps-3">
              <h6>Fecha de Alta</h6>
              <span class="text-success medium pt-1 fw-bold">{{ equipo.fecha_alta }}</span>
            </div>
          </div>
        </div>
      </div><!-- Fecha de alta Card -->

      <!-- Código Laruex Card -->
      <div class="card info-card revenue-card">
        <div class="card-body">
          <div class="d-flex align-items-center">
            <div class="card-icon rounded-circle d-flex align-items-center justify-content-center">
              <i class="fa-solid fa-barcode" style="color: #0b5332;"></i>
            </div>
            <div class="ps-3">
              <h6>Código Laruex</h6>
              <span class="text-success medium pt-1 fw-bold">{{ equipo.cod_laruex }}</span>
              <span class="text-success medium pt-1 fw-bold">/</span>
              <span class="text-success medium pt-1 fw-bold">{{ equipo.fecha_alta|date:"Y"}}</span>
            </div>
          </div>
        </div>
      </div><!-- Código Laruex Card -->
      {% if equipo.cod_uex %}
      <!-- Código Laruex Card -->
      <div class="card info-card revenue-card">
        <div class="card-body">
          <div class="d-flex align-items-center">
            <div class="card-icon rounded-circle d-flex align-items-center justify-content-center">
              <i class="fa-solid fa-barcode" style="color: #0b5332;"></i>
            </div>
            <div class="ps-3">
              <h6>Código Uex</h6>
              <span class="text-success medium pt-1 fw-bold">{{ equipo.cod_uex }}</span>
            </div>
          </div>
        </div>
      </div><!-- Código Laruex Card -->
      {% endif %}
      {% if equipo.cod_spida %}
      <!-- Código Laruex Card -->
      <div class="card info-card revenue-card">
        <div class="card-body">
          <div class="d-flex align-items-center">
            <div class="card-icon rounded-circle d-flex align-items-center justify-content-center">
              <i class="fa-solid fa-barcode" style="color: #0b2b53;"></i>
            </div>
            <div class="ps-3">
              <h6>Código Spida</h6>
              <span class="text-success medium pt-1 fw-bold">{{ equipo.cod_spida }}</span>
              <span class="text-success medium pt-1 fw-bold">/</span>
              <span class="text-success medium pt-1 fw-bold">{{ equipo.fecha_alta|date:"Y"}}</span>
            </div>
          </div>
        </div>
      </div><!-- Código Laruex Card -->

      {% endif %}
    </div>



    <!-- Info Relevante -->

    <div class="col-lg-4 col-md-6 col-12 my-auto">
      {% if equipo.fecha_baja %}
      <div class="card info-card sales-card" style="background-color: #f7dede;">
        {% else %}
        <div class="card info-card sales-card">
          {% endif %}

          <div class="card-body">
            <h5 class="card-title text-center">Información Relevante
              {% if equipo.id.ruta %}
              <a href="" title="Ver Imagen" class="mx-" data-toggle="modal" data-toggle="tooltip"
                data-target="#modalVerImagen" style="color: #bb3e03; "><i class="fa-duotone fa-image"></i></a>
              {% endif %}
            </h5>

            <div class="d-flex align-items-center p-2">
              <div class="card-icon rounded-circle d-flex align-items-center justify-content-center"
                style="background-color: #b5d8e252;">
                <i class="bi bi-reception-3" style="color: #18414b;"></i>
              </div>
              <div class="ps-3">
                <h5><strong>Estado del Equipo:</strong></h5>
                <span class="text-success medium pt-1 fw-bold">
                  {% if equipo.id.id_estado.id == 1 or equipo.id.id_estado.id == 2 %}
                  <span class="badge text-white"
                    style="background-color: #21b563; vertical-align:middle">{{equipo.id.id_estado.nombre}}</span>
                  {% elif equipo.id.id_estado.id == 3 or equipo.id.id_estado.id == 4 %}
                  <span class="badge text-white"
                    style="background-color: #EB8E34; vertical-align:middle">{{equipo.id.id_estado.nombre}}</span>
                  {% elif equipo.id.id_estado.id == 5 %}
                  <span class="badge text-white "
                    style="background-color: #524e4e; vertical-align:middle">{{equipo.id.id_estado.nombre}}</span>
                  {% else %}
                  <span class="badge text-white "
                    style="background-color: #b52121; vertical-align:middle">{{equipo.id.id_estado.nombre}}</span>
                  {% endif %} </span>
              </div>
            </div>

            <div class="d-flex align-items-center p-2">
              <div class="card-icon rounded-circle d-flex align-items-center justify-content-center"
                style="background-color: #b5d8e252;">
                <i class="fa-solid fa-plug" style="color: #18414b;"></i>
              </div>
              <div class="ps-3">
                <h5><strong>Tipo</strong></h5>
                <span class="text-success medium pt-1 fw-bold">{{ equipo.tipo_equipo.nombre }}</span>
              </div>
            </div>
            <div class="d-flex align-items-center p-2">
              <div class="card-icon rounded-circle d-flex align-items-center justify-content-center"
                style="background-color: #b5d8e252;">
                <i class="fa-solid fa-user-headset" style="color: #18414b;"></i>
              </div>
              <div class="ps-3">
                <h5><strong>Fabricante</strong></h5>
                <span class="text-success medium pt-1 fw-bold">{{ equipo.fabricante.nombre }}</span>
              </div>
            </div>

            <div class="d-flex align-items-center p-2">
              <div class="card-icon rounded-circle d-flex align-items-center justify-content-center"
                style="background-color: #b5d8e252;">
                <i class="fa-duotone fa-buildings" style="color: #18414b;"></i>
              </div>
              <div class="ps-3">
                <h5><strong>Proveedor</strong></h5>
                <span class="text-success medium pt-1 fw-bold">{{ equipo.proveedor.nombre }}</span>
              </div>
            </div>
            <div class="d-flex align-items-center p-2">
              <div class="card-icon rounded-circle d-flex align-items-center justify-content-center"
                style="background-color: #b5d8e252;">
                <i class="fa-solid fa-barcode" style="color: #18414b;"></i>
              </div>
              <div class="ps-3">
                <h5><strong>Número de Serie</strong></h5>
                <span class="text-success medium pt-1 fw-bold">{{ equipo.num_serie }}</span>
              </div>
            </div>
            {% if equipo.fecha_baja %}
            <div class="d-flex align-items-center p-2">
              <div class="card-icon rounded-circle d-flex align-items-center justify-content-center"
                style="background-color: #b5d8e252;">
                <i class="fa-solid fa-calendar-day" style="color: #18414b;"></i>
              </div>
              <div class="ps-3">
                <h5><strong>Fecha de Baja</strong></h5>
                <span class="text-danger medium pt-1 fw-bold">{{ equipo.fecha_baja|date }}</span>
              </div>
            </div>
            {% endif %}
            <div class="d-flex align-items-center p-2">
              <div class="card-icon rounded-circle d-flex align-items-center justify-content-center"
                style="background-color: #b5d8e252;">
                <i class="fa-solid fa-sack-dollar" style="color: #18414b;"></i>
              </div>
              {% if administrador %}
              <div class="ps-3">
                <h5><strong>Importe</strong></h5>
                <span class="medium pt-1 fw-bold" style="color: #ff771d;">{{ equipo.precio }}€</span>
              </div>
              {% endif %}
            </div>

          </div>

        </div>
      </div><!-- End Info Relevante -->



      <!-- Histórico de Ubicaciones -->
      <div class="col-lg-4 col-12 my-auto">

        <div class="row my-auto">
          <div class="col d-flex justify-content-end my-2">

            <a class="mx-1" title="Enviar nota relacionada con {{ equipo.id.nombre }}" data-toggle="modal"
              data-target="#modalFormularioEnviarNota" style="color: #001219; align-items: md-center"><i
                class="fa-duotone fa-message-pen fa-2x enviarNotificacion"></i></a>
            <a class="mx-1" title="Notas relacionadas con {{ equipo.id.nombre }}" data-toggle="modal"
              data-target="#modalFormularioVerNotas" style="color: #001219; align-items: md-center"><i
                class="fa-duotone fa-messages fa-2x enviarNotificacion"></i></a>

            {% if administrador or cargo == "Responsable" or rol == "Secretaria" %}
            <a title="cambiar estado" class="mx-1" data-target="#modalFormularioCambiarEstado" data-toggle="modal"
              style="color: #001219; align-items: md-center"><i
                class="fa-duotone fa-sign-hanging enviarNotificacion fa-2x"></i></a>
            {% endif %}
          </div>
        </div>

        <div class="card">
          <div class="card-body">
            <div class="row">
              <div class="col d-flex justify-content-end">
                <!-- RESTRINGIR ADMINISTRADOR Y RESPONSABLE -->
                <a href="" title="Cambiar Ubicacion" data-toggle="modal" data-target="#modalCambiarUbicacion"
                  style="color:  #eba43d" class="mx-1"><i
                    class="fa-duotone fa-cart-flatbed-boxes fa-2x add mx-2 "></i></a>

                <!-- boton que permite asociar elementos al formato actual-->
                <a href="" title="Asociar Archivo" data-toggle="modal" data-toggle="tooltip"
                  data-target="#modalAsociarArchivo" style="color: #0A9396; "><i
                    class="fa-solid fa-link enlace enviarNotificacion fa-2x"></i></a>
                <a href="/private/docLaruex/generarQR/{{ request.build_absolute_uri }}/{{ equipo.cod_laruex}}"
                  title="GenerarQR"><i class="fa-duotone fa-barcode-read generarQR mx-2 fa-2x"></i></a>

                {% if tarea %}
                <a href="/private/docLaruex/verTarea/{{tarea.id}}/" class="mx-1" title="Ir a la tarea de Mantenimiento"
                  style="color:#511f31"><i class="fa-duotone fa-screwdriver-wrench fa-2x enviarNotificacion"></i></a>
                {% endif %}
              </div>
            </div>

            {% if administrador or rol == "Secretaria" %}
            <div class="accordion accordion-flush" id="accordionFlushBotonesAdministracion">
              <div class="accordion-item">
                <h2 class="accordion-header" id="flush-headingBotonesAdministracion">
                  <button class="accordion-button collapsed card-title text-center" type="button"
                    data-bs-toggle="collapse" data-bs-target="#flush-collapseBotonesAdministracion"
                    aria-expanded="false" aria-controls="flush-collapseBotonesAdministracion">Más botones</button>
                </h2>
                <div id="flush-collapseBotonesAdministracion" class="accordion-collapse collapse"
                  aria-labelledby="flush-headingBotonesAdministracion"
                  data-bs-parent="#accordionFlushBotonesAdministracion">
                  <div class="accordion-body">
                    {% if administrador or rol == "Secretaria" %}

                    <a href="" title="Añadir Documento" class="mx-2" data-toggle="modal"
                      data-target="#modalAddDocumento" style="color: #ee9b00"><i
                        class="fa-solid fa-square-plus add fa-2x"></i></a>

                    <a href="" class="mx-1" title="Duplicar" data-toggle="modal" data-target="#modalDuplicarEquipo"
                      style="color:#005f73"><i class="fa-duotone fa-copy agregarFormacion fa-2x"></i></a>

                    <a href="https://www.unex.es/organizacion/servicios-universitarios/servicios/servicio_gestion_economica/documentos/seccion-de-patrimonio/formularios"
                      target="_blank" title="Acceso a formularios de la uex para altas y bajas de equipos"><img
                        src="{% static 'niceAdminAssets' %}/img/unex/unex.png" class="img-fluid" alt="Responsive image"
                        style=" max-width: 25px; "></a>

                    {% endif %}

                    <a href="/private/docLaruex/reportEquipo/{{ equipo.id.id }}/" title="Imprimir Info Equipo"
                      target="_blank" style="color: #005f73"><i
                        class="fa-duotone fa-file-chart-column fa-2x mx-2 print"></i></a>

                    {% if administrador %}
                    {% if not equipo.fecha_baja %}
                    <a href="private/docLaruex/imprimirEquipo/{{ equipo.id.id }}/" title="Dar de Baja el Equipo"
                      class="mx-2" data-toggle="modal" data-target="#modalBajaEquipo" style="color: #ae2012"><i
                        class="fa-duotone fa-trash eliminar fa-2x"></i></a>
                    {% endif %}
                    {% endif %}
                  </div>
                </div>
              </div>
            </div><!-- End Accordion without outline borders -->
            {% endif %}


          </div>
        </div>

        <div class="card">


          <div class="card-body">


            <h5 class="card-title text-center">Histórico de Ubicaciones</h5>
            <div class="activity">

              {% for historico in historicoUbicaciones %}
              {% if historico in ubicacionActual %}
              <div class="activity-item d-flex">
                <div class="activite-label">{{ historico.fecha|date:"M d, Y" }}</div>
                {% if equipo.fecha_baja %}
                <i class='bi bi-circle-fill activity-badge text-danger align-self-start'></i>
                {% else %}
                <i class='bi bi-circle-fill activity-badge text-info align-self-start'></i>
                {% endif %}

                <div class="activity-content"><a
                    href="\private/docLaruex/verObjeto/{{ historico.id_ubicacion__id__id }}" style="color:#005f73">{{ historico.id_ubicacion__id__nombre }}</a></div>
              </div>
              {% else %}
              <div class="activity-item d-flex">
                <div class="activite-label">{{ historico.fecha|date:"M d, Y" }}</div>
                <i class='bi bi-circle-fill activity-badge text-muted align-self-start'></i>
                <div class="activity-content">{{ historico.id_ubicacion__id__nombre }}
                </div>
              </div>

              {% endif %}

              {% endfor %}

            </div>

          </div>
        </div>
      </div><!-- End Histórico de Ubicaciones -->

      <div class="col-12 my-auto">
        <div class="card info-card customers-card">

          <div class="card-body">
            <h5 class="card-title">Descripción</h5>

            <div class="d-flex align-items-center">
              <div class="card-icon rounded-circle d-flex align-items-center justify-content-center">
                <i class="fa-solid fa-info"></i>
              </div>
              <div class="ps-3">
                <span class="text-dark medium pt-1 fw-bold" style="white-space: pre-line;">{{ equipo.descripcion}}</span>
              </div>
            </div>

          </div>
        </div><!-- End Customers Card -->
      </div>
    </div>
  </div>
</section>

<!-- ============= COLLAPSE REFERENCIAS Y DOCUMENTOS RELACIONADOS ============= -->
<!--collapse con historico de versiones de los procedimientos -->
<section class="section">
  <div class="card">
    <div class="card-body">
      <h6 class="card-title">Referencias / Documentos Relacionados</h6>
      <!-- Accordion without outline borders -->
      <div class="accordion accordion-flush" id="accordionFlushReferenciasEquipo">
        <div class="accordion-item">
          <h2 class="accordion-header" id="flush-headingReferenciasEquipo">
            <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse"
              data-bs-target="#flush-collapseReferenciasEquipo" aria-expanded="false"
              aria-controls="flush-collapseReferenciasEquipo">Documentos relacionados con el equipo {{ equipo.id.nombre }}
            </button>
          </h2>
          <div id="flush-collapseReferenciasEquipo" class="accordion-collapse collapse"
            aria-labelledby="flush-headingReferenciasEquipo" data-bs-parent="#accordionFlushReferenciasEquipo">
            <div class="accordion-body">
              <table id="tabla_referencias_asociadas" data-toggle="table" data-show-export="true"
                data-show-toggle="true" data-export-types="['excel', 'pdf']" data-page-list="[5, 10, 25, 50, 100, All]"
                data-search="true" data-show-columns="true" data-show-columns-toggle-all="true"
                data-show-fullscreen="true" data-buttons="buttons" data-buttons-class="light" data-search="true"
                data-pagination="true" data-toolbar="#toolbar"></table>
            </div>
          </div>
        </div>
      </div><!-- End Accordion without outline borders -->
    </div>
  </div>
</section>

<!-- ========== Modal Enviar Notificacion ================= -->
<div id="modalFormularioEnviarNota" class="modal fade" tabindex="-1" role="dialog" aria-labelledby="myLargeModalLabel"
  aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-dialog-centered modal-lg">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="TituloModal">Generar notificación asociada a {{ equipo.id.nombre }} </h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <form id="formularioModalEnviarNota" method="POST" enctype="multipart/form-data">
          {% csrf_token %}
          <div class="row">
            <div class="col">
              <div class="form-group">
                <input type="text" class="form-control" id="id_doc" name="id_doc" data-rule="required"
                  value="{{ equipo.id.id }}" hidden />
              </div>
              <div class="form-group">
                <input type="text" class="form-control" id="estadoNotificacion" name="estadoNotificacion"
                  data-rule="required" value="1" hidden />
              </div>
            </div>
          </div>
          <div class="row">
            <div class="col-12">
              <div class="form-group">
                <label for="tituloNotificacion">Título</label>
                <input type="text" class="form-control" id="tituloNotificacion" name="tituloNotificacion"
                  data-rule="required" required />
              </div>
            </div>
          </div>
          <div class="row">
            <div class="col-12">
              <div class="form-group">
                <label for="resumenNotificacion">Resumen</label>
                <textarea class="form-control" id="resumenNotificacion" name="resumenNotificacion" rows="5"
                  data-rule="required" placeholder="Escriba un comentario" required></textarea>
              </div>

            </div>
          </div>

          <div class="modal-footer">
            <button id="cerrarEnviarNota" type="button" class="btn btn-secondary" data-dismiss="modal">
              Cerrar
            </button>
            <button id="resetEnviarNota" type="reset" class="btn btn-secondary" hidden>
            </button>
            <button type="submit" value="submit" class="btn btn-primary">
              Guardar
            </button>
          </div>
        </form>
      </div>
    </div>
  </div>
</div>

<!-- ========== Modal Ver Notas ================= -->
<div id="modalFormularioVerNotas" class="modal fade" tabindex="-1" role="dialog" aria-labelledby="myLargeModalLabel"
  aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-dialog-centered modal-lg">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="TituloModal">Notas del {{ equipo.id.nombre }}</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <form id="formularioModalVerNotas" method="POST" enctype="multipart/form-data">
          {% csrf_token %}
          <div class="row">
            <div class="col">
              <table class="table-sm table-hover" id="tabla_notificaciones" data-search="true"
                data-buttons-class="light" data-pagination="true" data-id-field="id" data-page-list="[10]"
                data-toolbar="#toolbar"></table>
            </div>
          </div>

          <div class="modal-footer">
            <button id="cerrarVerNotas" type="button" class="btn btn-secondary" data-dismiss="modal">
              Cerrar
            </button>
          </div>
        </form>
      </div>
    </div>
  </div>
</div>

<!-- ========== Modal Cambiar Estado ================= -->
<div id="modalFormularioCambiarEstado" class="modal fade" tabindex="-1" role="dialog"
  aria-labelledby="myLargeModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-dialog-centered modal-lg">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="TituloModalCambiarEstado">Cambiar estado del {{ equipo.id.nombre }}</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <form id="formularioCambiarEstado" action="/private/docLaruex/editarEstado/{{ equipo.id.id}}/" method="POST"
          enctype="multipart/form-data">
          {% csrf_token %}
          <div class="row">
            <div class="col">
              <div class="form-group">
                <input type="text" class="form-control" id="id_doc" name="id_doc" data-rule="required"
                  value="{{ equipo.id.id }}" hidden />
              </div>
            </div>
          </div>
          <div class="row">
            <div class="col-4">
              <div class="form-group">
                <label>Estado actual</label>
                <input type="text" value="{{equipo.id.id_estado.nombre}}" class="form-control" disabled>

              </div>
            </div>
            <div class="col-8">
              <div class="form-group">
                <label for="nuevoEstado">Nuevo estado</label>
                <select class="form-select my-auto" id="nuevoEstado" name="nuevoEstado">
                  {% for estado in estados %}
                  <option value="{{estado.id}}">
                    {{estado.nombre}}
                  </option>
                  {% endfor %}
                </select>
              </div>
            </div>
          </div>

          <div class="modal-footer">
            <button id="cerrarCambiarEstado" type="button" class="btn btn-secondary" data-dismiss="modal">
              Cerrar
            </button>
            <button id="resetCambiarEstado" type="reset" class="btn btn-secondary" hidden>
            </button>
            <button type="submit" value="submit" class="btn btn-primary">
              Guardar
            </button>
          </div>
        </form>
      </div>
    </div>
  </div>
</div>

<!-- ============= FORMULARIO AÑADIR DOCUMENTO ============= -->
<!-- formulario añadir documento  -->
<div id="modalAddDocumento" class="modal fade" tabindex="-1" role="dialog" aria-labelledby="myLargeModalLabel"
  aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-dialog-centered modal-lg">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="TituloModalAddDocumento">Añadir Documento</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>

      <div class="modal-body ">
        <form id="formularioModalAddDocumento" enctype="multipart/form-data">
          {% csrf_token %}
          <div id="formularioAddDocumento">
            <!-- indica el tipo de objeto se que va a añadir -->
            <div class="form-group">
              <input type="text" class="form-control" id="tipoObjeto" name="tipoObjeto" data-rule="required" readonly
                value="Documento" style="display: none;" />
            </div><!-- fin tipoObjeto -->

            <div class="row">
              <div class="col">
                <div class="form-group">
                  <label for="tipoDocumento">Tipo de Documento</label>
                  <select class="form-select" data-rule="required" id="tipoDocumento" name="tipoDocumento"
                    onchange="mostrarTitulo(this.value)">
                    {% for tipo in tipoDocumentos %}
                    <option value="{{tipo.id}}">{{tipo.nombre}}</option>
                    {% endfor %}
                  </select>
                </div>
              </div>
              <!-- Fecha del documento  -->
              <div class="col-4">
                <div class="form-group">
                  <label for="fechaActualizacion" id="tituloFecha">Fecha de Actual</label>
                  <input type="date" id="fechaActualizacion" name="fechaActualizacion" class="form-control" />
                </div>
              </div><!-- Fin fecha del documento  -->

              <!-- Asigna la habilitacion al documento  -->
              <div class="col">
                <div class="form-group">
                  <select class="form-select" data-rule="required" id="habilitacionAddDocumento" name="habilitacion"
                    style="display: none;">
                    <option value="{{equipo.id.id_habilitacion.id}}" >
                      {{equipo.id.id_habilitacion.titulo}}
                    </option>
                  </select>
                </div>
              </div><!-- fin habilitacion -->
            </div>
            <div id="opcionFormulario">

              <!-- formulario de Documento -->
              <div id="formularioDocumento" class="divFormularios">
                <div class="row">
                  <!-- permite saber si el documento es editable o no  -->
                  <div class="col-4">
                    <div class="form-group">
                      <select class="form-select" data-rule="required" id="editable" name="editable"
                        style="display: none;">
                        <option value="0">No</option>
                      </select>
                    </div>
                  </div><!-- fin documento editable -->
                </div>
                <div class="row">
                  <div class="col">
                    <div class="form-group">
                      <label for="nombreObjeto" id="tituloObjetoNombre">Nombre del Archivo</label>
                      <input type="text" class="form-control" id="nombreObjeto" placeholder="Ej. F-07 "
                        name="nombreObjeto" data-rule="required" />
                    </div>
                  </div>
                </div>
                <div class="row d-flex justify-content-center">
                  <div class="col-md-auto">
                    <div class="form-group">
                      <label for="ficheroAdjuntoDocumento"><i class="fa-solid fa-file-pdf fa-4x addFicheroPDF">
                        </i>
                      </label>
                      <input type="file" class="form-control-file" style="display: none; visibility: none;"
                        id="ficheroAdjuntoDocumento" name="ficheroAdjuntoDocumento"
                        onchange="mostrarNombreArchivo(this.value)" />
                      <spam class="text-center"><strong id="mostrarNombreArchivo"><br></strong>
                        <spam id="file-name"></spam>
                      </spam>
                    </div>
                  </div>
                </div>
              </div>

            </div>
            <div class="modal-footer">
              <button id="cerrarAgregarDocumento" type="button" class="btn btn-secondary"
                data-dismiss="modal">Cancelar</button>
              <button id="resetAgregarDocumento" type="reset" class="btn btn-secondary" hidden>
              </button>

              <button type="submit" class="btn btn-primary">
                Guardar
              </button>
            </div>
          </div>
        </form>
      </div>
    </div>
  </div>
</div>

<!-- ============= FORMULARIO CAMBIAR UBICACIÓN DEL EQUIPO ============= -->
<!-- formulario cambiar Ubicación  -->
<div id="modalCambiarUbicacion" class="modal fade" tabindex="-1" role="dialog" aria-labelledby="myLargeModalLabel"
  aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-dialog-centered modal-lg">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="TituloModal"><strong>Ubicación del Equipo {{ equipo.cod_laruex }}/{{
            equipo.fecha_alta|date:"Y"}}</strong> </h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>

      <div class="modal-body">
        <form id="formularioModalCambiarUbicacion" method="POST" enctype="multipart/form-data">
          {% csrf_token %}
          <!-- indica el tipo de objeto se que va a añadir -->
          <div class="form-group">
            <input type="text" class="form-control" id="tipoObjeto" name="tipoObjeto" data-rule="required" readonly
              value="Documento" style="display: none;" />
          </div><!-- fin tipoObjeto -->

          <div class="row">
            <!-- Fecha de baja  -->
            <div class="col-4">
              <div class="form-group">
                <label for="fechaCambioUbicacion" id="tituloFechaCambioUbicacion">Fecha de Actual</label>
                <input type="datetime-local" id="fechaCambioUbicacion" name="fechaCambioUbicacion" class="form-control"
                  required />
              </div>
            </div><!-- Fin fecha del documento  -->
            <div class="col-8">
              <div class="form-group">
                <label for="nuevaUbicacion">Nueva Ubicación</label>
                <select class="form-select" id="nuevaUbicacion" name="nuevaUbicacion">
                  {% for ubicacion in ubicaciones %}
                  <option value="{{ubicacion.id}}">
                    {% if ubicacion.id__padre__nombre is None %}
                    {{ubicacion.id__nombre}}
                    {% else %}
                    [{{ ubicacion.id__padre__nombre}}] {{ubicacion.id__nombre}}
                    {% endif %}
                  </option>
                  {% endfor %}
                </select>
              </div>
            </div>

          </div>

          <div class="modal-footer">
            <button id="cerrarCambiarUbicacion" type="button" class="btn btn-secondary" data-dismiss="modal"
              hidden>Cerrar</button>
            <button type="button" class="btn btn-secondary" data-dismiss="modal" id="cancelCambiarUbicacion"
              name="cancel"
              onclick="crearAviso('cambiarUbicacionEquipoCerrar', 'No se ha podido cambiar de ubicación el equipo {{ equipo.id.nombre }}', 'alert-warning', 3000)">Cancelar</button>
            <button type="submit" value="submit" class="btn btn-primary"
              onclick="crearAviso('cambiarUbicacionEquipoGuardar', 'Equipo {{ equipo.id.nombre }} cambiado de ubicación', 'alert-success', 3000)">
              Guardar
            </button>
          </div>
        </form>
      </div>
    </div>
  </div>
</div>

<!-- ============= MODAL DUPLICAR DATOS DEL EQUIPO EQUIPO ============= -->
<!-- formulario añadir equipo  -->
<div id="modalDuplicarEquipo" class="modal fade" tabindex="-1" role="dialog" aria-labelledby="myLargeModalLabel"
  aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-dialog-centered modal-lg">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="TituloModal">Duplicar Equipo</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <form id="formularioModalDuplicarEquipo" enctype="multipart/form-data">
          {% csrf_token %}
          <div class="form-group">
            <input type="text" class="form-control" id="tipoObjeto" name="tipoObjeto" data-rule="required" readonly
              value="Equipo" style="display: none;" />
            <input type="text" class="form-control" id="numCopias" name="numCopias" data-rule="required" readonly
              value="0" style="display: none;" />
          </div>
          <div class="row">
            <div class="col" hidden>
              <div class="form-group">
                <input class="form-control" data-rule="required" id="habilitacionDuplicarEquipo" name="habilitacion"
                  value="{{equipo.id.id_habilitacion.id|safe}}" readonly>
              </div>
            </div>
            <div class="col">
              <div class="form-group">
                <label for="ubicacion">Ubicación</label>
                <select class="form-select" data-rule="required" id="ubicacion" name="ubicacion">
                  {% for ubicacion in ubicaciones %}
                  <option value="{{ubicacion.id}}">
                    {% if ubicacion.id__padre__nombre is None %}
                    {{ubicacion.id__nombre}}
                    {% else %}
                    [{{ ubicacion.id__padre__nombre}}] {{ubicacion.id__nombre}}
                    {% endif %}
                  </option>
                  {% endfor %}
                </select>
              </div>
            </div>

          </div>
          <div class="row">
            <div class="col">
              <div class="form-group">
                <label for="cod_laruex">Código Laruex</label>
                <input required type="text" class="form-control" id="cod_laruex" placeholder="2331 " name="cod_laruex"
                  data-rule="required" pattern="[0-9]{4,6}" title="No es necesario añadir /2021"
                  value="{{ ultimoCodigo }}" />
              </div>
            </div>
            <div class="col" hidden>
              <div class="form-group">
                <label for="cod_uex">Código Uex</label>
                <input type="text" class="form-control" id="cod_uex" value="00000" name="cod_uex"
                  pattern="[0-9]{5,6}" />
              </div>
            </div>
            <div class="col">
              <div class="form-group">
                <label for="num_serie">S/N</label>
                <input required type="text" class="form-control" id="num_serie" placeholder="201520724 "
                  name="num_serie" data-rule="required"
                  title="No permite guiones ni otros caracteres que no sean espacios" />
              </div>
            </div>
            <div class="col">
              <div class="form-group">
                <label for="fechaAlta">Fecha de Alta</label>
                <input type="date" id="fechaAlta" name="fechaAlta" class="form-control" required />
              </div>
            </div>
          </div>
          <div class="row" hidden>
            <div class="col">
              <div class="form-group">
                <input required type="text" class="form-control" id="nombreObjeto" placeholder="Monitor 4k 60Hz"
                  name="nombreObjeto" value="{{equipo.id.nombre}}" readonly>
              </div>
            </div>
            <div class="col-12">
              <div class="form-group">
                <input type="text" class="form-control" id="modeloEquipo" value={{equipo.modelo}} name="modeloEquipo"
                  readonly />
              </div>
            </div>

            <div class="col">
              <div class="form-group">
                <input type="number" step="0.01" class="form-control" id="importe" placeholder="4,16" name="importe"
                  value="{{equipo.precio|safe}}" readonly />
              </div>
            </div>
            <div class="col">
              <div class="form-group">
                <input class="form-control" data-rule="required" id="tipo_equipo" name="tipo_equipo"
                  value="{{equipo.tipo_equipo.id}}" readonly>
              </div>
            </div>
            <div class="col">
              <div class="form-group">
                <input class="form-control" data-rule="required" id="fabricante" name="fabricante"
                  value="{{equipo.fabricante.id|safe}}" readonly>
              </div>
            </div>
            <div class="col">
              <div class="form-group">
                <input class="form-control" data-rule="required" id="proveedor" name="proveedor"
                  value="{{equipo.proveedor.id|safe}}" readonly>
              </div>
            </div>

          </div>
          <div class="row" hidden>
            <div class="col">
              <div class="form-group">
                <textarea type="text" class="form-control" id="descripcion" placeholder="Características: 1376L/min"
                  name="descripcion" data-rule="required" value="{{equipo.descripcion}}"
                  readonly>{{equipo.descripcion}}</textarea>
              </div>
            </div>
          </div>
          <div class="row my-2 d-flex justify-content-center" style="text-align: center;">
            <div class="col-4">
              <div class="form-group">




                <label for="ficheroAdjuntoEquipo">
                  <i class="fa-duotone fa-image fa-4x addFoto" id="iconoFotoUpload"></i>
                </label>
                <input type="file" class="form-control-file" style="display: none; visibility: none;"
                  id="ficheroAdjuntoEquipo" name="ficheroAdjuntoEquipo"
                  onchange="mostrarNombreFotoEquipo(this.value)" />
                <div class="text-center"><strong id="mostrarNombreFotoEquipo"><br></strong>
                  <spam id="foto-equipo-name"></spam>
                </div>
              </div>
            </div>
          </div>
          <div class="modal-footer">
            <button id="cerrarDuplicarEquipo" type="button" class="btn btn-secondary" data-dismiss="modal">
              Cerrar
            </button>
            <button id="resetrDuplicarEquipo" type="reset" class="btn btn-secondary" hidden>
            </button>
            <button type="submit" value="submit" class="btn btn-primary">
              Guardar
            </button>
          </div>
        </form>
      </div>
    </div>
  </div>
</div><!-- END formulario añadir equipo  -->

<!-- ============= MODAL ELIMINAR/ DAR BAJA EQUIPO ============= -->
<!-- Modal eliminar equipo  -->
<div id="modalBajaEquipo" class="modal fade" tabindex="-1" role="dialog" aria-labelledby="myModalElminarEquipo"
  aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-dialog-centered modal-lg">
    <div class="modal-content">
      <div class="modal-header">
        <h4 class="modal-title" id="TituloModal" style=" color: rgb(41, 68, 87);"><strong>Dar de baja equipo {{
            equipo.cod_laruex }}/{{ equipo.fecha_alta|date:"Y"}}</strong></h4>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <form id="formularioModalBajaEquipo" action="/private/docLaruex/darBajaEquipo/{{ equipo.id.id }}/" method="POST"
          enctype="multipart/form-data">
          {% csrf_token %}

          <!-- indica el tipo de objeto se que va a añadir -->
          <div>
            <h5><strong>¿Está seguro de que desea dar de baja el equipo {{ equipo.id.nombre }} de forma permanente
                ?</strong></h5>
          </div><!-- fin tipoObjeto -->
          <div class="row">
            <div class="col-3">
              <div class="form-group">
                <label for="fechaBaja">Fecha de Baja</label>
                <input type="date" id="fechaBaja" name="fechaBaja" class="form-control" required />
              </div>
            </div>

          </div>
          <div class="row">
            <div class="col">
              <div class="form-group">
                <label for="motivoBaja">Motivo de la Baja</label>
                <textarea type="text" class="form-control" id="motivoBaja" name="motivoBaja"></textarea>
              </div>
            </div>
          </div>
          {% if equipo.alta_uex == 1 or equipo.cod_uex != 0 %}
          <div class="row">
            <div class="col d-flex justify-content-center">
              <div class="form-group">
                <label class="text-danger font-italic" for="infoBaja">Se debe notificar a la universidad la baja del
                  equipo</label>
              </div>
            </div>
          </div>
          {% endif %}
      </div>

      <div class="modal-footer">
        <button id="cerrarBajaEquipos" type="button" class="btn btn-secondary" hidden></button>
        <button type="button" class="btn btn-secondary" data-dismiss="modal" id="cancelBajaEquipos"
          name="cancelBajaEquipos"
          onclick="crearAviso('darBajaEquipoCerrar', 'No se ha podido dar baja al equipo {{ equipo.id.nombre }}', 'alert-warning', 3000)">Cancelar</button>

        <button onclick="darBajaEquipo" class="btn btn-danger" id="EliminarEquipoBoton"
          onclick="crearAviso('darBajaEquipoGuardar', 'Equipo {{ equipo.id.nombre }} dado de baja con éxito', 'alert-success', 3000)">
          Eliminar
        </button>
      </div>
      </form>
    </div>
  </div>
</div><!-- END modal eliminar equipo  -->



<!-- ========== Modal para asociar Archivos al documento ========== -->
<div id="modalAsociarArchivo" class="modal fade bd-example-modal-lg" tabindex="-1" role="dialog"
  aria-labelledby="modalAsociarArchivo" aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-dialog-centered modal-xl">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="TituloModal">
          <strong>
            Seleccione los archivos que desea asociar.
          </strong>
        </h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span
            aria-hidden="true">&times;</span></button>
      </div>
      <!-- END Cabecera del modalAsociarArchivo -->

      <!-- Body del modalAsociarArchivo -->
      <div class="modal-body">
        <form id="formularioAsociarArchivo" enctype="multipart/form-data">
          {% csrf_token %}

          <div class="row justify-content-center">
            <div class="col-lg-5">
              <div class="card card p-4 ">
                <h5 class="card-title text-center">Lista de Archivos</h5>
                <table class="table-sm table-hover" id="tabla_archivos_para_asociar" data-search="true"
                  data-buttons-class="light" data-pagination="true" data-id-field="id" data-page-list="[10]"
                  data-toolbar="#toolbar"></table>
              </div>
            </div>

            <div class="col-lg-1 col-12 my-auto text-center">
              <i id="flechas" class="fa-solid fa-arrow-right-arrow-left fa-3x" style="color: rgb(41,68,87)"></i>
            </div>

            <div class="col-lg-5">
              <div class="card p-4">
                <h5 class="card-title text-center">Archivos seleccionados</h5>
                <table id="tabla_archivos_para_asociar_seleccionados" class="table-sm table-hover" data-search="true"
                  data-buttons-class="light" data-pagination="true" data-id-field="id" data-page-list="[10]"
                  data-toolbar="#toolbar"></table>
              </div>
            </div>
          </div>
      </div>
      <input type="text" id="idArchivoActual" value="{{ id }}" hidden name="idArchivoActual" data-rule="required" />
      <input type="text" id="idArchivosSeleccionados" value="{{ id }}" hidden name="idArchivosSeleccionados"
        data-rule="required" />

      <!-- Footer del ModalAsociarArchivo -->
      <div class="modal-footer d-flex">

        <button id="cerrarAsociar" type="button" class="btn btn-secondary" data-dismiss="modal">
          Cerrar
        </button>
        <button type="submit" value="submit" class="btn btn-primary">
          Guardar
        </button>
      </div>
      <!-- END Footer del ModalAsociarArchivo -->
    </div>
  </div>
</div><!-- END Body del ModalAsociarArchivo -->
</form>
</div> <!-- END ModalAsociarArchivo -->

<!-- ========== Modal para Ver imagen ========== -->
<!-- Section: Modals -->
<section class="">
  <!-- Modal 1 -->
  <div class="modal fade" id="modalVerImagen" tabindex="-1" aria-labelledby="modalVerImagen" aria-hidden="true">
    <div class="modal-dialog modal-lg">
      <div class="modal-content">
        <div class="ratio ratio-16x9">
          <img src="{% get_media_prefix %}/archivos/{{equipo.id.tipo}}/{{ equipo.id.ruta }}" title="Imagen"
            allowfullscreen></img>
        </div>
      </div>
    </div>
  </div>
</section>


<!-- ============= Modal Eliminar Asociación  ====================-->

<div id="modalEliminarAsociacion" class="modal fade" tabindex="-1" role="dialog" aria-labelledby="myLargeModalLabel"
  aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-dialog-centered modal-lg">
    <div class="modal-content">
      <div class="modal-header">

        <h5 class="modal-title" id="TituloModalEliminarAsociacion"><strong>¿Estas seguro que deseas eliminar esta
            asociación?</strong> </h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>


      <form id="formularioModalEliminarAsociacion" action="/private/docLaruex/eliminarAsociacion/0/" method="POST"
        enctype="multipart/form-data">
        {% csrf_token %}
        <!-- indica el tipo de objeto se que va a añadir -->
        <div class="modal-footer d-flex justify-content-center">
          <button id="cerrarEliminarAsociacion" type="button" class="btn btn-secondary" data-dismiss="modal"
            hidden>Cerrar</button>
          <button class="btn btn-secondary" data-dismiss="modal" id="cancelEliminarAsociacion" name="cancel"
            onclick="crearAviso('eliminarObjetoCancelar', 'No se ha podido eliminar', 'alert-warning', 3000)">Cancelar</button>
          <button type="submit" value="submit" class="btn btn-danger"
            onclick="crearAviso('eliminarObjetoGuardar', 'Objeto  eliminado', 'alert-success', 3000)">
            Eliminar
          </button>
        </div>
      </form>
    </div>
  </div>
</div>


<!-- ============= ALERT SUCCESS ELIMINAR EQUIPO ============= -->
<!--  
<div class="alert alert-success" role="alert">
  El equipo {{ equipo.id.nombre }} ha sido eliminado con éxito.
</div>-->
<script type="text/javascript">

  // mostramos el nombre del archivo en el input de adjuntar archivo y cambiamos el label del boton de adjuntar archivo
  function mostrarNombreFotoEquipo(value) {
    nombreFoto = document.getElementById('foto-equipo-name')
    nombreFoto.innerHTML = value;

    icono = document.getElementById('iconoFotoUpload');
    
    icono.classList.remove("fa-duotone","fa-image", "addFoto");
    console.log(icono);
    icono.classList.add("fa-duotone","fa-circle-check", "okFoto");

    document.getElementById('mostrarNombreFotoEquipo').style.display = 'none';
    }

  // ===================== Tabla con lista de notificaciones =====================
  $("#tabla_notificaciones").bootstrapTable({
    method: "get",
    url: "/private/docLaruex/notificacionesDatos/{{ equipo.id.id }}/",
    cache: false,
    locale: navigator.language,
    columns: [
      {
        title: "Fecha",
        field: "fecha",
        sortable: "true",
        align: "center",
        formatter: function (value, row) {
          var fecha = new Date(row.fecha);
          return (
            $.datepicker.formatDate("dd-mm-yy", fecha)
          );
        },
      },
      {
        title: "Título",
        field: "titulo",
        align: "center",
      },
      {
        title: "Resumen",
        field: "resumen",
        align: "center",
      },
      {
        title: "Creador",
        field: "creador",
        align: "center",
        formatter: function (value, row) {
          return row.creador__first_name + " " + row.creador__last_name;
        },
      },
      {
        title: "Estado",
        field: "estado_notificacion__nombre",
        align: "center",
        formatter: function (value, row) {
          var defecto = '<span class="badge" style="background-color: #524e4e;">Enviada</span>';
          switch (row.estado_notificacion__id) {
            case 1:
              estado = '<span class="badge badge-success" style="background-color: #524e4e;">Enviada</span>';
              return estado;
              break;
            case 2:
              estado = '<span class="badge" style="background-color: #0A9396;">Recibida</span>';
              return estado;
              break;

            case 3:
              estado = '<span class="badge" style="background-color: #EB8E34;">En tramite</span>';
              return estado;
              break;
            case 4:
              estado = '<span class="badge" style="background-color: #21b563;">Cerrada</span>';
              return estado;
              break;
            case 5:
              estado = '<span class="badge" style="background-color: #b52121;">No atendida</span>';
              return estado;
              break;

            default:
              return defecto;

          }
        },
      },
    ],
    search: true,
    sortName: "id",
    sortOrder: "desc",
  });


  // cambiamos la funcionalidad del boton submit del formulario de envio de notificaciones
  // ++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
  $("#formularioModalEnviarNota").submit(function (e) {
    // cancelamos el funcionamiento por defecto del boton submit
    e.preventDefault();
    // capturamos la información del formulario 
    var data = new FormData(this);
    // ejecuta una url/action con la capacidad de gestionar la salida
    $.ajax({
      url: "/private/docLaruex/agregarNotificacion/",
      type: "POST",
      data: data,
      cache: false,
      contentType: false,
      processData: false,
      // gestiono el return del view
      success: function () {
        crearAviso('objetoGuardar', 'Notificacion guardado con éxito', 'alert-success', 2000)
        $('#tabla_notificaciones').bootstrapTable('refresh');
        $(".modalFormularioEnviarNota").remove();
        $("#resetEnviarNota").trigger("click");
        $('#cerrarEnviarNota').trigger('click');

      }
    });
  });

  $("#formularioModalCambiarUbicacion").submit(function (e) {
    e.preventDefault();
    var data = new FormData(this);
    $.ajax({
      url: "/private/docLaruex/cambiarUbicacionEquipo/{{ equipo.id.id }}/",
      type: "POST",
      data: data,
      cache: false,
      contentType: false,
      processData: false,
      // gestiono el return del view
      success: function () {
        $('#cerrar').trigger('click');
        window.location.reload();
      }
    });
  });




  // mostramos el nombre del archivo en el input de adjuntar archivo y cambiamos el label del boton de adjuntar archivo
  function mostrarNombreArchivo(value) {

    document.getElementById('file-name').innerHTML = value;

    document.getElementById('mostrarNombreArchivo').style.display = 'none';
  }




  // permite modificar el nombre del formulario en funcion del tipo del documento seleccionado
  function mostrarTitulo(value) {

    if (value == "1") {
      $("#tituloFecha").html("Fecha de la Factura");
      $("#fechaActualizacion").show();
      $("#nombreObjeto").val($("#tipoDocumento option:selected").text() + " - ");
      $("#nombreObjeto").prop('readonly', false);
      $("#tituloFecha").show();
      $("#TituloModalAddDocumento").html("Añadir Factura");
    } else if (value == "2") {

      $("#TituloModalAddDocumento").html("Añadir Manual");
      $("#tituloFecha").hide();
      $("#nombreObjeto").val($("#tipoDocumento option:selected").text() + " - " + "{{ equipo.cod_laruex }}");
      $("#nombreObjeto").prop('readonly', true);
      $("#fechaActualizacion").hide();
    } else if (value == "3") {
      $("#TituloModalAddDocumento").html("Añadir Norma");
      $("#tituloFecha").hide();
      $("#nombreObjeto").val($("#tipoDocumento option:selected").text() + " - " + "{{ equipo.cod_laruex }}");
      $("#nombreObjeto").prop('readonly', true);
      $("#fechaActualizacion").hide();
    } else if (value == "4") {
      $("#TituloModalAddDocumento").html("Añadir Certificado");
      $("#tituloFecha").hide();
      $("#nombreObjeto").val($("#tipoDocumento option:selected").text() + " - " + "{{ equipo.cod_laruex }}");
      $("#nombreObjeto").prop('readonly', true);
      $("#fechaActualizacion").hide();
    } else if (value == "5") {
      $("#tituloFecha").html("Fecha de la Calibración");
      $("#fechaActualizacion").show();
      $("#nombreObjeto").val($("#tipoDocumento option:selected").text() + " Inicial- " + "{{ equipo.cod_laruex }}");
      $("#nombreObjeto").prop('readonly', true);
      $("#tituloFecha").show();
      $("#TituloModalAddDocumento").html("Añadir Calibración");

    } else if (value == "6") {
      $("#tituloFecha").html("Fecha del Contrato");
      $("#fechaActualizacion").show();
      $("#nombreObjeto").val($("#tipoDocumento option:selected").text() + " de Mantenimiento - " + "{{ equipo.cod_laruex }}");
      $("#nombreObjeto").prop('readonly', false);
      $("#tituloFecha").show();
      $("#TituloModalAddDocumento").html("Añadir Contrato");
    } else if (value == "7") {
      $("#nombreObjeto").val($("#tipoDocumento option:selected").text() + "-");
      $("#nombreObjeto").prop('readonly', false);
      $("#TituloModalAddDocumento").html("Añadir Anexo");

    } else if (value == "8") {
      $("#TituloModalAddDocumento").html("Añadir Albarán");
      $("#nombreObjeto").val($("#tipoDocumento option:selected").text() + " - " + "{{ equipo.cod_laruex }}");
      $("#nombreObjeto").prop('readonly', false);
    } else {
      $("#TituloModalAddDocumento").html("Añadir Documento");
      $("#tituloFecha").hide();
      $("#nombreObjeto").val($("#tipoDocumento option:selected").text() + " - " + "{{ equipo.cod_laruex }}");
      $("#nombreObjeto").prop('readonly', false);
      $("#fechaActualizacion").hide();
    }
  }


  // ------------------------------------------------------------------


  // cambiamos la funcionalidad del boton submit del formulario
  //addEventListener('reset', function() {
  //  $(".modalDuplicarEquipo").reset();
  //});
  // cambiamos la funcionalidad del boton submit del formulario
  $("#formularioModalDuplicarEquipo").submit(function (e) {
    // cancelamos el funcionamiento por defecto del boton submit
    e.preventDefault();
    // capturamos la información del formulario 
    var data = new FormData(this);
    // ejecuta una url/action con la capacidad de gestionar la salida
    $.ajax({
      url: "/private/docLaruex/agregarArchivo/",
      type: "POST",
      data: data,
      cache: false,
      contentType: false,
      processData: false,
      // gestiono el return del view
      success: function () {


        crearAviso('objetoGuardar', 'Equipo duplicado con éxito', 'alert-success', 2000)

        $(".modalDuplicarEquipo").remove();
        $("#resetDuplicarEquipo").trigger("click");
        $('#modalDuplicarEquipo').modal('toggle');
        $('#cerrarDuplicarEquipo').trigger('click');

        location.reload(true);

      }
    });

  });

  // cambiamos la funcionalidad del boton submit del formulario del modal ASOCIAR ARCHIVO
  $("#formularioModalAddDocumento").submit(function (e) {
    // cancelamos el funcionamiento por defecto del boton submit
    e.preventDefault();
    // capturamos la información del formulario 
    var data = new FormData(this);
    // ejecuta una url/action con la capacidad de gestionar la salida
    $.ajax({
      url: "/private/docLaruex/agregarArchivo/",
      type: "POST",
      data: data,
      cache: false,
      contentType: false,
      processData: false,
      // gestiono el return del view
      success: function (data) {
        crearAviso('agregarAñadirDocumentoGuardar', 'Nuevo documento asociado a {{ equipo.id.nombre }}', 'alert-success', 3000);
        console.log(data);
        $("#idArchivosSeleccionados").val(data["idObjeto"]);
        $.ajax({
          url: "/private/docLaruex/asociarArchivo/{{equipo.id.id}}/",
          type: "POST",
          data: $("#formularioAsociarArchivo").serialize(),
          // gestiono el return del view
          success: function (data) {
            $('#tabla_referencias_asociadas').bootstrapTable('refresh');
            $("#resetAgregarDocumento").trigger("click");
            $('#cerrarAgregarDocumento').trigger('click');
          }
        });
      }
    });

  });



  $("#formularioModalBajaEquipo").submit(function (e) {
    e.preventDefault();
    var data = new FormData(this);
    alert('El equipo ha sido dado de baja con exito');
    $.ajax({
      url: "/private/docLaruex/darBajaEquipo/{{ equipo.id.id }}/",
      type: "POST",
      data: data,
      cache: false,
      contentType: false,
      processData: false,
      // gestiono el return del view
      success: function () {
        $(".modalBajaEquipo").remove();
        location.reload(true);
      }
    });
  });




  function addZero(i) {
    if (i < 10) { i = "0" + i }
    return i;
  }


  // Tabla con lista de referencias asociadas
  $("#tabla_referencias_asociadas").bootstrapTable({
    method: "get",
    url: "/private/docLaruex/archivosAsociados/{{ equipo.id.id }}/",
    cache: false,
    locale: navigator.language,
    columns: [
      {
        title: "ID",
        field: "id_relacionado",
        align: "center",
      },
      {
        title: "Nombre",
        field: "id_relacionado__nombre",
        align: "center",
      },
      {
        title: "Tipo",
        field: "id_relacionado__tipo",
        align: "center",
      },
      {
        title: "Creador",
        field: "creador",
        align: "center",
        formatter: function (value, row) {
          return (
            row.id_relacionado__creador__first_name +
            " " +
            row.id_relacionado__creador__last_name
          );
        },
      },
      {
        title: "Fecha",
        field: "id_relacionado__fecha_subida",
        sortable: "true",
        align: "center",
        formatter: function (value, row) {
          var fecha = new Date(row.id_relacionado__fecha_subida);
          return (
            $.datepicker.formatDate("dd-mm-yy", fecha) +
            " " +
            addZero(fecha.getHours()) +
            ":" +
            addZero(fecha.getMinutes())
          );
        },
      },
      {
        title: "Estado",
        field: "id_relacionado__id_estado__id",
        align: "center",

        formatter: function (value, row) {
          var defecto = '<span class="badge" style="background-color: #EB8E34;">En Revisión</span>';
          switch (row.id_relacionado__id_estado__id) {
            case 1:
              estado = '<span class="badge badge-success" style="background-color: #21b563;">Operativo</span>';
              return estado;
              break;
            case 2:
              estado = '<span class="badge" style="background-color: #21b563;">En Vigor</span>';
              return estado;
              break;

            case 3:
              estado = '<span class="badge" style="background-color: #EB8E34;">En Mantenimiento</span>';
              return estado;
              break;
            case 4:
              estado = '<span class="badge" style="background-color: #EB8E34;">En Revisión</span>';
              return estado;
              break;
            case 5:
              estado = '<span class="badge" style="background-color: #524e4e;">Obsoleto</span>';
              return estado;
              break;
            case 6:
              estado = '<span class="badge" style="background-color: #b52121;">No operativo</span>';
              return estado;
              break;
            case 7:
              estado = '<span class="badge" style="background-color: #b52121;">Baja</span>';
              return estado;
              break;

            default:
              console.log("No se ha encontrado el estado", row.id_relacionado__id)
              return defecto;

          }
        },
      }, {
        title: "Acciones",
        field: "action",
        align: "center",
        formatter: function (value, row) {


          // Definimos las variables  
          var admin = '{{administrador}}';
          var habilitacionesUsuario = '{{ habilitacionesUsuario }}';
          var habilitacionNecesaria = row.id_relacionado__id_habilitacion;
          var existeHabilitacion = 'False';

          var objeto = '{{equipo.id.id}}';
          var rol = '{{rol}}';

          var botonVerDocumento = '<a href="/private/docLaruex/verObjeto/' + row.id_relacionado + '/" class="mx-1" title="Abrir" ><i class="fa-solid fa-arrow-right-to-bracket fa-lg" style="color:#68B29E"></i></a>';
          var botonDescargarDocumentoPDF = '<a href="/private/docLaruex/consultarArchivo/' + row.id_relacionado + '/' + '" class="mx-1" title="Descargar" download><i class="fa-solid fa-file-pdf fa-lg" style="color:#A11020"></i></a>';
          var botonDescargarDocumentoWord = '<a href="/private/docLaruex/consultarArchivoEditable/' + row.id_relacionado + '/' + '" class="mx-1" title="Descargar" download><i class="fa-duotone fa-file-signature fa-lg" style="color:#266353"></i></a>';

          var botonEliminarAsociacion = '<a href="/private/docLaruex/eliminarAsocicion/' + row.id_relacionado + '/' + objeto + '/" class="mx-1" title="Eliminar Asociacion" data-toggle="modal" data-target="#modalEliminarAsociacion" onclick="$(' + "'#formularioModalEliminarAsociacion').attr('action', '/private/docLaruex/eliminarAsocicion/" + row.id_relacionado + "/" + objeto + "/');" + '"  style="color:#AE2012"><i class="fa-duotone fa-link-slash" ></i></a>';

          if (admin == 'True') {
            if (row.id_relacionado__ruta_editable) {

              return (botonVerDocumento + botonDescargarDocumentoPDF + botonDescargarDocumentoWord + botonEliminarAsociacion);
            } else {
              return (botonVerDocumento + botonDescargarDocumentoPDF + botonEliminarAsociacion);
            }
          } else if (rol == 'Responsable' || rol == 'Director') {
            if (row.id_relacionado) {
              return (botonVerDocumento + botonDescargarDocumentoPDF + botonDescargarDocumentoWord);
            } else {
              return (botonVerDocumento + botonDescargarDocumentoPDF);
            }

          } else {
            return (botonVerDocumento + botonDescargarDocumentoPDF);
          }
        },
      },
    ],
    search: true,
    sortOrder: "desc",
  });

  /*
    ------------ TABLAS Y FUNCIONES DEL MODAL ASOCIAR USUARIOS ------------
  */

  //tabla del modal asociar objetos
  $("#tabla_archivos_para_asociar").bootstrapTable({
    method: "get",
    locale: navigator.language,
    url: "/private/docLaruex/archivosDatosAsociar",
    cache: false,
    columns: [
      {
        title: "ID",
        field: "id",
        align: "center",
      }, {
        title: 'Empleado',
        field: "nombre",
        align: "center",
      }, {
        title: 'Tipo',
        field: "tipo",
        align: "center",
      }, {
        title: "",
        field: "action",
        align: "center",
        formatter: function (value, row) {
          return (
            '<div onclick="addValueTable(' + row.id + ', &apos;' + row.nombre + '&apos;)" class="mx-1" title="select"><i class="fa-solid fa-angles-right fa-lg" style="color:#68B29E"></i></div>'
          );
        },
      },
    ],
    search: true,
    sortName: "id",
    sortOrder: "asc",
  });

  function addValueTable(id,
    nombre, tipo) {
    $("#tabla_archivos_para_asociar_seleccionados").bootstrapTable('insertRow', {
      index: 0,
      row: {
        id: id,
        nombre: nombre,
      }
    });
  }

  // tatbla de elementos seleccionados
  $("#tabla_archivos_para_asociar_seleccionados").bootstrapTable({
    locale: navigator.language,
    cache: false,
    columns: [
      {
        title: "ID",
        field: 'id',
        align: "center",
      }, {
        title: "Empleado",
        field: 'nombre',
        align: "center"
      }, {
        title: "",
        field: "action",
        align: "center",
        formatter: function (value, row) {
          return (
            '<div onclick="deleteValue(' + row.id + ')" class="mx-1" ><i class="fa-solid fa-xmark fa-lg" style="color:#F52220"></i></div>'

          );
        },
      },
    ],
    search: true,
    sortName: "id",
    sortOrder: "asc",
  });

  function deleteValue(id) {
    $("#tabla_archivos_para_asociar_seleccionados").bootstrapTable('remove', {
      field: 'id',
      values: [id]
    })
  }

  // cambiamos la funcionalidad del boton submit del formulario
  $("#formularioAsociarArchivo").submit(function (e) {
    // cancelamos el funcionamiento por defecto del boton submit
    e.preventDefault();
    $table = $("#tabla_archivos_para_asociar_seleccionados");
    var idSeleccionado = "";
    var cargoIDSeleccionado = "";
    for (let value of $table.bootstrapTable('getData')) {
      console.log("info file");
      console.log(value);
      idSeleccionado = idSeleccionado + value["id"] + "#";

      console.log(idSeleccionado);
    }

    $("#idArchivosSeleccionados").val(idSeleccionado);
    console.log($("#idArchivosSeleccionados").val());
    // capturamos la información del formulario 
    var data = new FormData(this);
    // ejecuta una url/action con la capacidad de gestionar la salida

    $.ajax({
      url: "/private/docLaruex/asociarArchivo/{{ equipo.id.id }}/",
      type: "POST",
      data: data,
      cache: false,
      contentType: false,
      processData: false,
      // gestiono el return del view
      success: function () {
        $table.bootstrapTable('removeAll');
        $("#idArchivosSeleccionados").val("");
        $('#tabla_referencias_asociadas').bootstrapTable('refresh');
        $('#cerrarAsociar').trigger('click');
      }
    });
  });

</script>
<!--collapse con listado de equipos asociados a la estación -->

{% endblock %}